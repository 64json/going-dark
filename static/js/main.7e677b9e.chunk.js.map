{"version":3,"sources":["utils.js","Character.js","App.js","index.js"],"names":["classes","vs","filter","v","join","Character","direction","className","teamId","dx","dy","style","mx","Math","abs","my","moving","Array","fill","map","_","i","GRASS","DIVIDER","ROCK0","ROCK1","ROCK2","TREE","TOWER","JAIL","BORDER_TOP","BORDER_BOTTOM","BORDER_LEFT","BORDER_RIGHT","BORDER_TOP_LEFT","BORDER_TOP_RIGHT","BORDER_BOTTOM_LEFT","BORDER_BOTTOM_RIGHT","obstacles","App","mapHeight","mapWidth","windowHeight","useState","setDelta","x","y","setPos","frame","setFrame","windowWidth","setWindowWidth","height","width","j","flag","top","bottom","left","right","random","initMap","useEffect","onKeyDown","e","preventDefault","console","log","key","onKeyUp","onTilt","absolute","alpha","beta","gamma","onResize","window","innerHeight","innerWidth","document","addEventListener","removeEventListener","nx","ny","xFlag","mapCx","mapCy","some","obstacle","yFlag","windowCx","windowCy","mapSx","mapSy","croppedMap","slice","row","crop","offsetX","offsetY","minimapRef","useRef","canvas","current","ctx","getContext","clearRect","colorMap","blocks","Object","keys","forEach","block","find","fillStyle","fillRect","strokeStyle","strokeRect","marginTop","marginLeft","k","zIndex","includes","ref","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.7e677b9e.chunk.js","sourcesContent":["export const classes = (...vs) => vs.filter(v => v).join(' ');\n","import React from 'react';\nimport './Character.scss';\nimport { classes } from './utils';\n\nfunction Character({ className, teamId, dx, dy, style }) {\n  const movingThreshold = .2;\n  const mx = Math.abs(dx);\n  const my = Math.abs(dy);\n  const moving = mx > movingThreshold || my > movingThreshold;\n  let direction;\n  if (mx > my) {\n    direction = dx < 0 ? 'top' : 'bottom';\n  } else {\n    direction = dy < 0 ? 'left' : 'right';\n  }\n  return (\n    <div className={classes('Character', `team_${teamId}`, moving && 'moving', direction, className)} style={style}>\n    </div>\n  );\n}\n\nexport default Character;","import React, { useEffect, useRef, useState } from 'react';\nimport './App.scss';\nimport Character from './Character';\nimport { classes } from './utils';\n\nconst [\n  GRASS,\n  DIVIDER,\n  ROCK0,\n  ROCK1,\n  ROCK2,\n  TREE,\n  TOWER,\n  JAIL,\n  KEY,\n  BORDER_TOP,\n  BORDER_BOTTOM,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT,\n] = new Array(31).fill(0).map((_, i) => 1 << i);\nconst obstacles = [ROCK0, ROCK1, ROCK2, TREE, TOWER, JAIL,\n  BORDER_TOP,\n  BORDER_BOTTOM,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT];\n\nfunction initMap(height, width) {\n  const map = new Array(height).fill(0).map((_, i) =>\n    new Array(width).fill(0).map((_, j) => {\n      let flag = GRASS;\n\n      const top = i === 0;\n      const bottom = i === height - 1;\n      const left = j === 0;\n      const right = j === width - 1;\n      if (top && left) flag |= BORDER_TOP_LEFT;\n      else if (top && right) flag |= BORDER_TOP_RIGHT;\n      else if (bottom && left) flag |= BORDER_BOTTOM_LEFT;\n      else if (bottom && right) flag |= BORDER_BOTTOM_RIGHT;\n      else if (top) flag |= BORDER_TOP;\n      else if (bottom) flag |= BORDER_BOTTOM;\n      else if (left) flag |= BORDER_LEFT;\n      else if (right) flag |= BORDER_RIGHT;\n      else {\n        if (Math.random() < .01) flag |= [ROCK0, ROCK1, ROCK2][Math.random() * 3 | 0];\n        if (Math.random() < .02) flag |= TREE;\n        if (i === 4 || i === height - 1 - 4) flag |= JAIL;\n        if (i === 80) flag |= DIVIDER;\n      }\n      return flag;\n    }));\n  map[40][width / 2 | 0] |= TOWER;\n  map[height - 1 - 40][width / 2 | 0] |= TOWER;\n  return map;\n}\n\nfunction crop(map, i, j, height, width) {\n  const rows = i < 0\n    ? [...new Array(-i).fill(0).map(() => new Array(width).fill(0)), ...map.slice(0, i + height)]\n    : map.slice(i, i + height);\n  return rows.map(row => j < 0\n    ? [...new Array(-j).fill(0), ...row.slice(0, j + width)]\n    : row.slice(j, j + width),\n  );\n}\n\nfunction App({ mapHeight, mapWidth, windowHeight }) {\n  const [[dx, dy], setDelta] = useState([0, 0]);\n  const [[x, y], setPos] = useState([0, 0]);\n  const [frame, setFrame] = useState(0);\n  const [windowWidth, setWindowWidth] = useState(windowHeight * 2 | 0);\n  const [map, setMap] = useState(initMap(mapHeight, mapWidth));\n\n  useEffect(() => {\n    const onKeyDown = e => {\n      e.preventDefault();\n      console.log(e.key);\n      let dx = 0;\n      let dy = 0;\n      switch (e.key) {\n        case 'ArrowDown':\n          dx++;\n          break;\n        case 'ArrowUp':\n          dx--;\n          break;\n        case 'ArrowLeft':\n          dy--;\n          break;\n        case 'ArrowRight':\n          dy++;\n          break;\n        default:\n      }\n      dx /= 1.2;\n      dy /= 1.2;\n      setDelta([dx, dy]);\n      setFrame(Math.random());\n    };\n\n    const onKeyUp = e => {\n      setDelta([0, 0]);\n    };\n\n    const onTilt = e => {\n      const absolute = e.absolute;\n      const alpha = e.alpha;\n      const beta = e.beta;\n      const gamma = e.gamma;\n      const dx = -gamma / 180;\n      const dy = beta / 180;\n      setDelta([dx, dy]);\n      setFrame(Math.random());\n    };\n\n    const onResize = () => {\n      setWindowWidth(window.innerHeight / window.innerWidth * windowHeight + .5 | 0);\n    };\n    onResize();\n\n    document.addEventListener('keydown', onKeyDown);\n    document.addEventListener('keyup', onKeyUp);\n    window.addEventListener('resize', onResize);\n    window.addEventListener('deviceorientation', onTilt, true);\n    return () => {\n      document.removeEventListener('keydown', onKeyDown);\n      document.removeEventListener('keyup', onKeyUp);\n      window.removeEventListener('resize', onResize);\n      window.removeEventListener('deviceorientation', onTilt);\n    };\n  }, []);\n\n  useEffect(() => {\n    let nx = x + dx;\n    let ny = y + dy;\n    const xFlag = map[mapCx + nx + .5 | 0][mapCy + y + .5 | 0];\n    if (obstacles.some(obstacle => (obstacle & xFlag) > 0)) {\n      nx = x;\n    }\n    const yFlag = map[mapCx + x + .5 | 0][mapCy + ny + .5 | 0];\n    if (obstacles.some(obstacle => (obstacle & yFlag) > 0)) {\n      ny = y;\n    }\n    setPos([nx, ny]);\n  }, [frame]);\n\n  const mapCx = mapHeight / 2 | 0;\n  const mapCy = mapWidth / 2 | 0;\n  const windowCx = windowHeight / 2 | 0;\n  const windowCy = windowWidth / 2 | 0;\n\n  const mapSx = mapCx + (x | 0) - windowCx;\n  const mapSy = mapCy + (y | 0) - windowCy;\n\n  const croppedMap = crop(map, mapSx - 1, mapSy - 1, windowHeight + 2, windowWidth + 2);\n\n  const offsetX = (x | 0) - x;\n  const offsetY = (y | 0) - y;\n\n  const minimapRef = useRef(null);\n  const canvas = minimapRef.current;\n  if (canvas) {\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    const colorMap = {\n      [TOWER]: '#ffe300',\n      [JAIL]: '#49320f',\n    };\n    const blocks = Object.keys(colorMap);\n    map.forEach((row, i) => {\n      row.forEach((flag, j) => {\n        const block = blocks.find(block => (block & flag) > 0);\n        if (block in colorMap) {\n          ctx.fillStyle = colorMap[block];\n          ctx.fillRect(j - 1, i - 1, 3, 3);\n        }\n      });\n    });\n    ctx.fillStyle = '#00FF00';\n    ctx.fillRect((mapCy + (y | 0)) - 1, (mapCx + (x | 0)) - 1, 3, 3);\n    ctx.strokeStyle = '#FF0000';\n    ctx.strokeRect(mapSy, mapSx, windowWidth, windowHeight);\n  }\n\n  return (\n    <div className=\"App\">\n      <div className=\"game\">\n        <div className=\"grid\" style={{\n          marginTop: `calc(${offsetX - 1} * 9.09vw)`,\n          marginLeft: `calc(${offsetY - 1} * 9.09vw)`,\n        }}>\n          {\n            croppedMap.map((row, i) => (\n              <div className=\"row\" key={i}>\n                {\n                  row.map((flag, j) => {\n                    return (\n                      <div className=\"col\" key={j}>\n                        {\n                          ['grass', 'divider', 'rock0', 'rock1', 'rock2', 'tree', 'tower', 'jail', 'key',\n                            'border_top',\n                            'border_bottom',\n                            'border_left',\n                            'border_right',\n                            'border_top_left',\n                            'border_top_right',\n                            'border_bottom_left',\n                            'border_bottom_right']\n                            .filter((_, k) => (flag & (1 << k)) > 0)\n                            .map(block => (\n                              <div key={block} className={classes('block', block)} style={{\n                                zIndex: ['grass', 'divider'].includes(block) ? 0 : x + 1 < (x | 0) - windowCx + i ? 2 : 0,\n                              }}>\n                              </div>\n                            ))\n                        }\n                      </div>\n                    );\n                  })\n                }\n              </div>\n            ))\n          }\n        </div>\n        <Character className=\"character\" teamId={0} dx={dx} dy={dy} style={{\n          top: `calc(${windowCx} * 9.09vw)`,\n          left: `calc(${windowCy} * 9.09vw)`,\n        }}/>\n        <div className=\"illumination\" style={{\n          marginTop: `calc(${windowCx} * 9.09vw)`,\n          marginLeft: `calc(${windowCy} * 9.09vw)`,\n        }}/>\n        <div className=\"overlay\">\n          <div className=\"minimap\">\n            <canvas ref={minimapRef} className=\"canvas\" height={mapHeight} width={mapWidth}/>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\n\nReactDOM.render(<App mapHeight={161} mapWidth={81}\n                     windowHeight={11}/>, document.getElementById('root'));\n"],"sourceRoot":""}
(this["webpackJsonpcapture-the-flag"]=this["webpackJsonpcapture-the-flag"]||[]).push([[0],{18:function(e,t,n){},38:function(e,t,n){e.exports=n(77)},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},74:function(e,t){},77:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(33),s=n.n(a),c=(n(43),n(1)),o=(n(44),n(6)),u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return e})).join(" ")},h=function(e){return e*e},l=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),d=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);n(18);var f=function(e){var t,n=e.className,i=e.user,a=e.style,s=i.delta.magnitude>.05;return t=Math.abs(i.delta.x)>Math.abs(i.delta.y)?i.delta.x<0?"top":"bottom":i.delta.y<0?"left":"right",r.a.createElement("div",{className:u("Character","team_".concat(i.teamId),s&&"moving",t,n),style:a},r.a.createElement("div",{className:u("holding",i.hasKey?"key":"lamp")}))},m=n(2),v=n(3),w=n(36),p=n(34),y=n(37),g=function(){function e(t,n){Object(m.a)(this,e),this.x=t,this.y=n}return Object(v.a)(e,[{key:"plus",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"distanceTo",value:function(e){return Math.sqrt(h(this.x-e.x)+h(this.y-e.y))}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"indices",get:function(){return[Math.round(this.x),Math.round(this.y)]}},{key:"magnitude",get:function(){return Math.sqrt(h(this.x)+h(this.y))}}],[{key:"restore",value:function(t){return new e(t.x,t.y)}}]),e}(),b=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new g(0,0),a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Object(m.a)(this,e),this.uuid=t,this.teamId=n,this._pos=i,this._delta=r,this._hasKey=a,this._isFlashing=s,this._isScanning=c}return Object(v.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"pos",get:function(){return this.isScanning?new g(40,40):this._pos},set:function(e){this.isScanning||this._pos.equals(e)||(this._pos=e,this.server&&this.server.updateUser(this))}},{key:"delta",get:function(){return this._delta},set:function(e){this._delta.equals(e)||(this._delta=e,this.server&&this.server.updateUser(this))}},{key:"hasKey",get:function(){return this._hasKey},set:function(e){this._hasKey=e,this.server&&this.server.updateUser(this)}},{key:"isFlashing",get:function(){return this._isFlashing},set:function(e){this._isFlashing=e,this.server&&this.server.updateUser(this)}},{key:"isScanning",get:function(){return this._isScanning},set:function(e){this._isScanning=e,this.server&&this.server.updateUser(this)}},{key:"angle",get:function(){return Math.atan2(-this.delta.y,this.delta.x)}},{key:"nextPos",get:function(){return this.pos.plus(this.delta)}}],[{key:"restore",value:function(t){var n=t.uuid,i=t.teamId,r=t._pos,a=t._delta,s=t._hasKey,c=t._isFlashing,o=t._isScanning;return new(n===l?k:e)(n,i,g.restore(r),g.restore(a),s,c,o)}}]),e}(),k=function(e){function t(){return Object(m.a)(this,t),Object(w.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(y.a)(t,e),t}(b),j=function(){function e(t,n){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object(m.a)(this,e),this.height=t,this.width=n,i&&this.resize()}return Object(v.a)(e,[{key:"resize",value:function(){this.width=window.innerHeight/window.innerWidth*this.height+.5|0}},{key:"gridSize",get:function(){return"".concat((100/this.height).toFixed(2),"vw")}},{key:"center",get:function(){return new g(this.height/2|0,this.width/2|0)}}],[{key:"restore",value:function(t){return new e(t.height,t.width)}}]),e}(),O=n(7),E=new Array(31).fill(0).map((function(e,t){return 1<<t})),S=Object(c.a)(E,16),_=S[0],x=S[1],M=S[2],F=S[3],N=S[4],z=S[5],L=S[6],I=S[7],U=S[8],A=S[9],G=S[10],R=S[11],K=S[12],P=S[13],C=S[14],q=S[15],T=function(){function e(t,n,i){Object(m.a)(this,e),this.height=t,this.width=n,i?this.map=i:(this.map=new Array(t).fill(0).map((function(e,i){return new Array(n).fill(0).map((function(e,r){var a=0,s=0===i,c=i===t-1,o=0===r,u=r===n-1;return s&&o?a|=K:s&&u?a|=P:c&&o?a|=C:c&&u?a|=q:s?a|=U:c?a|=A:o?a|=G:u?a|=R:80===i?a|=_:4===i||i===t-1-4?a|=L:Math.random()<.01?a|=[x,M,F][3*Math.random()|0]:Math.random()<.02&&(a|=N),a}))})),this.map[40][n/2|0]|=z,this.map[t-1-40][n/2|0]|=z)}return Object(v.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"crop",value:function(e,t,n){var i=Object(c.a)(e.indices,2),r=i[0],a=i[1];return(r<0?[].concat(Object(O.a)(new Array(-r).fill(0).map((function(){return new Array(n).fill(0)}))),Object(O.a)(this.map.slice(0,r+t))):this.map.slice(r,r+t)).map((function(e){return a<0?[].concat(Object(O.a)(new Array(-a).fill(0)),Object(O.a)(e.slice(0,a+n))):e.slice(a,a+n)}))}},{key:"add",value:function(e,t){var n=Object(c.a)(e.indices,2),i=n[0],r=n[1];this.map[i][r]|=t,this.server&&this.server.updateMap(i,r,this.map[i][r])}},{key:"remove",value:function(e,t){var n=Object(c.a)(e.indices,2),i=n[0],r=n[1];this.map[i][r]&=~t,this.server&&this.server.updateMap(i,r,this.map[i][r])}},{key:"clear",value:function(e){var t=Object(c.a)(e.indices,2),n=t[0],i=t[1];this.map[n][i]=0,this.server&&this.server.updateMap(n,i,this.map[n][i])}},{key:"has",value:function(e,t){var n=Object(c.a)(e.indices,2),i=n[0],r=n[1];return(this.map[i][r]&t)>0}},{key:"forEach",value:function(e){return this.map.forEach(e)}},{key:"getSpawnPos",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new g(this.height-6-e,this.center.y);return this.clear(t),t}},{key:"center",get:function(){return new g(this.height/2|0,this.width/2|0)}}],[{key:"restore",value:function(t){return new e(t.height,t.width,t.map)}}]),e}(),D=function(){function e(t,n,i,r){Object(m.a)(this,e),this.id=t,this.map=n,this.users=i,this._window=r}return Object(v.a)(e,[{key:"sync",value:function(e){this.server=e,this.map.sync(e),this.users.forEach((function(t){return t.sync(e)}))}},{key:"me",get:function(){return this.users.find((function(e){return e instanceof k}))}},{key:"otherUsers",get:function(){return this.users.filter((function(e){return!(e instanceof k)}))}},{key:"window",get:function(){return this.me.isScanning?new j((this.map.height+1)/2|0,this.map.width,!1):this._window}}],[{key:"restore",value:function(t){var n=t.id,i=t.map,r=t.users,a=t._window;return new e(n,T.restore(i),r.map((function(e){return b.restore(e)})),j.restore(a))}}]),e}(),J=(n(45),[x,M,F,N,L,U,A,G,R,K,P,C,q]);function B(e){var t=e.game,n=t.me,a=t.map,s=Object(i.useState)(0),h=Object(c.a)(s,2),l=h[0],d=h[1],m=Object(i.useState)(0),v=Object(c.a)(m,2),w=v[0],p=v[1];Object(i.useEffect)((function(){var e=function(e){e.preventDefault();var t=0,i=0;switch(e.key){case"ArrowDown":t++;break;case"ArrowUp":t--;break;case"ArrowLeft":i--;break;case"ArrowRight":i++}t/=5,i/=5,n.delta=new g(t,i)},i=function(e){n.delta=new g(0,0)},r=function(e){var t=e.beta,i=-e.gamma/360,r=t/360;n.delta=new g(i,r)},a=function(){t._window.resize()};return document.addEventListener("keydown",e),document.addEventListener("keyup",i),window.addEventListener("resize",a),window.addEventListener("deviceorientation",r,!0),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",i),window.removeEventListener("resize",a),window.removeEventListener("deviceorientation",r)}}),[t._window,n]),Object(i.useEffect)((function(){var e=window.setInterval((function(){d(Math.random())}),1e3/30);return function(){window.clearInterval(e)}}),[]),Object(i.useEffect)((function(){if(n.isScanning){var e=n.angle,t=w,i=Math.PI/300,r=e-t,s=Math.abs(r);if(0===s)return;s>Math.PI?t-=r/s*i:t+=r/s*i,t%=2*Math.PI,p(t)}else{var o=n.pos,u=n.nextPos;J.some((function(e){return a.has(new g(u.x,o.y),e)}))&&(u.x=o.x),J.some((function(e){return a.has(new g(o.x,u.y),e)}))&&(u.y=o.y);var h=!1,l=Object(c.a)(y.indices,2),d=l[0],f=l[1],m=new g(d,f);b.forEach((function(e,t){e.forEach((function(e,i){var r=m.plus(new g(t,i));(e&z)>0&&r.distanceTo(u)<2&&(n.isScanning=!0,h=!0)}))})),h||(n.pos=u)}}),[l]);var y=n.pos.minus(t.window.center).minus(new g(3,3)),b=a.crop(y,t.window.height+7,t.window.width+7),k=Object(i.useRef)(null),j=k.current;if(j){var O,E=j.getContext("2d");E.clearRect(0,0,j.width,j.height);var S=(O={},Object(o.a)(O,z,["#ffe300",2]),Object(o.a)(O,L,["#606060",1]),Object(o.a)(O,_,["#808080",1]),Object(o.a)(O,I,["#ff6600",1]),O),x=Object.keys(S);a.forEach((function(e,t){e.forEach((function(e,n){var i=x.find((function(t){return(t&e)>0}));if(i in S){var r=Object(c.a)(S[i],2),a=r[0],s=r[1];E.fillStyle=a,E.fillRect(n-s,t-s,2*s+1,2*s+1)}}))})),t.otherUsers.forEach((function(e){E.fillStyle=e.teamId===n.teamId?"#00FF00":"#FF0000",E.fillRect(e.pos.y-1,e.pos.x-1,3,3)})),E.fillStyle="#FFFFFF",E.fillRect(n.pos.y-1,n.pos.x-1,3,3),E.strokeStyle="#FFFFFF",E.strokeRect(y.y+2,y.x+2,t.window.width+2,t.window.height+2)}return r.a.createElement("div",{className:"GameRenderer",onTouchStart:function(){return n.isFlashing=!0},onTouchEnd:function(){return n.isFlashing=!1},onMouseDown:function(){return n.isFlashing=!0},onMouseUp:function(){return n.isFlashing=!1},onClick:function(){n.isScanning?n.isScanning=!1:n.hasKey&&(a.add(n.pos,I),n.hasKey=!1)}},r.a.createElement("div",{className:u("grid",n.isScanning&&"scan"),style:{marginTop:"calc(".concat((n.pos.x+.5|0)-n.pos.x-3," * ").concat(t.window.gridSize,")"),marginLeft:"calc(".concat((n.pos.y+.5|0)-n.pos.y-3," * ").concat(t.window.gridSize,")"),paddingLeft:n.isScanning?"calc((100vh - 100vw) / 2)":""}},b.map((function(e,n){return r.a.createElement("div",{className:"row",key:n},e.map((function(e,i){var a=["divider","rock0","rock1","rock2","tree","tower","jail","key","border_top","border_bottom","border_left","border_right","border_top_left","border_top_right","border_bottom_left","border_bottom_right"].filter((function(t,n){return(e&1<<n)>0}));return a.length>0&&r.a.createElement("div",{className:"col",key:i,style:{left:"calc(".concat(i," * ").concat(t.window.gridSize,")")}},a.map((function(e){return r.a.createElement("div",{key:e,className:u("block",e),style:{zIndex:["divider","key"].includes(e)?0:y.indices[0]+n}})})))})))}))),t.otherUsers.map((function(e,i){return r.a.createElement(f,{key:i,className:"character",user:e,style:{zIndex:e.pos.indices[0],top:"calc(".concat(e.pos.x-n.pos.x+t.window.center.x," * ").concat(t.window.gridSize,")"),left:"calc(".concat(e.pos.y-n.pos.y+t.window.center.y," * ").concat(t.window.gridSize,")")}})})),!n.isScanning&&r.a.createElement(f,{className:"character",user:n,style:{zIndex:n.pos.indices[0],top:"calc(".concat(t.window.center.x," * ").concat(t.window.gridSize,")"),left:"calc(".concat(t.window.center.y," * ").concat(t.window.gridSize,")")}}),!n.isScanning&&r.a.createElement("div",{className:u("illumination",n.isFlashing&&"flash"),style:{marginTop:"calc(".concat(t.window.center.x," * ").concat(t.window.gridSize,")"),marginLeft:"calc(".concat(t.window.center.y," * ").concat(t.window.gridSize,")")}}),n.isScanning&&r.a.createElement("div",{className:"spotlight",style:{transform:"rotate(".concat(w/Math.PI*180,"deg)")}}),!n.isScanning&&r.a.createElement("div",{className:"minimap"},r.a.createElement("canvas",{ref:k,className:"canvas",height:a.height,width:a.width})))}var H=n(35),W=n.n(H);var Q=function(e){var t=e.socket,n=Object(i.useState)([]),a=Object(c.a)(n,2),s=a[0],o=a[1];return Object(i.useEffect)((function(){t.on("listGames",o)}),[t]),r.a.createElement("div",{className:"Lobby"},r.a.createElement("div",{className:"roomList"},s.map((function(e){return r.a.createElement("div",{className:"room",key:e,onClick:function(){t.emit("joinGame",e)}},e)}))),r.a.createElement("button",{className:"create",onClick:function(){var e=new T(161,81),n=new D(d,e,[],new j(11,22));t.emit("createGame",n.id,n)}},"Create a Game"))};var V=function(){var e=Object(i.useRef)(null),t=e.current,n=Object(i.useState)(null),a=Object(c.a)(n,2),s=a[0],o=a[1],u=Object(i.useState)(null),h=Object(c.a)(u,2),d=h[0],f=h[1];return Object(i.useEffect)((function(){var e=W.a.connect("https://launchyourownchinesemissle.space");return o(e),function(){e.disconnect()}}),[]),Object(i.useEffect)((function(){if(s){var e={updateGame:function(e){return s.emit("updateGame",e)},updateMap:function(e,t,n){return s.emit("updateMap",d.id,e,t,n)},updateUser:function(e){return s.emit("updateUser",d.id,e)}};d&&d.sync(e);var t=function(e){var t=D.restore(e);t.users.push(new k(l,0,t.map.getSpawnPos(t.users.length))),f(t),s.emit("updateGame",t)},n=function(t){if(d){var n=D.restore(t);d.sync(null),Object.assign(d,n),d.sync(e)}},i=function(e,t,n){d&&(d.map.map[e][t]=n)},r=function(t){if(d){var n=b.restore(t),i=d.users.find((function(e){return e.uuid===n.uuid}));i&&(i.sync(null),Object.assign(i,n),i.sync(e))}};return s.on("joinGame",t),s.on("updateGame",n),s.on("updateMap",i),s.on("updateUser",r),function(){s.removeListener("joinGame",t),s.removeListener("updateGame",n),s.removeListener("updateMap",i),s.removeListener("updateUser",r)}}}),[d,s]),r.a.createElement("div",{className:"App",ref:e,onClick:function(){document.fullscreenElement||t&&t.requestFullscreen}},d&&r.a.createElement(B,{game:d}),!d&&s&&r.a.createElement(Q,{socket:s}))};s.a.render(r.a.createElement(V,null),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.a2989cbe.chunk.js.map
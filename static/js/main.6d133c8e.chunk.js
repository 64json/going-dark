(this["webpackJsonpcapture-the-flag"]=this["webpackJsonpcapture-the-flag"]||[]).push([[0],{37:function(e,t,n){e.exports=n(78)},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},74:function(e,t){},77:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(32),s=n.n(a),o=(n(42),n(1)),c=(n(43),n(4)),u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return e})).join(" ")},h=function(e){return e*e},l=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);Math.random().toString(36).substring(2,15),Math.random().toString(36).substring(2,15),n(44);var d=function(e){var t,n=e.className,i=e.user,a=e.style,s=e.reversed,o=i.delta.magnitude>.05;return t=Math.abs(i.delta.x)>Math.abs(i.delta.y)?i.delta.x*(s?-1:1)<0?"top":"bottom":i.delta.y*(s?-1:1)<0?"left":"right",r.a.createElement("div",{className:u("Character","team_".concat(i.teamId),o&&"moving",t,n),style:a},r.a.createElement("div",{className:u("holding",i.hasOwnKey||i.hasStolenKey?"key":"lamp")}))},f=n(2),m=n(3),v=n(35),g=n(33),y=n(36),p=function(){function e(t,n){Object(f.a)(this,e),this.x=t,this.y=n}return Object(m.a)(e,[{key:"plus",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"distanceTo",value:function(e){return Math.sqrt(h(this.x-e.x)+h(this.y-e.y))}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"indices",get:function(){return[Math.round(this.x),Math.round(this.y)]}},{key:"magnitude",get:function(){return Math.sqrt(h(this.x)+h(this.y))}},{key:"teamId",get:function(){return this.x<80?0:this.x>80?1:-1}}],[{key:"restore",value:function(t){return new e(t.x,t.y)}}]),e}(),w=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new p(0,0),a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Object(f.a)(this,e),this.uuid=t,this.teamId=n,this._pos=i,this._delta=r,this._hasOwnKey=a,this._hasStolenKey=s,this._isFlashing=o,this._isScanning=c}return Object(m.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"isOurBase",value:function(e){return this.teamId===e.teamId}},{key:"isInJail",value:function(){return this.pos.x<4||this.pos.x>156}},{key:"pos",get:function(){return this.isScanning?new p([40,120][this._pos.teamId],40):this._pos},set:function(e){this.isScanning||this._pos.equals(e)||(this._pos=e,this.server&&this.server.updateUser(this))}},{key:"delta",get:function(){return this._delta},set:function(e){this._delta.equals(e)||(this._delta=e,this.server&&this.server.updateUser(this))}},{key:"hasOwnKey",get:function(){return this._hasOwnKey},set:function(e){this._hasOwnKey=e,this.server&&this.server.updateUser(this)}},{key:"hasStolenKey",get:function(){return this._hasStolenKey},set:function(e){this._hasStolenKey=e,this.server&&this.server.updateUser(this)}},{key:"isFlashing",get:function(){return this._isFlashing},set:function(e){this._isFlashing=e,this.server&&this.server.updateUser(this)}},{key:"isScanning",get:function(){return this._isScanning},set:function(e){this._isScanning=e,this.server&&this.server.updateUser(this)}},{key:"angle",get:function(){return Math.atan2(-this.delta.y,this.delta.x)}},{key:"nextPos",get:function(){return this.pos.plus(this.delta)}}],[{key:"restore",value:function(t){var n=t.uuid,i=t.teamId,r=t._pos,a=t._delta,s=t._hasOwnKey,o=t._hasStolenKey,c=t._isFlashing,u=t._isScanning;return new(n===l?b:e)(n,i,p.restore(r),p.restore(a),s,o,c,u)}}]),e}(),b=function(e){function t(){return Object(f.a)(this,t),Object(v.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),t}(w),k=function(){function e(t,n){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object(f.a)(this,e),this.height=t,this.width=n,i&&this.resize()}return Object(m.a)(e,[{key:"resize",value:function(){this.width=window.innerHeight/window.innerWidth*this.height+.5|0}},{key:"gridSize",get:function(){return"".concat((100/this.height).toFixed(2),"vw")}},{key:"center",get:function(){return new p(this.height/2|0,this.width/2|0)}}],[{key:"restore",value:function(t){return new e(t.height,t.width)}}]),e}(),O=n(5),j=new Array(31).fill(0).map((function(e,t){return 1<<t})),_=Object(o.a)(j,16),E=_[0],S=_[1],x=_[2],I=_[3],M=_[4],F=_[5],K=_[6],N=_[7],A=_[8],P=_[9],L=_[10],C=_[11],z=_[12],T=_[13],U=_[14],G=_[15],R=function(){function e(t,n,i){Object(f.a)(this,e),this.height=t,this.width=n,i?this.map=i:(this.map=new Array(t).fill(0).map((function(e,i){return new Array(n).fill(0).map((function(e,r){var a=0,s=0===i,o=i===t-1,c=0===r,u=r===n-1;return s&&c?a|=z:s&&u?a|=T:o&&c?a|=U:o&&u?a|=G:s?a|=A:o?a|=P:c?a|=L:u?a|=C:80===i?a|=E:4===i||i===t-1-4?a|=K:Math.random()<.01?a|=[S,x,I][3*Math.random()|0]:Math.random()<.02&&(a|=M),a}))})),this.map[40][n/2|0]|=F,this.map[t-1-40][n/2|0]|=F)}return Object(m.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"crop",value:function(e,t,n){var i=Object(o.a)(e.indices,2),r=i[0],a=i[1],s=0,c=0,u=0,h=0;return r<0&&(s=-r,r=0,t-=s),a<0&&(u=-a,a=0,n-=u),r+t>=this.height&&(t-=c=r+t-this.height),a+n>=this.width&&(h=a+n-this.width,n-=h),[].concat(Object(O.a)(new Array(s).fill(0).map((function(){return new Array(n).fill(0)}))),Object(O.a)(this.map.slice(r,r+t).map((function(e){return[].concat(Object(O.a)(new Array(u).fill(0)),Object(O.a)(e.slice(a,a+n)),Object(O.a)(new Array(h).fill(0)))}))),Object(O.a)(new Array(c).fill(0).map((function(){return new Array(n).fill(0)}))))}},{key:"add",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],r=n[1];this.map[i][r]|=t,this.server&&this.server.updateMap(i,r,this.map[i][r])}},{key:"remove",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],r=n[1];this.map[i][r]&=~t,this.server&&this.server.updateMap(i,r,this.map[i][r])}},{key:"clear",value:function(e){var t=Object(o.a)(e.indices,2),n=t[0],i=t[1];this.map[n][i]=0,this.server&&this.server.updateMap(n,i,this.map[n][i])}},{key:"has",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],r=n[1];return(this.map[i][r]&t)>0}},{key:"forEach",value:function(e){return this.map.forEach(e)}},{key:"center",get:function(){return new p(this.height/2|0,this.width/2|0)}}],[{key:"restore",value:function(t){return new e(t.height,t.width,t.map)}}]),e}(),q=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(f.a)(this,e),this.id=t,this._scanAngle=n,this._achievedKeyCount=i}return Object(m.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"scanAngle",get:function(){return this._scanAngle},set:function(e){this._scanAngle=e,this.server&&this.server.updateTeam(this)}},{key:"achievedKeyCount",get:function(){return this._achievedKeyCount},set:function(e){this._achievedKeyCount=e,this.server&&this.server.updateTeam(this)}}],[{key:"restore",value:function(t){return new e(t.id,t._scanAngle,t._achievedKeyCount)}}]),e}(),J=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[new q(0,0),new q(1,Math.PI)],a=arguments.length>4?arguments[4]:void 0;Object(f.a)(this,e),this.id=t,this.map=n,this.users=i,this.teams=r,this._window=a}return Object(m.a)(e,[{key:"sync",value:function(e){this.server=e,this.map.sync(e),this.users.forEach((function(t){return t.sync(e)})),this.teams.forEach((function(t){return t.sync(e)}))}},{key:"getSpawnPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new p([5+t,this.map.height-1-5-t][e],this.map.center.y);return this.map.clear(n),n}},{key:"getJailPos",value:function(e){return new p([3,this.map.height-1-3][e],40)}},{key:"getJailX",value:function(e){return[4,this.map.height-4][e]}},{key:"getProgress",value:function(e){var t=this.users.filter((function(t){return t.teamId!==e}));return this.teams[e].achievedKeyCount/t.length}},{key:"me",get:function(){return this.users.find((function(e){return e instanceof b}))}},{key:"allies",get:function(){var e=this,t=this.me.teamId;return this.users.filter((function(n){return n!==e.me&&n.teamId===t}))}},{key:"enemies",get:function(){var e=this.me.teamId;return this.users.filter((function(t){return t.teamId!==e}))}},{key:"otherUsers",get:function(){return this.users.filter((function(e){return!(e instanceof b)}))}},{key:"window",get:function(){return this.me.isScanning?new k((this.map.height+1)/2|0,this.map.width,!1):this._window}},{key:"done",get:function(){var e=this;return this.teams.some((function(t){return e.getProgress(t.id)>=1}))}},{key:"win",get:function(){return this.getProgress(this.me.teamId)>=1}}],[{key:"restore",value:function(t){var n=t.id,i=t.map,r=t.users,a=t.teams,s=t._window;return new e(n,R.restore(i),r.map(w.restore),a.map(q.restore),k.restore(s))}}]),e}(),B=(n(45),[S,x,I,M,K,A,P,L,C,z,T,U,G]);function D(e){var t=e.game,n=t.me,a=t.map,s=t.teams,h=Object(i.useState)(0),l=Object(o.a)(h,2),f=l[0],m=l[1],v=0===n.teamId;Object(i.useEffect)((function(){var e=function(e){e.preventDefault();var t=0,i=0;switch(e.key){case"ArrowDown":t++;break;case"ArrowUp":t--;break;case"ArrowLeft":i--;break;case"ArrowRight":i++}t/=1,i/=1,v&&(t*=-1,i*=-1),n.delta=new p(t,i)},i=function(e){n.delta=new p(0,0)},r=function(e){var t=e.beta,i=-e.gamma/360,r=t/360;v&&(i*=-1,r*=-1),n.delta=new p(i,r)},a=function(){t._window.resize()};return document.addEventListener("keydown",e),document.addEventListener("keyup",i),window.addEventListener("resize",a),window.addEventListener("deviceorientation",r,!0),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",i),window.removeEventListener("resize",a),window.removeEventListener("deviceorientation",r)}}),[t._window,n]),Object(i.useEffect)((function(){var e=window.setInterval((function(){m(Math.random())}),1e3/30);return function(){window.clearInterval(e)}}),[]),Object(i.useEffect)((function(){if(n.isScanning){var e=n.angle,i=s[n.pos.teamId].scanAngle,r=Math.PI/300,c=e-i,u=Math.abs(c);if(0===u)return;u>Math.PI?i-=c/u*r:i+=c/u*r,i%=2*Math.PI,s[n.pos.teamId].scanAngle=i}else{var h=n.pos,l=n.nextPos,d=[].concat(B);n.hasOwnKey&&d.push(E),d.some((function(e){return a.has(new p(l.x,h.y),e)}))&&(l.x=h.x),d.some((function(e){return a.has(new p(h.x,l.y),e)}))&&(l.y=h.y);var f=!1,m=Object(o.a)(g.indices,2),v=m[0],w=m[1],b=new p(v,w);if(y.forEach((function(e,t){e.forEach((function(e,i){var r=b.plus(new p(t,i));(e&F)>0&&r.distanceTo(l)<2&&(n.isScanning=!0,f=!0)}))})),!f&&(n.pos=l,n.hasStolenKey&&n.teamId===n.pos.teamId&&(n.hasStolenKey=!1,s[n.teamId].achievedKeyCount++),n.isOurBase(n.pos))){var k=t.enemies.find((function(e){return e.pos.distanceTo(n.pos)<1}));k&&(k.hasStolenKey&&(a.add(k.pos,N),k.hasStolenKey=!1),k.pos=t.getJailPos(n.teamId))}}}),[f]);var g=n.pos.minus(t.window.center).minus(new p(6,6)),y=a.crop(g,t.window.height+12,t.window.width+12),w=Math.round(g.x)-g.x-6,b=Math.round(g.y)-g.y-6,k=Object(i.useRef)(null),O=k.current;if(O){var j,_=O.getContext("2d");_.clearRect(0,0,O.width,O.height);var S=(j={},Object(c.a)(j,F,["#ffe300",2]),Object(c.a)(j,K,["#606060",1]),Object(c.a)(j,E,["#808080",1]),Object(c.a)(j,N,["#ff6600",1]),j),x=Object.keys(S);a.forEach((function(e,t){e.forEach((function(e,i){var r=x.find((function(t){return(t&e)>0}));if((r!==N.toString()||n.isOurBase(new p(t,i)))&&r in S){var a=Object(o.a)(S[r],2),s=a[0],c=a[1];_.fillStyle=s,_.fillRect(i-c,t-c,2*c+1,2*c+1)}}))})),t.allies.forEach((function(e){_.fillStyle=e.teamId===n.teamId?"#00FF00":"#FF0000",_.fillRect(e.pos.y-1,e.pos.x-1,3,3)})),_.fillStyle="#FFFFFF",_.fillRect(n.pos.y-1,n.pos.x-1,3,3),_.strokeStyle="#FFFFFF",_.strokeRect(n.pos.y-t.window.center.y-1,n.pos.x-t.window.center.x-1,t.window.width+2,t.window.height+2)}return r.a.createElement("div",{className:"GameRenderer",onTouchStart:function(){return n.isFlashing=!0},onTouchEnd:function(){return n.isFlashing=!1},onMouseDown:function(){return n.isFlashing=!0},onMouseUp:function(){return n.isFlashing=!1},onClick:function(){var e=t.allies.filter((function(e){return e.isInJail()&&e.pos.distanceTo(n.pos)<5}));n.isScanning?n.isScanning=!1:n.hasOwnKey?(a.add(n.pos,N),n.hasOwnKey=!1):e.length>0?e.forEach((function(e,i){e.pos=t.getSpawnPos(n.teamId,i)})):n.hasStolenKey||y.forEach((function(e,t){e.forEach((function(e,i){var r=new p(g.x+t,g.y+i);(e&N)>0&&n.pos.distanceTo(r)<1&&r.teamId!==n.teamId&&(a.remove(r,N),n.hasStolenKey=!0)}))}))}},r.a.createElement("div",{className:u("grid",n.isScanning&&"scan")},y.map((function(e,i){return r.a.createElement("div",{className:"row",key:i,style:Object(c.a)({},v?"bottom":"top","calc(".concat(i+w," * ").concat(t.window.gridSize,")"))},e.map((function(e,a){var s=["divider","rock0","rock1","rock2","tree","tower","jail","key",v?"border_bottom":"border_top",v?"border_top":"border_bottom",v?"border_right":"border_left",v?"border_left":"border_right",v?"border_bottom_right":"border_top_left",v?"border_bottom_left":"border_top_right",v?"border_top_right":"border_bottom_left",v?"border_top_left":"border_bottom_right"].filter((function(t,n){return(e&1<<n)>0}));return s.length>0&&r.a.createElement("div",{className:"col",key:a,style:Object(c.a)({},v?"right":"left","calc(".concat(a+b," * ").concat(t.window.gridSize).concat(n.isScanning?" + (100vh - 100vw) / 2":"",")"))},s.map((function(e){return r.a.createElement("div",{key:e,className:u("block",e),style:{zIndex:["divider","key"].includes(e)?0:(g.indices[0]+i)*(v?-1:1)+2*t.map.height}})})))})))}))),t.users.map((function(e,i){var a;return r.a.createElement(d,{key:i,className:"character",user:e,style:(a={zIndex:e.pos.indices[0]*(v?-1:1)+2*t.map.height},Object(c.a)(a,v?"bottom":"top","calc(".concat(e.pos.x-n.pos.x+t.window.center.x," * ").concat(t.window.gridSize,")")),Object(c.a)(a,v?"right":"left","calc(".concat(e.pos.y-n.pos.y+t.window.center.y," * ").concat(t.window.gridSize).concat(n.isScanning?" + (100vh - 100vw) / 2":"",")")),a),reversed:v})})),!n.isScanning&&r.a.createElement("div",{className:u("illumination",n.isFlashing&&"flash"),style:{marginTop:"calc(".concat(t.window.center.x," * ").concat(t.window.gridSize,")"),marginLeft:"calc(".concat(t.window.center.y," * ").concat(t.window.gridSize,")")}}),n.isScanning&&r.a.createElement("div",{className:"spotlight",style:{transform:"rotate(".concat(s[n.pos.teamId].scanAngle/Math.PI*180,"deg)")}}),!n.isScanning&&r.a.createElement("div",{className:u("minimap",v&&"reversed")},r.a.createElement("canvas",{ref:k,className:"canvas",height:a.height,width:a.width})),!n.isScanning&&r.a.createElement("div",{className:"progress-container"},r.a.createElement("div",{className:"progress-bar"},r.a.createElement("div",{className:"progress enemy",style:{width:"".concat(100*t.getProgress(1-n.teamId),"%")}})),r.a.createElement("div",{className:"progress-bar"},r.a.createElement("div",{className:"progress ally",style:{width:"".concat(100*t.getProgress(n.teamId),"%")}}))),t.done&&(t.win?r.a.createElement("div",{className:"done win"}):r.a.createElement("div",{className:"done lose"})))}var H=n(34),W=n.n(H);n(77);var X=function(e){var t=e.socket,n=Object(i.useState)([]),a=Object(o.a)(n,2),s=a[0],c=a[1],u=Object(i.useState)(""),h=Object(o.a)(u,2),l=h[0],d=h[1];return Object(i.useEffect)((function(){t.on("listGames",c)}),[t]),r.a.createElement("div",{className:"Lobby"},r.a.createElement("div",{className:"logo"}),r.a.createElement("div",{className:"room-list"},s.map((function(e){return r.a.createElement("div",{className:"room",key:e,onClick:function(){t.emit("joinGame",e)}},e)}))),r.a.createElement("div",{className:"create-container"},r.a.createElement("input",{className:"room-name",type:"text",value:l,onChange:function(e){var t=e.target;return d(t.value)}}),r.a.createElement("button",{className:"create",onClick:function(){var e=new R(161,81),n=new J(l,e,void 0,void 0,new k(11,22));t.emit("createGame",n.id,n)}},"Create a Game")))};var Q=function(){var e=Object(i.useRef)(null),t=e.current,n=Object(i.useState)(null),a=Object(o.a)(n,2),s=a[0],c=a[1],u=Object(i.useState)(null),h=Object(o.a)(u,2),d=h[0],f=h[1];return Object(i.useEffect)((function(){var e=W.a.connect("http://172.24.96.188:8080");return c(e),function(){e.disconnect()}}),[]),Object(i.useEffect)((function(){if(s){var e={updateGame:function(e){return s.emit("updateGame",e)},updateMap:function(e,t,n){return s.emit("updateMap",d.id,e,t,n)},updateUser:function(e){return s.emit("updateUser",d.id,e)},updateTeam:function(e){return s.emit("updateTeam",d.id,e)}};d&&d.sync(e);var t=function(e){var t=J.restore(e),n=2*t.users.filter((function(e){return 0===e.teamId})).length<t.users.length?0:1,i=t.users.filter((function(e){return e.teamId===n}));t.users.push(new b(l,n,t.getSpawnPos(n,i.length))),f(t),s.emit("updateGame",t)},n=function(t){if(d){var n=J.restore(t);d.sync(null),Object.assign(d,n),d.sync(e)}},i=function(e,t,n){d&&(d.map.map[e][t]=n)},r=function(t){if(d){var n=w.restore(t),i=d.users.find((function(e){return e.uuid===n.uuid}));i&&(i.sync(null),Object.assign(i,n),i.sync(e))}},a=function(t){if(d){var n=q.restore(t),i=d.teams.find((function(e){return e.id===n.id}));i&&(i.sync(null),Object.assign(i,n),i.sync(e))}};return s.on("joinGame",t),s.on("updateGame",n),s.on("updateMap",i),s.on("updateUser",r),s.on("updateTeam",a),function(){s.removeListener("joinGame",t),s.removeListener("updateGame",n),s.removeListener("updateMap",i),s.removeListener("updateUser",r),s.removeListener("updateTeam",a)}}}),[d,s]),r.a.createElement("div",{className:"App",ref:e,onClick:function(){document.fullscreenElement||t&&t.requestFullscreen&&t.requestFullscreen().catch(alert)}},d&&r.a.createElement(D,{game:d}),!d&&s&&r.a.createElement(X,{socket:s}))};s.a.render(r.a.createElement(Q,null),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.6d133c8e.chunk.js.map
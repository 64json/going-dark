{"version":3,"sources":["utils.js","Character.js","beans/Pos.js","beans/User.js","beans/Window.js","blocks.js","beans/Map.js","beans/Game.js","GameRenderer.js","Lobby.js","App.js","index.js"],"names":["classes","vs","filter","v","join","sq","x","UUID","Math","random","toString","substring","RANDOM_GAME_ID","Character","direction","className","user","style","moving","delta","magnitude","abs","y","teamId","hasKey","Pos","this","pos","sqrt","round","posJson","User","uuid","isFlashing","isScanning","_pos","_delta","_hasKey","_isFlashing","_isScanning","server","equals","updateUser","atan2","plus","userJson","Me","restore","Window","height","width","resize","window","innerHeight","innerWidth","toFixed","windowJson","Array","fill","map","_","i","DIVIDER","ROCK0","ROCK1","ROCK2","TREE","TOWER","JAIL","KEY","BORDER_TOP","BORDER_BOTTOM","BORDER_LEFT","BORDER_RIGHT","BORDER_TOP_LEFT","BORDER_TOP_RIGHT","BORDER_BOTTOM_LEFT","BORDER_BOTTOM_RIGHT","Map","j","flag","top","bottom","left","right","indices","slice","row","updateMap","callback","forEach","userCount","center","clear","mapJson","Game","id","users","_window","sync","find","me","gameJson","obstacles","GameRenderer","game","useState","frame","setFrame","scanAngle","setScanAngle","useEffect","onKeyDown","e","preventDefault","dx","dy","key","onKeyUp","onTilt","beta","gamma","onResize","document","addEventListener","removeEventListener","timer","setInterval","clearInterval","aimingAngle","angle","currentAngle","unit","PI","currentPos","nextPos","some","obstacle","has","stop","crop","offsetI","offsetJ","offset","croppedMap","blockPos","distanceTo","minus","minimapRef","useRef","canvas","current","ctx","getContext","clearRect","attrMap","blocks","Object","keys","block","color","size","fillStyle","fillRect","otherUsers","strokeStyle","strokeRect","onTouchStart","onTouchEnd","onMouseDown","onMouseUp","onClick","add","marginTop","gridSize","marginLeft","paddingLeft","k","length","zIndex","includes","transform","ref","Lobby","socket","gameIds","setGameIds","on","gameId","emit","App","appRef","app","setSocket","setGame","io","connect","disconnect","updateGame","updatedGame","value","updatedUser","handleJoinGame","push","getSpawnPos","handleUpdateGame","assign","handleUpdateMap","handleUpdateUser","removeListener","fullscreenElement","requestFullscreen","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.a2989cbe.chunk.js","sourcesContent":["export const classes = (...vs) => vs.filter(v => v).join(' ');\n\nexport const sq = x => x * x;\n\nexport const UUID = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n\nexport const RANDOM_GAME_ID = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);;","import React from 'react';\nimport './Character.scss';\nimport { classes } from './utils';\n\nfunction Character({ className, user, style }) {\n  const movingThreshold = .05;\n  const moving = user.delta.magnitude > movingThreshold;\n  let direction;\n  if (Math.abs(user.delta.x) > Math.abs(user.delta.y)) {\n    direction = user.delta.x < 0 ? 'top' : 'bottom';\n  } else {\n    direction = user.delta.y < 0 ? 'left' : 'right';\n  }\n  return (\n    <div className={classes('Character', `team_${user.teamId}`, moving && 'moving', direction, className)}\n         style={style}>\n      <div className={classes('holding', user.hasKey ? 'key' : 'lamp')}/>\n    </div>\n  );\n}\n\nexport default Character;","import { sq } from '../utils';\n\nexport class Pos {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  static restore(posJson) {\n    const { x, y } = posJson;\n    return new Pos(x, y);\n  }\n\n  plus(pos) {\n    return new Pos(this.x + pos.x, this.y + pos.y);\n  }\n\n  minus(pos) {\n    return new Pos(this.x - pos.x, this.y - pos.y);\n  }\n\n  clone() {\n    return new Pos(this.x, this.y);\n  }\n\n  distanceTo(pos) {\n    return Math.sqrt(sq(this.x - pos.x) + sq(this.y - pos.y));\n  }\n\n  get indices() {\n    return [Math.round(this.x), Math.round(this.y)];\n  }\n\n  get magnitude() {\n    return Math.sqrt(sq(this.x) + sq(this.y));\n  }\n\n  equals(pos) {\n    return this.x === pos.x && this.y === pos.y;\n  }\n}\n","import { Pos } from './Pos';\nimport { UUID } from '../utils';\n\nexport class User {\n  constructor(uuid, teamId, pos, delta = new Pos(0, 0), hasKey = true, isFlashing = false, isScanning = false) {\n    this.uuid = uuid;\n    this.teamId = teamId;\n    this._pos = pos;\n    this._delta = delta;\n    this._hasKey = hasKey;\n    this._isFlashing = isFlashing;\n    this._isScanning = isScanning;\n  }\n\n  static restore(userJson) {\n    const { uuid, teamId, _pos, _delta, _hasKey, _isFlashing, _isScanning } = userJson;\n    const UserClass = uuid === UUID ? Me : User;\n    return new UserClass(uuid, teamId, Pos.restore(_pos), Pos.restore(_delta), _hasKey, _isFlashing, _isScanning);\n  }\n\n  sync(server) {\n    this.server = server;\n  }\n\n  get pos() {\n    if (this.isScanning) {\n      return new Pos(40, 40);\n    }\n    return this._pos;\n  }\n\n  set pos(pos) {\n    if (this.isScanning) {\n      return;\n    }\n    if (this._pos.equals(pos)) {\n      return;\n    }\n    this._pos = pos;\n    this.server && this.server.updateUser(this);\n  }\n\n  get delta() {\n    return this._delta;\n  }\n\n  set delta(delta) {\n    if (this._delta.equals(delta)) {\n      return;\n    }\n    this._delta = delta;\n    this.server && this.server.updateUser(this);\n  }\n\n  get hasKey() {\n    return this._hasKey;\n  }\n\n  set hasKey(hasKey) {\n    this._hasKey = hasKey;\n    this.server && this.server.updateUser(this);\n  }\n\n  get isFlashing() {\n    return this._isFlashing;\n  }\n\n  set isFlashing(isFlashing) {\n    this._isFlashing = isFlashing;\n    this.server && this.server.updateUser(this);\n  }\n\n  get isScanning(){\n    return this._isScanning;\n  }\n\n  set isScanning(isScanning){\n    this._isScanning = isScanning;\n    this.server && this.server.updateUser(this);\n  }\n\n  get angle() {\n    return Math.atan2(-this.delta.y, this.delta.x);\n  }\n\n  get nextPos() {\n    return this.pos.plus(this.delta);\n  }\n}\n\nexport class Me extends User {\n}","import { Pos } from './Pos';\n\nexport class Window {\n  constructor(height, width, resize = true) {\n    this.height = height;\n    this.width = width;\n    if (resize) this.resize();\n  }\n\n  static restore(windowJson) {\n    const { height, width } = windowJson;\n    return new Window(height, width);\n  }\n\n  get gridSize() {\n    return `${(100 / this.height).toFixed(2)}vw`;\n  }\n\n  get center() {\n    return new Pos(\n      this.height / 2 | 0,\n      this.width / 2 | 0,\n    );\n  }\n\n  resize() {\n    this.width = window.innerHeight / window.innerWidth * this.height + .5 | 0;\n  }\n}","export const [\n  DIVIDER,\n  ROCK0,\n  ROCK1,\n  ROCK2,\n  TREE,\n  TOWER,\n  JAIL,\n  KEY,\n  BORDER_TOP,\n  BORDER_BOTTOM,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT,\n] = new Array(31).fill(0).map((_, i) => 1 << i);\n","import {\n  BORDER_BOTTOM,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  DIVIDER,\n  JAIL,\n  ROCK0,\n  ROCK1,\n  ROCK2,\n  TOWER,\n  TREE,\n} from '../blocks';\nimport { Pos } from './Pos';\n\nexport class Map {\n  constructor(height, width, map) {\n    this.height = height;\n    this.width = width;\n    if (map) {\n      this.map = map;\n    } else {\n      this.map = new Array(height).fill(0).map((_, i) =>\n        new Array(width).fill(0).map((_, j) => {\n          let flag = 0;\n\n          const top = i === 0;\n          const bottom = i === height - 1;\n          const left = j === 0;\n          const right = j === width - 1;\n          if (top && left) flag |= BORDER_TOP_LEFT;\n          else if (top && right) flag |= BORDER_TOP_RIGHT;\n          else if (bottom && left) flag |= BORDER_BOTTOM_LEFT;\n          else if (bottom && right) flag |= BORDER_BOTTOM_RIGHT;\n          else if (top) flag |= BORDER_TOP;\n          else if (bottom) flag |= BORDER_BOTTOM;\n          else if (left) flag |= BORDER_LEFT;\n          else if (right) flag |= BORDER_RIGHT;\n          else if (i === 80) flag |= DIVIDER;\n          else if (i === 4 || i === height - 1 - 4) flag |= JAIL;\n          else if (Math.random() < .01) flag |= [ROCK0, ROCK1, ROCK2][Math.random() * 3 | 0];\n          else if (Math.random() < .02) flag |= TREE;\n          return flag;\n        }));\n      this.map[40][width / 2 | 0] |= TOWER;\n      this.map[height - 1 - 40][width / 2 | 0] |= TOWER;\n    }\n  }\n\n  static restore(mapJson) {\n    const { height, width, map } = mapJson;\n    return new Map(height, width, map);\n  }\n\n  sync(server) {\n    this.server = server;\n  }\n\n  crop(pos, height, width) {\n    const [i, j] = pos.indices;\n    const rows = i < 0\n      ? [...new Array(-i).fill(0).map(() => new Array(width).fill(0)), ...this.map.slice(0, i + height)]\n      : this.map.slice(i, i + height);\n    return rows.map(row => j < 0\n      ? [...new Array(-j).fill(0), ...row.slice(0, j + width)]\n      : row.slice(j, j + width),\n    );\n  }\n\n  add(pos, flag) {\n    const [i, j] = pos.indices;\n    this.map[i][j] |= flag;\n    this.server && this.server.updateMap(i, j, this.map[i][j]);\n  }\n\n  remove(pos, flag) {\n    const [i, j] = pos.indices;\n    this.map[i][j] &= ~flag;\n    this.server && this.server.updateMap(i, j, this.map[i][j]);\n  }\n\n  clear(pos) {\n    const [i, j] = pos.indices;\n    this.map[i][j] = 0;\n    this.server && this.server.updateMap(i, j, this.map[i][j]);\n  }\n\n  has(pos, flag) {\n    const [i, j] = pos.indices;\n    return (this.map[i][j] & flag) > 0;\n  }\n\n  forEach(callback) {\n    return this.map.forEach(callback);\n  }\n\n  get center() {\n    return new Pos(\n      this.height / 2 | 0,\n      this.width / 2 | 0,\n    );\n  }\n\n  getSpawnPos(userCount = 0) {\n    const pos = new Pos(this.height - 6 - userCount, this.center.y);\n    this.clear(pos);\n    return pos;\n  }\n}","import { Me, User } from './User';\nimport { Window } from './Window';\nimport { Map } from './Map';\n\nexport class Game {\n  constructor(id, map, users, window) {\n    this.id = id;\n    this.map = map;\n    this.users = users;\n    this._window = window;\n  }\n\n  static restore(gameJson) {\n    const { id, map, users, _window } = gameJson;\n    return new Game(id, Map.restore(map), users.map(user => User.restore(user)), Window.restore(_window));\n  }\n\n  sync(server) {\n    this.server = server;\n    this.map.sync(server);\n    this.users.forEach(user => user.sync(server));\n  }\n\n  get me() {\n    return this.users.find(user => user instanceof Me);\n  }\n\n  get otherUsers() {\n    return this.users.filter(user => !(user instanceof Me));\n  }\n\n  get window() {\n    if (this.me.isScanning) {\n      return new Window((this.map.height + 1) / 2 | 0, this.map.width, false);\n    }\n    return this._window;\n  }\n}","import React, { useEffect, useRef, useState } from 'react';\nimport { classes } from './utils';\nimport Character from './Character';\nimport { Pos } from './beans';\nimport {\n  BORDER_BOTTOM,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  DIVIDER,\n  JAIL,\n  KEY,\n  ROCK0,\n  ROCK1,\n  ROCK2,\n  TOWER,\n  TREE,\n} from './blocks';\nimport './GameRenderer.scss';\n\nconst obstacles = [ROCK0, ROCK1, ROCK2, TREE, JAIL,\n  BORDER_TOP,\n  BORDER_BOTTOM,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT];\nconst FPS = 30;\n\nexport function GameRenderer({ game }) {\n  const { me, map } = game;\n  const [frame, setFrame] = useState(0);\n  const [scanAngle, setScanAngle] = useState(0);\n\n  useEffect(() => {\n    const onKeyDown = e => {\n      e.preventDefault();\n      let dx = 0;\n      let dy = 0;\n      switch (e.key) {\n        case 'ArrowDown':\n          dx++;\n          break;\n        case 'ArrowUp':\n          dx--;\n          break;\n        case 'ArrowLeft':\n          dy--;\n          break;\n        case 'ArrowRight':\n          dy++;\n          break;\n        default:\n      }\n      dx /= 5;\n      dy /= 5;\n      me.delta = new Pos(dx, dy);\n    };\n\n    const onKeyUp = e => {\n      me.delta = new Pos(0, 0);\n    };\n\n    const onTilt = e => {\n      const beta = e.beta;\n      const gamma = e.gamma;\n      const dx = -gamma / 360;\n      const dy = beta / 360;\n      me.delta = new Pos(dx, dy);\n    };\n\n    const onResize = () => {\n      game._window.resize();\n    };\n\n    document.addEventListener('keydown', onKeyDown);\n    document.addEventListener('keyup', onKeyUp);\n    window.addEventListener('resize', onResize);\n    window.addEventListener('deviceorientation', onTilt, true);\n    return () => {\n      document.removeEventListener('keydown', onKeyDown);\n      document.removeEventListener('keyup', onKeyUp);\n      window.removeEventListener('resize', onResize);\n      window.removeEventListener('deviceorientation', onTilt);\n    };\n  }, [game._window, me]);\n\n  useEffect(() => {\n    const timer = window.setInterval(() => {\n      setFrame(Math.random());\n    }, 1000 / FPS);\n    return () => {\n      window.clearInterval(timer);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (me.isScanning) {\n      const aimingAngle = me.angle;\n      let currentAngle = scanAngle;\n      const unit = Math.PI / 300;\n      const delta = aimingAngle - currentAngle;\n      const magnitude = Math.abs(delta);\n      if (magnitude === 0) return;\n      if (magnitude > Math.PI) {\n        currentAngle -= delta / magnitude * unit;\n      } else {\n        currentAngle += delta / magnitude * unit;\n      }\n      currentAngle %= Math.PI * 2;\n      setScanAngle(currentAngle);\n    } else {\n      const currentPos = me.pos;\n      const nextPos = me.nextPos;\n      if (obstacles.some(obstacle => map.has(new Pos(nextPos.x, currentPos.y), obstacle))) {\n        nextPos.x = currentPos.x;\n      }\n      if (obstacles.some(obstacle => map.has(new Pos(currentPos.x, nextPos.y), obstacle))) {\n        nextPos.y = currentPos.y;\n      }\n      let stop = false;\n      const [offsetI, offsetJ] = crop.indices;\n      const offset = new Pos(offsetI, offsetJ);\n      croppedMap.forEach((row, i) => {\n        row.forEach((flag, j) => {\n          const blockPos = offset.plus(new Pos(i, j));\n          if ((flag & TOWER) > 0 && blockPos.distanceTo(nextPos) < 2) {\n            me.isScanning = true;\n            stop = true;\n          }\n        });\n      });\n      if (!stop) {\n        me.pos = nextPos;\n      }\n    }\n  }, [frame]);\n\n  const crop = me.pos.minus(game.window.center).minus(new Pos(3, 3));\n\n  const croppedMap = map.crop(crop, game.window.height + 7, game.window.width + 7);\n\n  const minimapRef = useRef(null);\n  const canvas = minimapRef.current;\n  if (canvas) {\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    const attrMap = {\n      [TOWER]: ['#ffe300', 2],\n      [JAIL]: ['#606060', 1],\n      [DIVIDER]: ['#808080', 1],\n      [KEY]: ['#ff6600', 1],\n    };\n    const blocks = Object.keys(attrMap);\n    map.forEach((row, i) => {\n      row.forEach((flag, j) => {\n        const block = blocks.find(block => (block & flag) > 0);\n        if (block in attrMap) {\n          const [color, size] = attrMap[block];\n          ctx.fillStyle = color;\n          ctx.fillRect(j - size, i - size, size * 2 + 1, size * 2 + 1);\n        }\n      });\n    });\n\n    game.otherUsers.forEach(user => {\n      ctx.fillStyle = user.teamId === me.teamId ? '#00FF00' : '#FF0000';\n      ctx.fillRect(user.pos.y - 1, user.pos.x - 1, 3, 3);\n    });\n\n    ctx.fillStyle = '#FFFFFF';\n    ctx.fillRect(me.pos.y - 1, me.pos.x - 1, 3, 3);\n\n    ctx.strokeStyle = '#FFFFFF';\n    ctx.strokeRect(crop.y + 2, crop.x + 2, game.window.width + 2, game.window.height + 2);\n  }\n\n  return (\n    <div className=\"GameRenderer\"\n         onTouchStart={() => me.isFlashing = true} onTouchEnd={() => me.isFlashing = false}\n         onMouseDown={() => me.isFlashing = true} onMouseUp={() => me.isFlashing = false}\n         onClick={() => {\n           if (me.isScanning) {\n             me.isScanning = false;\n           } else if (me.hasKey) {\n             map.add(me.pos, KEY);\n             me.hasKey = false;\n           }\n         }}>\n      <div className={classes('grid', me.isScanning && 'scan')} style={{\n        marginTop: `calc(${(me.pos.x + .5 | 0) - me.pos.x - 3} * ${game.window.gridSize})`,\n        marginLeft: `calc(${(me.pos.y + .5 | 0) - me.pos.y - 3} * ${game.window.gridSize})`,\n        paddingLeft: me.isScanning ? `calc((100vh - 100vw) / 2)` : '',\n      }}>\n        {\n          croppedMap.map((row, i) => (\n            <div className=\"row\" key={i}>\n              {\n                row.map((flag, j) => {\n                  const blocks = ['divider', 'rock0', 'rock1', 'rock2', 'tree', 'tower', 'jail', 'key',\n                    'border_top',\n                    'border_bottom',\n                    'border_left',\n                    'border_right',\n                    'border_top_left',\n                    'border_top_right',\n                    'border_bottom_left',\n                    'border_bottom_right']\n                    .filter((_, k) => (flag & (1 << k)) > 0);\n                  return blocks.length > 0 && (\n                    <div className=\"col\" key={j} style={{\n                      left: `calc(${j} * ${game.window.gridSize})`,\n                    }}>\n                      {\n                        blocks.map(block => (\n                          <div key={block} className={classes('block', block)} style={{\n                            zIndex: ['divider', 'key'].includes(block) ? 0 : crop.indices[0] + i,\n                          }}>\n                          </div>\n                        ))\n                      }\n                    </div>\n                  );\n                })\n              }\n            </div>\n          ))\n        }\n      </div>\n      {\n        game.otherUsers.map((user, i) => (\n          <Character key={i} className=\"character\" user={user} style={{\n            zIndex: user.pos.indices[0],\n            top: `calc(${user.pos.x - me.pos.x + game.window.center.x} * ${game.window.gridSize})`,\n            left: `calc(${user.pos.y - me.pos.y + game.window.center.y} * ${game.window.gridSize})`,\n          }}/>\n        ))\n      }\n      {\n        !me.isScanning &&\n        <Character className=\"character\" user={me} style={{\n          zIndex: me.pos.indices[0],\n          top: `calc(${game.window.center.x} * ${game.window.gridSize})`,\n          left: `calc(${game.window.center.y} * ${game.window.gridSize})`,\n        }}/>\n      }\n      {\n        !me.isScanning &&\n        <div className={classes('illumination', me.isFlashing && 'flash')} style={{\n          marginTop: `calc(${game.window.center.x} * ${game.window.gridSize})`,\n          marginLeft: `calc(${game.window.center.y} * ${game.window.gridSize})`,\n        }}/>\n      }\n      {\n        me.isScanning &&\n        <div className=\"spotlight\" style={{\n          transform: `rotate(${scanAngle / Math.PI * 180}deg)`,\n        }}/>\n      }\n      {\n        !me.isScanning &&\n        <div className=\"minimap\">\n          <canvas ref={minimapRef} className=\"canvas\" height={map.height} width={map.width}/>\n        </div>\n      }\n    </div>\n  );\n}","import React, { useEffect, useState } from 'react';\nimport './Character.scss';\nimport { Game, Map, Window } from './beans';\nimport { RANDOM_GAME_ID } from './utils';\n\nfunction Lobby({ socket }) {\n  const [gameIds, setGameIds] = useState([]);\n\n  useEffect(() => {\n    socket.on('listGames', setGameIds);\n  }, [socket]);\n  return (\n    <div className=\"Lobby\">\n      <div className=\"roomList\">\n        {\n          gameIds.map(gameId => (\n            <div className=\"room\" key={gameId} onClick={() => {\n              socket.emit('joinGame', gameId);\n            }}>\n              {gameId}\n            </div>\n          ))\n        }\n      </div>\n      <button className=\"create\" onClick={() => {\n        const map = new Map(161, 81);\n        const game = new Game(RANDOM_GAME_ID, map, [], new Window(11, 22));\n        socket.emit('createGame', game.id, game);\n      }}>Create a Game\n      </button>\n    </div>\n  );\n}\n\nexport default Lobby;","import React, { useEffect, useRef, useState } from 'react';\nimport './App.scss';\nimport { GameRenderer } from './GameRenderer';\nimport io from 'socket.io-client';\nimport Lobby from './Lobby';\nimport { Game, Me, User } from './beans';\nimport { UUID } from './utils';\n\nfunction App() {\n  const appRef = useRef(null);\n  const app = appRef.current;\n  const [socket, setSocket] = useState(null);\n  const [game, setGame] = useState(null);\n\n  useEffect(() => {\n    const socket = io.connect('https://launchyourownchinesemissle.space');\n    setSocket(socket);\n\n    return () => {\n      socket.disconnect();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!socket) return;\n\n    const server = {\n      updateGame: updatedGame => socket.emit('updateGame', updatedGame),\n      updateMap: (i, j, value) => socket.emit('updateMap', game.id, i, j, value),\n      updateUser: (updatedUser) => socket.emit('updateUser', game.id, updatedUser),\n    };\n\n    if (game) {\n      game.sync(server);\n    }\n\n    const handleJoinGame = gameJson => {\n      const game = Game.restore(gameJson);\n      game.users.push(new Me(UUID, 0, game.map.getSpawnPos(game.users.length)));\n      setGame(game);\n      socket.emit('updateGame', game);\n    };\n\n    const handleUpdateGame = gameJson => {\n      if (!game) return;\n      const updatedGame = Game.restore(gameJson);\n      game.sync(null);\n      Object.assign(game, updatedGame);\n      game.sync(server);\n    };\n\n    const handleUpdateMap = (i, j, value) => {\n      if (!game) return;\n      game.map.map[i][j] = value;\n    };\n\n    const handleUpdateUser = userJson => {\n      if (!game) return;\n      const updatedUser = User.restore(userJson);\n      const user = game.users.find(user => user.uuid === updatedUser.uuid);\n      if (!user) return;\n      user.sync(null);\n      Object.assign(user, updatedUser);\n      user.sync(server);\n    };\n\n    socket.on('joinGame', handleJoinGame);\n    socket.on('updateGame', handleUpdateGame);\n    socket.on('updateMap', handleUpdateMap);\n    socket.on('updateUser', handleUpdateUser);\n\n    return () => {\n      socket.removeListener('joinGame', handleJoinGame);\n      socket.removeListener('updateGame', handleUpdateGame);\n      socket.removeListener('updateMap', handleUpdateMap);\n      socket.removeListener('updateUser', handleUpdateUser);\n    };\n  }, [game, socket]);\n\n  return (\n    <div className=\"App\" ref={appRef}\n         onClick={() => {\n           if (!document.fullscreenElement) {\n             if (app && app.requestFullscreen) {\n               // app.requestFullscreen().catch(alert);\n             }\n           }\n         }}>\n      {\n        game &&\n        <GameRenderer game={game}/>\n      }\n      {\n        !game && socket &&\n        <Lobby socket={socket}/>\n      }\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\n\nReactDOM.render(<App/>, document.getElementById('root'));\n"],"sourceRoot":""}
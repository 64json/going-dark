{"version":3,"sources":["utils.js","Character.js","App.js","index.js"],"names":["classes","vs","filter","v","join","Character","direction","className","teamId","dx","dy","style","mx","Math","abs","my","moving","Array","fill","map","_","i","GRASS","DIVIDER","ROCK0","ROCK1","ROCK2","TREE","TOWER","JAIL","BORDER_TOP","BORDER_BOTTOM","BORDER_LEFT","BORDER_RIGHT","BORDER_TOP_LEFT","BORDER_TOP_RIGHT","BORDER_BOTTOM_LEFT","BORDER_BOTTOM_RIGHT","obstacles","App","mapHeight","mapWidth","windowHeight","useState","setDelta","x","y","setPos","frame","setFrame","windowWidth","setWindowWidth","height","width","j","flag","top","bottom","left","right","random","initMap","dummy","setDummy","useEffect","onKeyDown","e","preventDefault","console","log","key","onKeyUp","onTilt","absolute","alpha","beta","gamma","onResize","window","innerHeight","innerWidth","document","addEventListener","removeEventListener","nx","ny","xFlag","mapCx","mapCy","some","obstacle","yFlag","windowCx","windowCy","mapSx","mapSy","croppedMap","slice","row","crop","offsetX","offsetY","minimapRef","useRef","canvas","current","ctx","getContext","clearRect","colorMap","blocks","Object","keys","forEach","block","find","fillStyle","fillRect","strokeStyle","strokeRect","marginTop","marginLeft","k","zIndex","includes","ref","JSON","stringify","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.e33a8560.chunk.js","sourcesContent":["export const classes = (...vs) => vs.filter(v => v).join(' ');\n","import React from 'react';\nimport './Character.scss';\nimport { classes } from './utils';\n\nfunction Character({ className, teamId, dx, dy, style }) {\n  const movingThreshold = .2;\n  const mx = Math.abs(dx);\n  const my = Math.abs(dy);\n  const moving = mx > movingThreshold || my > movingThreshold;\n  let direction;\n  if (mx > my) {\n    direction = dx < 0 ? 'top' : 'bottom';\n  } else {\n    direction = dy < 0 ? 'left' : 'right';\n  }\n  return (\n    <div className={classes('Character', `team_${teamId}`, moving && 'moving', direction, className)} style={style}>\n    </div>\n  );\n}\n\nexport default Character;","import React, { useEffect, useRef, useState } from 'react';\nimport './App.scss';\nimport Character from './Character';\nimport { classes } from './utils';\n\nconst [\n  GRASS,\n  DIVIDER,\n  ROCK0,\n  ROCK1,\n  ROCK2,\n  TREE,\n  TOWER,\n  JAIL,\n  KEY,\n  BORDER_TOP,\n  BORDER_BOTTOM,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT,\n] = new Array(31).fill(0).map((_, i) => 1 << i);\nconst obstacles = [ROCK0, ROCK1, ROCK2, TREE, TOWER, JAIL,\n  BORDER_TOP,\n  BORDER_BOTTOM,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT];\n\nfunction initMap(height, width) {\n  const map = new Array(height).fill(0).map((_, i) =>\n    new Array(width).fill(0).map((_, j) => {\n      let flag = GRASS;\n\n      const top = i === 0;\n      const bottom = i === height - 1;\n      const left = j === 0;\n      const right = j === width - 1;\n      if (top && left) flag |= BORDER_TOP_LEFT;\n      else if (top && right) flag |= BORDER_TOP_RIGHT;\n      else if (bottom && left) flag |= BORDER_BOTTOM_LEFT;\n      else if (bottom && right) flag |= BORDER_BOTTOM_RIGHT;\n      else if (top) flag |= BORDER_TOP;\n      else if (bottom) flag |= BORDER_BOTTOM;\n      else if (left) flag |= BORDER_LEFT;\n      else if (right) flag |= BORDER_RIGHT;\n      else {\n        if (Math.random() < .01) flag |= [ROCK0, ROCK1, ROCK2][Math.random() * 3 | 0];\n        if (Math.random() < .02) flag |= TREE;\n        if (i === 4 || i === height - 1 - 4) flag |= JAIL;\n        if (i === 80) flag |= DIVIDER;\n      }\n      return flag;\n    }));\n  map[40][width / 2 | 0] |= TOWER;\n  map[height - 1 - 40][width / 2 | 0] |= TOWER;\n  return map;\n}\n\nfunction crop(map, i, j, height, width) {\n  const rows = i < 0\n    ? [...new Array(-i).fill(0).map(() => new Array(width).fill(0)), ...map.slice(0, i + height)]\n    : map.slice(i, i + height);\n  return rows.map(row => j < 0\n    ? [...new Array(-j).fill(0), ...row.slice(0, j + width)]\n    : row.slice(j, j + width),\n  );\n}\n\nfunction App({ mapHeight, mapWidth, windowHeight }) {\n  const [[dx, dy], setDelta] = useState([0, 0]);\n  const [[x, y], setPos] = useState([0, 0]);\n  const [frame, setFrame] = useState(0);\n  const [windowWidth, setWindowWidth] = useState(windowHeight * 2 | 0);\n  const [map, setMap] = useState(initMap(mapHeight, mapWidth));\n  const [dummy, setDummy] = useState('');\n\n\n  useEffect(() => {\n    const onKeyDown = e => {\n      e.preventDefault();\n      console.log(e.key);\n      let dx = 0;\n      let dy = 0;\n      switch (e.key) {\n        case 'ArrowDown':\n          dx++;\n          break;\n        case 'ArrowUp':\n          dx--;\n          break;\n        case 'ArrowLeft':\n          dy--;\n          break;\n        case 'ArrowRight':\n          dy++;\n          break;\n        default:\n      }\n      dx /= 1.2;\n      dy /= 1.2;\n      setDelta([dx, dy]);\n      setFrame(Math.random());\n    };\n\n    const onKeyUp = e => {\n      setDelta([0, 0]);\n    };\n\n    const onTilt = e => {\n      const absolute = e.absolute;\n      const alpha = e.alpha;\n      const beta = e.beta;\n      const gamma = e.gamma;\n      const dx = gamma / 180 / 10;\n      const dy = beta / 180 / 10;\n      setDelta([dx, dy]);\n      setFrame(Math.random());\n      setDummy({\n        absolute,\n        alpha,\n        beta,\n        gamma,\n      });\n    };\n\n    const onResize = () => {\n      setWindowWidth(window.innerHeight / window.innerWidth * windowHeight + .5 | 0);\n    };\n    onResize();\n\n    document.addEventListener('keydown', onKeyDown);\n    document.addEventListener('keyup', onKeyUp);\n    window.addEventListener('resize', onResize);\n    window.addEventListener('deviceorientation', onTilt, true);\n    return () => {\n      document.removeEventListener('keydown', onKeyDown);\n      document.removeEventListener('keyup', onKeyUp);\n      window.removeEventListener('resize', onResize);\n      window.removeEventListener('deviceorientation', onTilt);\n    };\n  }, []);\n\n  useEffect(() => {\n    let nx = x + dx;\n    let ny = y + dy;\n    const xFlag = map[mapCx + nx + .5 | 0][mapCy + y + .5 | 0];\n    if (obstacles.some(obstacle => (obstacle & xFlag) > 0)) {\n      nx = x;\n    }\n    const yFlag = map[mapCx + x + .5 | 0][mapCy + ny + .5 | 0];\n    if (obstacles.some(obstacle => (obstacle & yFlag) > 0)) {\n      ny = y;\n    }\n    setPos([nx, ny]);\n  }, [frame]);\n\n  const mapCx = mapHeight / 2 | 0;\n  const mapCy = mapWidth / 2 | 0;\n  const windowCx = windowHeight / 2 | 0;\n  const windowCy = windowWidth / 2 | 0;\n\n  const mapSx = mapCx + (x | 0) - windowCx;\n  const mapSy = mapCy + (y | 0) - windowCy;\n\n  const croppedMap = crop(map, mapSx - 1, mapSy - 1, windowHeight + 2, windowWidth + 2);\n\n  const offsetX = (x | 0) - x;\n  const offsetY = (y | 0) - y;\n\n  const minimapRef = useRef(null);\n  const canvas = minimapRef.current;\n  if (canvas) {\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    const colorMap = {\n      [TOWER]: '#ffe300',\n      [JAIL]: '#49320f',\n    };\n    const blocks = Object.keys(colorMap);\n    map.forEach((row, i) => {\n      row.forEach((flag, j) => {\n        const block = blocks.find(block => (block & flag) > 0);\n        if (block in colorMap) {\n          ctx.fillStyle = colorMap[block];\n          ctx.fillRect(j * 2 - 2, i * 2 - 2, 5, 5);\n        }\n      });\n    });\n    ctx.fillStyle = '#00FF00';\n    ctx.fillRect((mapCy + (y | 0)) * 2 - 2, (mapCx + (x | 0)) * 2 - 2, 5, 5);\n    ctx.strokeStyle = '#FF0000';\n    ctx.strokeRect(mapSy * 2, mapSx * 2, windowWidth * 2, windowHeight * 2);\n  }\n\n  return (\n    <div className=\"App\">\n      <div className=\"game\">\n        <div className=\"grid\" style={{\n          marginTop: `calc(${offsetX - 1} * 9.09vw)`,\n          marginLeft: `calc(${offsetY - 1} * 9.09vw)`,\n        }}>\n          {\n            croppedMap.map((row, i) => (\n              <div className=\"row\" key={i}>\n                {\n                  row.map((flag, j) => {\n                    return (\n                      <div className=\"col\" key={j}>\n                        {\n                          ['grass', 'divider', 'rock0', 'rock1', 'rock2', 'tree', 'tower', 'jail', 'key',\n                            'border_top',\n                            'border_bottom',\n                            'border_left',\n                            'border_right',\n                            'border_top_left',\n                            'border_top_right',\n                            'border_bottom_left',\n                            'border_bottom_right']\n                            .filter((_, k) => (flag & (1 << k)) > 0)\n                            .map(block => (\n                              <div key={block} className={classes('block', block)} style={{\n                                zIndex: ['grass', 'divider'].includes(block) ? 0 : x + 1 < (x | 0) - windowCx + i ? 2 : 0,\n                              }}>\n                              </div>\n                            ))\n                        }\n                      </div>\n                    );\n                  })\n                }\n              </div>\n            ))\n          }\n        </div>\n        <Character className=\"character\" teamId={0} dx={dx} dy={dy} style={{\n          top: `calc(${windowCx} * 9.09vw)`,\n          left: `calc(${windowCy} * 9.09vw)`,\n        }}/>\n        <div className=\"illumination\" style={{\n          marginTop: `calc(${windowCx} * 9.09vw)`,\n          marginLeft: `calc(${windowCy} * 9.09vw)`,\n        }}/>\n        <div className=\"overlay\">\n          <div className=\"minimap\">\n            <canvas ref={minimapRef} className=\"canvas\" height=\"322\" width=\"162\"/>\n          </div>\n        </div>\n      </div>\n      <div className=\"dummy\">{JSON.stringify(dummy)}</div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\n\nReactDOM.render(<App mapHeight={161} mapWidth={81}\n                     windowHeight={11}/>, document.getElementById('root'));\n"],"sourceRoot":""}
(this["webpackJsonpcapture-the-flag"]=this["webpackJsonpcapture-the-flag"]||[]).push([[0],{37:function(e,t,n){e.exports=n(78)},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},74:function(e,t){},77:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),r=n(32),s=n.n(r),o=(n(42),n(1)),c=(n(43),n(3)),u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return e})).join(" ")},h=function(e){return e*e},l=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);Math.random().toString(36).substring(2,15),Math.random().toString(36).substring(2,15),n(44);var d=function(e){var t,n=e.className,i=e.user,r=e.style,s=e.reversed,o=i.delta.magnitude>.05;return t=Math.abs(i.delta.x)>Math.abs(i.delta.y)?i.delta.x*(s?-1:1)<0?"top":"bottom":i.delta.y*(s?-1:1)<0?"left":"right",a.a.createElement("div",{className:u("Character","team_".concat(i.teamId),o&&"moving",t,n),style:r},a.a.createElement("div",{className:u("holding",i.hasOwnKey||i.hasStolenKey?"key":"lamp")}))},f=n(2),m=n(4),v=n(35),g=n(33),y=n(36),p=function(){function e(t,n){Object(f.a)(this,e),this.x=t,this.y=n}return Object(m.a)(e,[{key:"plus",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"distanceTo",value:function(e){return Math.sqrt(h(this.x-e.x)+h(this.y-e.y))}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"indices",get:function(){return[Math.round(this.x),Math.round(this.y)]}},{key:"magnitude",get:function(){return Math.sqrt(h(this.x)+h(this.y))}},{key:"teamId",get:function(){return this.x<80?0:this.x>80?1:-1}}],[{key:"restore",value:function(t){return new e(t.x,t.y)}}]),e}(),w=function(){function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new p(0,0),r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Object(f.a)(this,e),this.uuid=t,this.teamId=n,this._pos=i,this._delta=a,this._hasOwnKey=r,this._hasStolenKey=s,this._isFlashing=o,this._isScanning=c}return Object(m.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"isOurBase",value:function(e){return this.teamId===e.teamId}},{key:"isInJail",value:function(){return this.pos.x<4||this.pos.x>156}},{key:"pos",get:function(){return this.isScanning?new p([40,120][this._pos.teamId],40):this._pos},set:function(e){this.isScanning||this._pos.equals(e)||(this._pos=e,this.server&&this.server.updateUser(this))}},{key:"delta",get:function(){return this._delta},set:function(e){this._delta.equals(e)||(this._delta=e,this.server&&this.server.updateUser(this))}},{key:"hasOwnKey",get:function(){return this._hasOwnKey},set:function(e){this._hasOwnKey=e,this.server&&this.server.updateUser(this)}},{key:"hasStolenKey",get:function(){return this._hasStolenKey},set:function(e){this._hasStolenKey=e,this.server&&this.server.updateUser(this)}},{key:"isFlashing",get:function(){return this._isFlashing},set:function(e){this._isFlashing=e,this.server&&this.server.updateUser(this)}},{key:"isScanning",get:function(){return this._isScanning},set:function(e){this._isScanning=e,this.server&&this.server.updateUser(this)}},{key:"angle",get:function(){return Math.atan2(-this.delta.y,this.delta.x)}},{key:"nextPos",get:function(){return this.pos.plus(this.delta)}}],[{key:"restore",value:function(t){var n=t.uuid,i=t.teamId,a=t._pos,r=t._delta,s=t._hasOwnKey,o=t._hasStolenKey,c=t._isFlashing,u=t._isScanning;return new(n===l?b:e)(n,i,p.restore(a),p.restore(r),s,o,c,u)}}]),e}(),b=function(e){function t(){return Object(f.a)(this,t),Object(v.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(y.a)(t,e),t}(w),k=function(){function e(t,n){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object(f.a)(this,e),this.height=t,this.width=n,i&&this.resize()}return Object(m.a)(e,[{key:"resize",value:function(){this.width=window.innerHeight/window.innerWidth*this.height+.5|0}},{key:"gridSize",get:function(){return"".concat((100/this.height).toFixed(2),"vw")}},{key:"center",get:function(){return new p(this.height/2|0,this.width/2|0)}}],[{key:"restore",value:function(t){return new e(t.height,t.width)}}]),e}(),O=n(5),j=new Array(31).fill(0).map((function(e,t){return 1<<t})),_=Object(o.a)(j,16),E=_[0],S=_[1],x=_[2],I=_[3],M=_[4],F=_[5],K=_[6],N=_[7],A=_[8],P=_[9],z=_[10],L=_[11],C=_[12],T=_[13],U=_[14],G=_[15],R=function(){function e(t,n,i){Object(f.a)(this,e),this.height=t,this.width=n,i?this.map=i:(this.map=new Array(t).fill(0).map((function(e,i){return new Array(n).fill(0).map((function(e,a){var r=0,s=0===i,o=i===t-1,c=0===a,u=a===n-1;return s&&c?r|=C:s&&u?r|=T:o&&c?r|=U:o&&u?r|=G:s?r|=A:o?r|=P:c?r|=z:u?r|=L:80===i?r|=E:4===i||i===t-1-4?r|=K:Math.random()<.01?r|=[S,x,I][3*Math.random()|0]:Math.random()<.02&&(r|=M),r}))})),this.map[40][n/2|0]|=F,this.map[t-1-40][n/2|0]|=F)}return Object(m.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"crop",value:function(e,t,n){var i=Object(o.a)(e.indices,2),a=i[0],r=i[1],s=0,c=0,u=0,h=0;return a<0&&(s=-a,a=0,t-=s),r<0&&(u=-r,r=0,n-=u),a+t>=this.height&&(t-=c=a+t-this.height),r+n>=this.width&&(h=r+n-this.width,n-=h),[].concat(Object(O.a)(new Array(s).fill(0).map((function(){return new Array(n).fill(0)}))),Object(O.a)(this.map.slice(a,a+t).map((function(e){return[].concat(Object(O.a)(new Array(u).fill(0)),Object(O.a)(e.slice(r,r+n)),Object(O.a)(new Array(h).fill(0)))}))),Object(O.a)(new Array(c).fill(0).map((function(){return new Array(n).fill(0)}))))}},{key:"add",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],a=n[1];this.map[i][a]|=t,this.server&&this.server.updateMap(i,a,this.map[i][a])}},{key:"remove",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],a=n[1];this.map[i][a]&=~t,this.server&&this.server.updateMap(i,a,this.map[i][a])}},{key:"clear",value:function(e){var t=Object(o.a)(e.indices,2),n=t[0],i=t[1];this.map[n][i]=0,this.server&&this.server.updateMap(n,i,this.map[n][i])}},{key:"has",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],a=n[1];return(this.map[i][a]&t)>0}},{key:"forEach",value:function(e){return this.map.forEach(e)}},{key:"center",get:function(){return new p(this.height/2|0,this.width/2|0)}}],[{key:"restore",value:function(t){return new e(t.height,t.width,t.map)}}]),e}(),q=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(f.a)(this,e),this.id=t,this._scanAngle=n,this._achievedKeyCount=i}return Object(m.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"scanAngle",get:function(){return this._scanAngle},set:function(e){this._scanAngle=e,this.server&&this.server.updateTeam(this)}},{key:"achievedKeyCount",get:function(){return this._achievedKeyCount},set:function(e){this._achievedKeyCount=e,this.server&&this.server.updateTeam(this)}}],[{key:"restore",value:function(t){return new e(t.id,t._scanAngle,t._achievedKeyCount)}}]),e}(),J=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[new q(0,0),new q(1,Math.PI)],r=arguments.length>4?arguments[4]:void 0;Object(f.a)(this,e),this.id=t,this.map=n,this.users=i,this.teams=a,this._window=r}return Object(m.a)(e,[{key:"sync",value:function(e){this.server=e,this.map.sync(e),this.users.forEach((function(t){return t.sync(e)})),this.teams.forEach((function(t){return t.sync(e)}))}},{key:"getSpawnPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new p([5+t,this.map.height-1-5-t][e],this.map.center.y);return this.map.clear(n),n}},{key:"getJailPos",value:function(e){return new p([3,this.map.height-1-3][e],40)}},{key:"getJailX",value:function(e){return[4,this.map.height-4][e]}},{key:"getProgress",value:function(e){var t=this.users.filter((function(t){return t.teamId!==e}));return this.teams[e].achievedKeyCount/t.length}},{key:"me",get:function(){return this.users.find((function(e){return e instanceof b}))}},{key:"allies",get:function(){var e=this,t=this.me.teamId;return this.users.filter((function(n){return n!==e.me&&n.teamId===t}))}},{key:"enemies",get:function(){var e=this.me.teamId;return this.users.filter((function(t){return t.teamId!==e}))}},{key:"otherUsers",get:function(){return this.users.filter((function(e){return!(e instanceof b)}))}},{key:"window",get:function(){return this.me.isScanning?new k((this.map.height+1)/2|0,this.map.width,!1):this._window}},{key:"done",get:function(){var e=this;return this.teams.some((function(t){return e.getProgress(t.id)>=1}))}},{key:"win",get:function(){return this.getProgress(this.me.teamId)>=1}}],[{key:"restore",value:function(t){var n=t.id,i=t.map,a=t.users,r=t.teams,s=t._window;return new e(n,R.restore(i),a.map(w.restore),r.map(q.restore),k.restore(s))}}]),e}(),B=(n(45),[S,x,I,M,K,A,P,z,L,C,T,U,G]);function D(e){var t,n=e.game,r=n.me,s=n.map,h=n.teams,l=Object(i.useState)(0),f=Object(o.a)(l,2),m=f[0],v=f[1],g=0===r.teamId;Object(i.useEffect)((function(){var e=function(e){e.preventDefault();var t=0,n=0;switch(e.key){case"ArrowDown":t++;break;case"ArrowUp":t--;break;case"ArrowLeft":n--;break;case"ArrowRight":n++}t/=1,n/=1,g&&(t*=-1,n*=-1),r.delta=new p(t,n)},t=function(e){r.delta=new p(0,0)},i=function(e){var t=e.beta,n=-e.gamma/120,i=t/120;g&&(n*=-1,i*=-1),r.delta=new p(n,i)},a=function(){n._window.resize()};return document.addEventListener("keydown",e),document.addEventListener("keyup",t),window.addEventListener("resize",a),window.addEventListener("deviceorientation",i,!0),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",t),window.removeEventListener("resize",a),window.removeEventListener("deviceorientation",i)}}),[n._window,r]),Object(i.useEffect)((function(){var e=window.setInterval((function(){v(Math.random())}),1e3/30);return function(){window.clearInterval(e)}}),[]),Object(i.useEffect)((function(){if(r.isScanning){var e=r.angle,t=h[r.pos.teamId].scanAngle,i=Math.PI/300,a=e-t,c=Math.abs(a);if(0===c)return;c>Math.PI?t-=a/c*i:t+=a/c*i,t%=2*Math.PI,h[r.pos.teamId].scanAngle=t}else{var u=r.pos,l=r.nextPos,d=[].concat(B);r.hasOwnKey&&d.push(E),d.some((function(e){return s.has(new p(l.x,u.y),e)}))&&(l.x=u.x),d.some((function(e){return s.has(new p(u.x,l.y),e)}))&&(l.y=u.y);var f=!1,m=Object(o.a)(y.indices,2),v=m[0],g=m[1],b=new p(v,g);if(w.forEach((function(e,t){e.forEach((function(e,n){var i=b.plus(new p(t,n));(e&F)>0&&i.distanceTo(l)<2&&(r.isScanning=!0,f=!0)}))})),!f&&(r.pos=l,r.hasStolenKey&&r.teamId===r.pos.teamId&&(r.hasStolenKey=!1,h[r.teamId].achievedKeyCount++),r.isOurBase(r.pos))){var k=n.enemies.find((function(e){return e.pos.distanceTo(r.pos)<1}));k&&(k.hasStolenKey&&(s.add(k.pos,N),k.hasStolenKey=!1),k.pos=n.getJailPos(r.teamId))}}}),[m]);var y=r.pos.minus(n.window.center).minus(new p(6,6)),w=s.crop(y,n.window.height+12,n.window.width+12),b=Math.round(y.x)-y.x-6,k=Math.round(y.y)-y.y-6,O=Object(i.useRef)(null),j=O.current;if(j){var _,S=j.getContext("2d");S.clearRect(0,0,j.width,j.height);var x=(_={},Object(c.a)(_,F,["#ffe300",2]),Object(c.a)(_,K,["#606060",1]),Object(c.a)(_,E,["#808080",1]),Object(c.a)(_,N,["#ff6600",1]),_),I=Object.keys(x);s.forEach((function(e,t){e.forEach((function(e,n){var i=I.find((function(t){return(t&e)>0}));if((i!==N.toString()||r.isOurBase(new p(t,n)))&&i in x){var a=Object(o.a)(x[i],2),s=a[0],c=a[1];S.fillStyle=s,S.fillRect(n-c,t-c,2*c+1,2*c+1)}}))})),n.allies.forEach((function(e){S.fillStyle=e.teamId===r.teamId?"#00FF00":"#FF0000",S.fillRect(e.pos.y-1,e.pos.x-1,3,3)})),S.fillStyle="#FFFFFF",S.fillRect(r.pos.y-1,r.pos.x-1,3,3),S.strokeStyle="#FFFFFF",S.strokeRect(r.pos.y-n.window.center.y-1,r.pos.x-n.window.center.x-1,n.window.width+2,n.window.height+2)}return a.a.createElement("div",{className:"GameRenderer",onTouchStart:function(){return r.isFlashing=!0},onTouchEnd:function(){return r.isFlashing=!1},onMouseDown:function(){return r.isFlashing=!0},onMouseUp:function(){return r.isFlashing=!1},onClick:function(){var e=n.allies.filter((function(e){return e.isInJail()&&e.pos.distanceTo(r.pos)<5}));r.isScanning?r.isScanning=!1:r.hasOwnKey?(s.add(r.pos,N),r.hasOwnKey=!1):e.length>0?e.forEach((function(e,t){e.pos=n.getSpawnPos(r.teamId,t)})):r.hasStolenKey||w.forEach((function(e,t){e.forEach((function(e,n){var i=new p(y.x+t,y.y+n);(e&N)>0&&r.pos.distanceTo(i)<1&&i.teamId!==r.teamId&&(s.remove(i,N),r.hasStolenKey=!0)}))}))}},a.a.createElement("div",{className:u("grid",r.isScanning&&"scan")},w.map((function(e,t){return a.a.createElement("div",{className:"row",key:t,style:Object(c.a)({},g?"bottom":"top","calc(".concat(t+b," * ").concat(n.window.gridSize,")"))},e.map((function(e,i){var s=["divider","rock0","rock1","rock2","tree","tower","jail","key",g?"border_bottom":"border_top",g?"border_top":"border_bottom",g?"border_right":"border_left",g?"border_left":"border_right",g?"border_bottom_right":"border_top_left",g?"border_bottom_left":"border_top_right",g?"border_top_right":"border_bottom_left",g?"border_top_left":"border_bottom_right"].filter((function(t,n){return(e&1<<n)>0}));return s.length>0&&a.a.createElement("div",{className:"col",key:i,style:Object(c.a)({},g?"right":"left","calc(".concat(i+k," * ").concat(n.window.gridSize).concat(r.isScanning?" + (100vh - 100vw) / 2":"",")"))},s.map((function(e){return a.a.createElement("div",{key:e,className:u("block",e),style:{zIndex:["divider","key"].includes(e)?0:(y.indices[0]+t)*(g?-1:1)+2*n.map.height}})})))})))}))),n.users.map((function(e,t){var i;return a.a.createElement(d,{key:t,className:"character",user:e,style:(i={zIndex:e.pos.indices[0]*(g?-1:1)+2*n.map.height},Object(c.a)(i,g?"bottom":"top","calc(".concat(e.pos.x-r.pos.x+n.window.center.x," * ").concat(n.window.gridSize,")")),Object(c.a)(i,g?"right":"left","calc(".concat(e.pos.y-r.pos.y+n.window.center.y," * ").concat(n.window.gridSize).concat(r.isScanning?" + (100vh - 100vw) / 2":"",")")),i),reversed:g})})),!r.isScanning&&a.a.createElement("div",{className:u("illumination",r.isFlashing&&"flash"),style:(t={},Object(c.a)(t,g?"marginBottom":"marginTop","calc(".concat(n.window.center.x," * ").concat(n.window.gridSize,")")),Object(c.a)(t,g?"marginRight":"marginLeft","calc(".concat(n.window.center.y," * ").concat(n.window.gridSize,")")),Object(c.a)(t,g?"bottom":"top","calc(-300vw + ".concat(n.window.gridSize," * .4 / 2)")),Object(c.a)(t,g?"right":"left","calc(-300vw + ".concat(n.window.gridSize," / 2)")),t)}),r.isScanning&&a.a.createElement("div",{className:"spotlight",style:{transform:"rotate(".concat(h[r.pos.teamId].scanAngle/Math.PI*180,"deg)")}}),!r.isScanning&&a.a.createElement("div",{className:u("minimap",g&&"reversed")},a.a.createElement("canvas",{ref:O,className:"canvas",height:s.height,width:s.width})),!r.isScanning&&a.a.createElement("div",{className:"progress-container"},a.a.createElement("div",{className:"progress-bar"},a.a.createElement("div",{className:"progress enemy",style:{width:"".concat(100*n.getProgress(1-r.teamId),"%")}})),a.a.createElement("div",{className:"progress-bar"},a.a.createElement("div",{className:"progress ally",style:{width:"".concat(100*n.getProgress(r.teamId),"%")}}))),n.done&&(n.win?a.a.createElement("div",{className:"done win"}):a.a.createElement("div",{className:"done lose"})))}var H=n(34),W=n.n(H);n(77);var X=function(e){var t=e.socket,n=Object(i.useState)([]),r=Object(o.a)(n,2),s=r[0],c=r[1],u=Object(i.useState)(""),h=Object(o.a)(u,2),l=h[0],d=h[1];return Object(i.useEffect)((function(){t.on("listGames",c)}),[t]),a.a.createElement("div",{className:"Lobby"},a.a.createElement("div",{className:"logo"}),a.a.createElement("div",{className:"room-list"},s.map((function(e){return a.a.createElement("div",{className:"room",key:e,onClick:function(){t.emit("joinGame",e)}},e)}))),a.a.createElement("div",{className:"create-container"},a.a.createElement("input",{className:"room-name",type:"text",value:l,onChange:function(e){var t=e.target;return d(t.value)}}),a.a.createElement("button",{className:"create",onClick:function(){var e=new R(161,81),n=new J(l,e,void 0,void 0,new k(11,22));t.emit("createGame",n.id,n)}},"Create a Game")))};var Q=function(){var e=Object(i.useRef)(null),t=e.current,n=Object(i.useState)(null),r=Object(o.a)(n,2),s=r[0],c=r[1],u=Object(i.useState)(null),h=Object(o.a)(u,2),d=h[0],f=h[1];return Object(i.useEffect)((function(){var e=W.a.connect("https://launchyourownchinesemissle.space");return c(e),function(){e.disconnect()}}),[]),Object(i.useEffect)((function(){if(s){var e={updateGame:function(e){return s.emit("updateGame",e)},updateMap:function(e,t,n){return s.emit("updateMap",d.id,e,t,n)},updateUser:function(e){return s.emit("updateUser",d.id,e)},updateTeam:function(e){return s.emit("updateTeam",d.id,e)}};d&&d.sync(e);var t=function(e){var t=J.restore(e),n=2*t.users.filter((function(e){return 0===e.teamId})).length<t.users.length?0:1,i=t.users.filter((function(e){return e.teamId===n}));t.users.push(new b(l,n,t.getSpawnPos(n,i.length))),f(t),s.emit("updateGame",t)},n=function(t){if(d){var n=J.restore(t);d.sync(null),Object.assign(d,n),d.sync(e)}},i=function(e,t,n){d&&(d.map.map[e][t]=n)},a=function(t){if(d){var n=w.restore(t),i=d.users.find((function(e){return e.uuid===n.uuid}));i&&(i.sync(null),Object.assign(i,n),i.sync(e))}},r=function(t){if(d){var n=q.restore(t),i=d.teams.find((function(e){return e.id===n.id}));i&&(i.sync(null),Object.assign(i,n),i.sync(e))}};return s.on("joinGame",t),s.on("updateGame",n),s.on("updateMap",i),s.on("updateUser",a),s.on("updateTeam",r),function(){s.removeListener("joinGame",t),s.removeListener("updateGame",n),s.removeListener("updateMap",i),s.removeListener("updateUser",a),s.removeListener("updateTeam",r)}}}),[d,s]),a.a.createElement("div",{className:"App",ref:e,onClick:function(){document.fullscreenElement||t&&t.requestFullscreen&&t.requestFullscreen().catch(alert)}},d&&a.a.createElement(D,{game:d}),!d&&s&&a.a.createElement(X,{socket:s}))};s.a.render(a.a.createElement(Q,null),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.ff6b4f4c.chunk.js.map
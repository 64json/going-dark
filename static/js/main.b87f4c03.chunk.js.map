{"version":3,"sources":["utils.js","Character.js","App.js","index.js"],"names":["classes","vs","filter","v","join","sq","x","Character","direction","className","teamId","dx","dy","style","holding","mx","Math","abs","my","moving","Array","fill","map","_","i","DIVIDER","ROCK0","ROCK1","ROCK2","TREE","TOWER","JAIL","KEY","BORDER_TOP","BORDER_BOTTOM","BORDER_LEFT","BORDER_RIGHT","BORDER_TOP_LEFT","BORDER_TOP_RIGHT","BORDER_BOTTOM_LEFT","BORDER_BOTTOM_RIGHT","obstacles","cloneMap","row","App","mapHeight","mapWidth","windowHeight","useState","setDelta","y","setPos","frame","setFrame","windowWidth","setWindowWidth","height","width","j","flag","top","bottom","left","right","random","initMap","setMap","flash","setFlash","scan","setScan","scanAngle","setScanAngle","setHolding","gridSize","useEffect","onKeyDown","e","preventDefault","console","log","key","onKeyUp","onTilt","absolute","alpha","beta","gamma","onResize","window","innerHeight","innerWidth","timer","setInterval","document","addEventListener","clearInterval","removeEventListener","aimingAngle","atan2","currentAngle","unit","PI","delta","magnitude","nx","ny","xFlag","mapCx","mapCy","some","obstacle","yFlag","stop","croppedMap","forEach","x1","y1","x2","y2","sqrt","distance","mapSx","mapSy","windowCx","windowCy","slice","crop","offsetX","offsetY","appRef","useRef","app","current","minimapRef","canvas","ctx","getContext","clearRect","attrMap","blocks","Object","keys","block","find","color","size","fillStyle","fillRect","strokeStyle","strokeRect","ref","onTouchStart","onTouchEnd","onMouseDown","onMouseUp","onClick","fullscreenElement","requestFullscreen","catch","alert","newMap","addToMap","marginTop","marginLeft","paddingLeft","k","length","zIndex","includes","transform","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.b87f4c03.chunk.js","sourcesContent":["export const classes = (...vs) => vs.filter(v => v).join(' ');\n\nexport const sq = x => x * x;\n\nexport const distance = ([x1, y1], [x2, y2]) => Math.sqrt(sq(x1 - x2) + sq(y1 - y2));\n","import React from 'react';\nimport './Character.scss';\nimport { classes } from './utils';\n\nfunction Character({ className, teamId, dx, dy, style, holding }) {\n  const movingThreshold = .05;\n  const mx = Math.abs(dx);\n  const my = Math.abs(dy);\n  const moving = mx > movingThreshold || my > movingThreshold;\n  let direction;\n  if (mx > my) {\n    direction = dx < 0 ? 'top' : 'bottom';\n  } else {\n    direction = dy < 0 ? 'left' : 'right';\n  }\n  return (\n    <div className={classes('Character', `team_${teamId}`, moving && 'moving', direction, className)} style={style}>\n      {\n        holding &&\n        <div className={classes('holding', holding)}/>\n      }\n    </div>\n  );\n}\n\nexport default Character;","import React, { useEffect, useRef, useState } from 'react';\nimport './App.scss';\nimport Character from './Character';\nimport { classes, distance } from './utils';\n\nconst [\n  DIVIDER,\n  ROCK0,\n  ROCK1,\n  ROCK2,\n  TREE,\n  TOWER,\n  JAIL,\n  KEY,\n  BORDER_TOP,\n  BORDER_BOTTOM,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT,\n] = new Array(31).fill(0).map((_, i) => 1 << i);\nconst obstacles = [ROCK0, ROCK1, ROCK2, TREE, TOWER, JAIL,\n  BORDER_TOP,\n  BORDER_BOTTOM,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT];\n\nfunction initMap(height, width) {\n  const map = new Array(height).fill(0).map((_, i) =>\n    new Array(width).fill(0).map((_, j) => {\n      let flag = 0;\n\n      const top = i === 0;\n      const bottom = i === height - 1;\n      const left = j === 0;\n      const right = j === width - 1;\n      if (top && left) flag |= BORDER_TOP_LEFT;\n      else if (top && right) flag |= BORDER_TOP_RIGHT;\n      else if (bottom && left) flag |= BORDER_BOTTOM_LEFT;\n      else if (bottom && right) flag |= BORDER_BOTTOM_RIGHT;\n      else if (top) flag |= BORDER_TOP;\n      else if (bottom) flag |= BORDER_BOTTOM;\n      else if (left) flag |= BORDER_LEFT;\n      else if (right) flag |= BORDER_RIGHT;\n      else if (i === 80) flag |= DIVIDER;\n      else if (i === 4 || i === height - 1 - 4) flag |= JAIL;\n      else if (Math.random() < .01) flag |= [ROCK0, ROCK1, ROCK2][Math.random() * 3 | 0];\n      else if (Math.random() < .02) flag |= TREE;\n      else if (Math.random() < .001) flag |= KEY;\n      return flag;\n    }));\n  map[40][width / 2 | 0] |= TOWER;\n  map[height - 1 - 40][width / 2 | 0] |= TOWER;\n  return map;\n}\n\nfunction crop(map, i, j, height, width) {\n  const rows = i < 0\n    ? [...new Array(-i).fill(0).map(() => new Array(width).fill(0)), ...map.slice(0, i + height)]\n    : map.slice(i, i + height);\n  return rows.map(row => j < 0\n    ? [...new Array(-j).fill(0), ...row.slice(0, j + width)]\n    : row.slice(j, j + width),\n  );\n}\n\nfunction cloneMap(map) {\n  return map.map(row => row.map(v => v));\n}\n\nfunction addToMap(map, i, j, flag) {\n  const newMap = cloneMap(map);\n  newMap[i][j] |= flag;\n  return newMap;\n}\n\nfunction removeFromMap(map, i, j, flag) {\n  const newMap = cloneMap(map);\n  newMap[i][j] &= ~flag;\n  return newMap;\n}\n\nfunction App({ mapHeight, mapWidth, windowHeight }) {\n  const [[dx, dy], setDelta] = useState([0, 0]);\n  let [[x, y], setPos] = useState([0, 0]);\n  const [frame, setFrame] = useState(0);\n  let [windowWidth, setWindowWidth] = useState(windowHeight * 2 | 0);\n  const [map, setMap] = useState(initMap(mapHeight, mapWidth));\n  const [flash, setFlash] = useState(false);\n  const [scan, setScan] = useState(false);\n  const [scanAngle, setScanAngle] = useState(0);\n  const [holding, setHolding] = useState(KEY);\n  let gridSize = `${9.09}vw`;\n\n  if (scan) {\n    windowHeight = 81;\n    windowWidth = 81;\n    gridSize = `${1.23}vw`;\n    x = 40;\n    y = 0;\n  }\n\n  useEffect(() => {\n    const onKeyDown = e => {\n      e.preventDefault();\n      console.log(e.key);\n      let dx = 0;\n      let dy = 0;\n      switch (e.key) {\n        case 'ArrowDown':\n          dx++;\n          break;\n        case 'ArrowUp':\n          dx--;\n          break;\n        case 'ArrowLeft':\n          dy--;\n          break;\n        case 'ArrowRight':\n          dy++;\n          break;\n        default:\n      }\n      dx /= 5;\n      dy /= 5;\n      setDelta([dx, dy]);\n    };\n\n    const onKeyUp = e => {\n      setDelta([0, 0]);\n    };\n\n    const onTilt = e => {\n      const absolute = e.absolute;\n      const alpha = e.alpha;\n      const beta = e.beta;\n      const gamma = e.gamma;\n      const dx = -gamma / 540;\n      const dy = beta / 540;\n      setDelta([dx, dy]);\n    };\n\n    const onResize = () => {\n      setWindowWidth(window.innerHeight / window.innerWidth * windowHeight + .5 | 0);\n    };\n    onResize();\n\n    const timer = window.setInterval(() => {\n      setFrame(Math.random());\n    }, 1000 / 30);\n    document.addEventListener('keydown', onKeyDown);\n    document.addEventListener('keyup', onKeyUp);\n    window.addEventListener('resize', onResize);\n    window.addEventListener('deviceorientation', onTilt, true);\n    return () => {\n      window.clearInterval(timer);\n      document.removeEventListener('keydown', onKeyDown);\n      document.removeEventListener('keyup', onKeyUp);\n      window.removeEventListener('resize', onResize);\n      window.removeEventListener('deviceorientation', onTilt);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (scan) {\n      const aimingAngle = Math.atan2(-dy, dx);\n      let currentAngle = scanAngle;\n      const unit = Math.PI / 300;\n      const delta = aimingAngle - currentAngle;\n      const magnitude = Math.abs(delta);\n      if (magnitude === 0) return;\n      if (magnitude > Math.PI) {\n        currentAngle -= delta / magnitude * unit;\n      } else {\n        currentAngle += delta / magnitude * unit;\n      }\n      currentAngle %= Math.PI * 2;\n      setScanAngle(currentAngle);\n    } else {\n      let nx = x + dx;\n      let ny = y + dy;\n      const xFlag = map[mapCx + nx + .5 | 0][mapCy + y + .5 | 0];\n      if (obstacles.some(obstacle => (obstacle & xFlag) > 0)) {\n        nx = x;\n      }\n      const yFlag = map[mapCx + x + .5 | 0][mapCy + ny + .5 | 0];\n      if (obstacles.some(obstacle => (obstacle & yFlag) > 0)) {\n        ny = y;\n      }\n      let stop = false;\n      croppedMap.forEach((row, i) => {\n        row.forEach((flag, j) => {\n          const blockX = mapSx - 3 + i;\n          const blockY = mapSy - 3 + j;\n          if ((flag & TOWER) > 0 && distance([blockX, blockY], [mapCx + nx, mapCy + ny]) < 2) {\n            setScan(true);\n            stop = true;\n          }\n        });\n      });\n      if (!stop) {\n        setPos([nx, ny]);\n      }\n    }\n  }, [frame]);\n\n  const mapCx = mapHeight / 2 | 0;\n  const mapCy = mapWidth / 2 | 0;\n  const windowCx = windowHeight / 2 | 0;\n  const windowCy = windowWidth / 2 | 0;\n\n  const mapSx = mapCx + (x | 0) - windowCx;\n  const mapSy = mapCy + (y | 0) - windowCy;\n\n  const croppedMap = crop(map, mapSx - 3, mapSy - 3, windowHeight + 7, windowWidth + 7);\n\n  const offsetX = (x | 0) - x;\n  const offsetY = (y | 0) - y;\n\n  const appRef = useRef(null);\n  const app = appRef.current;\n  const minimapRef = useRef(null);\n  const canvas = minimapRef.current;\n  if (canvas) {\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    const attrMap = {\n      [TOWER]: ['#ffe300', 2],\n      [JAIL]: ['#606060', 1],\n      [DIVIDER]: ['#808080', 1],\n      [KEY]: ['#ff6600', 1],\n    };\n    const blocks = Object.keys(attrMap);\n    map.forEach((row, i) => {\n      row.forEach((flag, j) => {\n        const block = blocks.find(block => (block & flag) > 0);\n        if (block in attrMap) {\n          const [color, size] = attrMap[block];\n          ctx.fillStyle = color;\n          ctx.fillRect(j - size, i - size, size * 2 + 1, size * 2 + 1);\n        }\n      });\n    });\n\n    ctx.fillStyle = '#FFFFFF';\n    ctx.fillRect((mapCy + (y + .5 | 0)) - 1, (mapCx + (x + .5 | 0)) - 1, 3, 3);\n\n    ctx.strokeStyle = '#FFFFFF';\n    ctx.strokeRect(mapSy - 1, mapSx - 1, windowWidth + 2, windowHeight + 2);\n  }\n\n  return (\n    <div className=\"App\" ref={appRef}\n         onTouchStart={() => setFlash(true)} onTouchEnd={() => setFlash(false)}\n         onMouseDown={() => setFlash(true)} onMouseUp={() => setFlash(false)}\n         onClick={() => {\n           if (!document.fullscreenElement) {\n             if (app && app.requestFullscreen) {\n               app.requestFullscreen().catch(alert);\n             }\n           }\n\n           if (scan) {\n             setScan(false);\n           } else if (holding === KEY) {\n             const newMap = addToMap(map, mapCx + (x + .5 | 0), mapCy + (y + .5 | 0), KEY);\n             setMap(newMap);\n             setHolding(0);\n           }\n         }}>\n      <div className=\"game\">\n        <div className={classes('grid', scan && 'scan')} style={{\n          marginTop: `calc(${offsetX - 3} * ${gridSize})`,\n          marginLeft: `calc(${offsetY - 3} * ${gridSize})`,\n          paddingLeft: scan ? `calc((100vh - 100vw) / 2)` : '',\n        }}>\n          {\n            croppedMap.map((row, i) => (\n              <div className=\"row\" key={i}>\n                {\n                  row.map((flag, j) => {\n                    const blocks = ['divider', 'rock0', 'rock1', 'rock2', 'tree', 'tower', 'jail', 'key',\n                      'border_top',\n                      'border_bottom',\n                      'border_left',\n                      'border_right',\n                      'border_top_left',\n                      'border_top_right',\n                      'border_bottom_left',\n                      'border_bottom_right']\n                      .filter((_, k) => (flag & (1 << k)) > 0);\n                    return blocks.length > 0 && (\n                      <div className=\"col\" key={j} style={{\n                        left: `calc(${j} * ${gridSize})`,\n                      }}>\n                        {\n                          blocks.map(block => (\n                            <div key={block} className={classes('block', block)} style={{\n                              zIndex: ['divider', 'key'].includes(block) ? 0 : x + 3 < (x | 0) - windowCx + i ? 2 : 0,\n                            }}>\n                            </div>\n                          ))\n                        }\n                      </div>\n                    );\n                  })\n                }\n              </div>\n            ))\n          }\n        </div>\n        {\n          !scan &&\n          <Character className=\"character\" teamId={0} dx={dx} dy={dy} style={{\n            top: `calc(${windowCx} * ${gridSize})`,\n            left: `calc(${windowCy} * ${gridSize})`,\n          }} holding={holding === KEY ? 'key' : 'lamp'}/>\n        }\n        {\n          !scan &&\n          <div className={classes('illumination', flash && 'flash')} style={{\n            marginTop: `calc(${windowCx} * ${gridSize})`,\n            marginLeft: `calc(${windowCy} * ${gridSize})`,\n          }}/>\n        }\n        {\n          scan &&\n          <div className=\"spotlight\" style={{\n            transform: `rotate(${scanAngle / Math.PI * 180}deg)`,\n          }}/>\n        }\n        {\n          !scan &&\n          <div className=\"minimap\">\n            <canvas ref={minimapRef} className=\"canvas\" height={mapHeight} width={mapWidth}/>\n          </div>\n        }\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\n\nReactDOM.render(<App mapHeight={161} mapWidth={81}\n                     windowHeight={11}/>, document.getElementById('root'));\n"],"sourceRoot":""}
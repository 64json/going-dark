(this["webpackJsonpcapture-the-flag"]=this["webpackJsonpcapture-the-flag"]||[]).push([[0],{37:function(e,t,n){e.exports=n(76)},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},73:function(e,t){},76:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),c=n(32),r=n.n(c),o=(n(42),n(1)),s=(n(43),n(2)),u=n(3),l=n(35),h=n(33),d=n(36),f=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return e})).join(" ")},w=function(e){return e*e},m=function(){function e(t,n){Object(s.a)(this,e),this.x=t,this.y=n}return Object(u.a)(e,[{key:"plus",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"distanceTo",value:function(e){return Math.sqrt(w(this.x-e.x)+w(this.y-e.y))}},{key:"indices",get:function(){return[Math.round(this.x),Math.round(this.y)]}},{key:"magnitude",get:function(){return Math.sqrt(w(this.x)+w(this.y))}}]),e}(),g=function(){function e(t,n){Object(s.a)(this,e),this.teamId=t,this._pos=n,this.delta=new m(0,0),this.hasKey=!0,this.isFlashing=!1,this.isScanning=!1}return Object(u.a)(e,[{key:"pos",get:function(){return this.isScanning?new m(40,40):this._pos},set:function(e){this.isScanning||(this._pos=e)}},{key:"angle",get:function(){return Math.atan2(-this.delta.y,this.delta.x)}},{key:"nextPos",get:function(){return this.pos.plus(this.delta)}}]),e}(),y=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(d.a)(t,e),t}(g),p=function(){function e(t,n){Object(s.a)(this,e),this.height=t,this.width=n}return Object(u.a)(e,[{key:"resize",value:function(){this.width=window.innerHeight/window.innerWidth*this.height+.5|0}},{key:"gridSize",get:function(){return"".concat((100/this.height).toFixed(2),"vw")}},{key:"center",get:function(){return new m(this.height/2|0,this.width/2|0)}}]),e}(),v=function(){function e(t,n,i){Object(s.a)(this,e),this.map=t,this.users=n,this._window=i}return Object(u.a)(e,[{key:"me",get:function(){return this.users.find((function(e){return e instanceof y}))}},{key:"otherUsers",get:function(){return this.users.filter((function(e){return!(e instanceof y)}))}},{key:"window",get:function(){return this.me.isScanning?new p((this.map.height+1)/2|0,this.map.width):this._window}}]),e}(),b=n(7),k=new Array(31).fill(0).map((function(e,t){return 1<<t})),j=Object(o.a)(k,16),O=j[0],E=j[1],S=j[2],x=j[3],F=j[4],_=j[5],M=j[6],z=j[7],N=j[8],I=j[9],A=j[10],L=j[11],P=j[12],R=j[13],T=j[14],U=j[15],q=function(){function e(t,n){Object(s.a)(this,e),this.height=t,this.width=n;var i=new Array(t).fill(0).map((function(e,i){return new Array(n).fill(0).map((function(e,a){var c=0,r=0===i,o=i===t-1,s=0===a,u=a===n-1;return r&&s?c|=P:r&&u?c|=R:o&&s?c|=T:o&&u?c|=U:r?c|=N:o?c|=I:s?c|=A:u?c|=L:80===i?c|=O:4===i||i===t-1-4?c|=M:Math.random()<.01?c|=[E,S,x][3*Math.random()|0]:Math.random()<.02&&(c|=F),c}))}));i[40][n/2|0]|=_,i[t-1-40][n/2|0]|=_,this.map=i}return Object(u.a)(e,[{key:"crop",value:function(e,t,n){var i=Object(o.a)(e.indices,2),a=i[0],c=i[1];return(a<0?[].concat(Object(b.a)(new Array(-a).fill(0).map((function(){return new Array(n).fill(0)}))),Object(b.a)(this.map.slice(0,a+t))):this.map.slice(a,a+t)).map((function(e){return c<0?[].concat(Object(b.a)(new Array(-c).fill(0)),Object(b.a)(e.slice(0,c+n))):e.slice(c,c+n)}))}},{key:"add",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],a=n[1];this.map[i][a]|=t}},{key:"remove",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],a=n[1];this.map[i][a]&=~t}},{key:"clear",value:function(e){var t=Object(o.a)(e.indices,2),n=t[0],i=t[1];this.map[n][i]=0}},{key:"has",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],a=n[1];return(this.map[i][a]&t)>0}},{key:"forEach",value:function(e){return this.map.forEach(e)}},{key:"getSpawnPos",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new m(this.height-6-e,this.center.y);return this.clear(t),t}},{key:"center",get:function(){return new m(this.height/2|0,this.width/2|0)}}]),e}(),C=n(6);n(44);var K=function(e){var t,n=e.className,i=e.user,c=e.style,r=i.delta.magnitude>.05;return t=Math.abs(i.delta.x)>Math.abs(i.delta.y)?i.delta.x<0?"top":"bottom":i.delta.y<0?"left":"right",a.a.createElement("div",{className:f("Character","team_".concat(i.teamId),r&&"moving",t,n),style:c},a.a.createElement("div",{className:f("holding",i.hasKey?"key":"lamp")}))},D=[E,S,x,F,_,M,N,I,A,L,P,R,T,U];function J(e){var t=e.game,n=t.me,c=t.map,r=Object(i.useState)(0),s=Object(o.a)(r,2),u=s[0],l=s[1],h=Object(i.useState)(0),d=Object(o.a)(h,2),w=d[0],g=d[1];Object(i.useEffect)((function(){var e=function(e){e.preventDefault();var t=0,i=0;switch(e.key){case"ArrowDown":t++;break;case"ArrowUp":t--;break;case"ArrowLeft":i--;break;case"ArrowRight":i++}t/=5,i/=5,n.delta=new m(t,i)},i=function(e){n.delta=new m(0,0)},a=function(e){var t=e.beta,i=-e.gamma/360,a=t/360;n.delta=new m(i,a)},c=function(){t._window.resize()};c();var r=window.setInterval((function(){l(Math.random())}),1e3/30);return document.addEventListener("keydown",e),document.addEventListener("keyup",i),window.addEventListener("resize",c),window.addEventListener("deviceorientation",a,!0),function(){window.clearInterval(r),document.removeEventListener("keydown",e),document.removeEventListener("keyup",i),window.removeEventListener("resize",c),window.removeEventListener("deviceorientation",a)}}),[]),Object(i.useEffect)((function(){if(n.isScanning){var e=n.angle,t=w,i=Math.PI/300,a=e-t,r=Math.abs(a);if(0===r)return;r>Math.PI?t-=a/r*i:t+=a/r*i,t%=2*Math.PI,g(t)}else{var o=n.pos,s=n.nextPos;D.some((function(e){return c.has(new m(s.x,o.y),e)}))&&(s.x=o.x),D.some((function(e){return c.has(new m(o.x,s.y),e)}))&&(s.y=o.y);var u=!1;p.forEach((function(e,t){e.forEach((function(e,i){var a=y.plus(new m(t,i));(e&_)>0&&a.distanceTo(s)<2&&(n.isScanning=!0,u=!0)}))})),u||(n.pos=s)}}),[u]);var y=n.pos.minus(t.window.center).minus(new m(3,3)),p=c.crop(y,t.window.height+7,t.window.width+7),v=Object(i.useRef)(null),b=v.current;if(b){var k,j=b.getContext("2d");j.clearRect(0,0,b.width,b.height);var E=(k={},Object(C.a)(k,_,["#ffe300",2]),Object(C.a)(k,M,["#606060",1]),Object(C.a)(k,O,["#808080",1]),Object(C.a)(k,z,["#ff6600",1]),k),S=Object.keys(E);c.forEach((function(e,t){e.forEach((function(e,n){var i=S.find((function(t){return(t&e)>0}));if(i in E){var a=Object(o.a)(E[i],2),c=a[0],r=a[1];j.fillStyle=c,j.fillRect(n-r,t-r,2*r+1,2*r+1)}}))})),t.otherUsers.forEach((function(e){j.fillStyle=e.teamId===n.teamId?"#00FF00":"#FF0000",j.fillRect(e.pos.y-1,e.pos.x-1,3,3)})),j.fillStyle="#FFFFFF",j.fillRect(n.pos.y-1,n.pos.x-1,3,3),j.strokeStyle="#FFFFFF",j.strokeRect(y.y+2,y.x+2,t.window.width+2,t.window.height+2)}return a.a.createElement("div",{className:"game",onTouchStart:function(){return n.isFlashing=!0},onTouchEnd:function(){return n.isFlashing=!1},onMouseDown:function(){return n.isFlashing=!0},onMouseUp:function(){return n.isFlashing=!1},onClick:function(){n.isScanning?n.isScanning=!1:n.hasKey&&(c.add(n.pos,z),n.hasKey=!1)}},a.a.createElement("div",{className:f("grid",n.isScanning&&"scan"),style:{marginTop:"calc(".concat((n.pos.x+.5|0)-n.pos.x-3," * ").concat(t.window.gridSize,")"),marginLeft:"calc(".concat((n.pos.y+.5|0)-n.pos.y-3," * ").concat(t.window.gridSize,")"),paddingLeft:n.isScanning?"calc((100vh - 100vw) / 2)":""}},p.map((function(e,n){return a.a.createElement("div",{className:"row",key:n},e.map((function(e,i){var c=["divider","rock0","rock1","rock2","tree","tower","jail","key","border_top","border_bottom","border_left","border_right","border_top_left","border_top_right","border_bottom_left","border_bottom_right"].filter((function(t,n){return(e&1<<n)>0}));return c.length>0&&a.a.createElement("div",{className:"col",key:i,style:{left:"calc(".concat(i," * ").concat(t.window.gridSize,")")}},c.map((function(e){return a.a.createElement("div",{key:e,className:f("block",e),style:{zIndex:["divider","key"].includes(e)?0:y.indices[0]+n}})})))})))}))),t.otherUsers.map((function(e,i){return a.a.createElement(K,{key:i,className:"character",user:e,style:{zIndex:e.pos.indices[0],top:"calc(".concat(e.pos.x-n.pos.x+t.window.center.x," * ").concat(t.window.gridSize,")"),left:"calc(".concat(e.pos.y-n.pos.y+t.window.center.y," * ").concat(t.window.gridSize,")")}})})),!n.isScanning&&a.a.createElement(K,{className:"character",user:n,style:{zIndex:n.pos.indices[0],top:"calc(".concat(t.window.center.x," * ").concat(t.window.gridSize,")"),left:"calc(".concat(t.window.center.y," * ").concat(t.window.gridSize,")")}}),!n.isScanning&&a.a.createElement("div",{className:f("illumination",n.isFlashing&&"flash"),style:{marginTop:"calc(".concat(t.window.center.x," * ").concat(t.window.gridSize,")"),marginLeft:"calc(".concat(t.window.center.y," * ").concat(t.window.gridSize,")")}}),n.isScanning&&a.a.createElement("div",{className:"spotlight",style:{transform:"rotate(".concat(w/Math.PI*180,"deg)")}}),!n.isScanning&&a.a.createElement("div",{className:"minimap"},a.a.createElement("canvas",{ref:v,className:"canvas",height:c.height,width:c.width})))}var B=n(34),H=n.n(B),W=new q(161,81),G=new y(0,W.getSpawnPos()),Q=new g(0,W.getSpawnPos(1)),V=new g(1,W.getSpawnPos(2)),X=new g(1,W.getSpawnPos(3)),Y=new v(W,[G,Q,V,X],new p(11,22));var Z=function(){var e=Object(i.useRef)(null),t=e.current,n=Object(i.useState)(null),c=Object(o.a)(n,2),r=(c[0],c[1]);return Object(i.useEffect)((function(){var e=H.a.connect("http://localhost:8080");return r(e),function(){e.disconnect()}}),[]),a.a.createElement("div",{className:"App",ref:e,onClick:function(){document.fullscreenElement||t&&t.requestFullscreen&&t.requestFullscreen().catch(alert)}},a.a.createElement(J,{game:Y}))};r.a.render(a.a.createElement(Z,null),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.a76d3475.chunk.js.map
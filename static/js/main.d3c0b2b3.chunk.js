(this["webpackJsonpcapture-the-flag"]=this["webpackJsonpcapture-the-flag"]||[]).push([[0],{18:function(e,t,n){},38:function(e,t,n){e.exports=n(77)},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},74:function(e,t){},77:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(33),s=n.n(a),o=(n(43),n(1)),c=(n(44),n(4)),u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return e})).join(" ")},h=function(e){return e*e},d=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),l=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);n(18);var f=function(e){var t,n=e.className,i=e.user,a=e.style,s=e.reversed,o=i.delta.magnitude>.05;return t=Math.abs(i.delta.x)>Math.abs(i.delta.y)?i.delta.x*(s?-1:1)<0?"top":"bottom":i.delta.y*(s?-1:1)<0?"left":"right",r.a.createElement("div",{className:u("Character","team_".concat(i.teamId),o&&"moving",t,n),style:a},r.a.createElement("div",{className:u("holding",i.hasOwnKey||i.hasStolenKey?"key":"lamp")}))},m=n(2),v=n(3),y=n(36),p=n(34),g=n(37),w=function(){function e(t,n){Object(m.a)(this,e),this.x=t,this.y=n}return Object(v.a)(e,[{key:"plus",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"distanceTo",value:function(e){return Math.sqrt(h(this.x-e.x)+h(this.y-e.y))}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"indices",get:function(){return[Math.round(this.x),Math.round(this.y)]}},{key:"magnitude",get:function(){return Math.sqrt(h(this.x)+h(this.y))}},{key:"teamId",get:function(){return this.x<80?0:this.x>80?1:-1}}],[{key:"restore",value:function(t){return new e(t.x,t.y)}}]),e}(),b=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w(0,0),a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7];Object(m.a)(this,e),this.uuid=t,this.teamId=n,this._pos=i,this._delta=r,this._hasOwnKey=a,this._hasStolenKey=s,this._isFlashing=o,this._isScanning=c}return Object(v.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"isOurBase",value:function(e){return this.teamId===e.teamId}},{key:"isInJail",value:function(){return this.pos.x<4||this.pos.x>156}},{key:"pos",get:function(){return this.isScanning?new w([40,120][this._pos.teamId],40):this._pos},set:function(e){this.isScanning||this._pos.equals(e)||(this._pos=e,this.server&&this.server.updateUser(this))}},{key:"delta",get:function(){return this._delta},set:function(e){this._delta.equals(e)||(this._delta=e,this.server&&this.server.updateUser(this))}},{key:"hasOwnKey",get:function(){return this._hasOwnKey},set:function(e){this._hasOwnKey=e,this.server&&this.server.updateUser(this)}},{key:"hasStolenKey",get:function(){return this._hasStolenKey},set:function(e){this._hasStolenKey=e,this.server&&this.server.updateUser(this)}},{key:"isFlashing",get:function(){return this._isFlashing},set:function(e){this._isFlashing=e,this.server&&this.server.updateUser(this)}},{key:"isScanning",get:function(){return this._isScanning},set:function(e){this._isScanning=e,this.server&&this.server.updateUser(this)}},{key:"angle",get:function(){return Math.atan2(-this.delta.y,this.delta.x)}},{key:"nextPos",get:function(){return this.pos.plus(this.delta)}}],[{key:"restore",value:function(t){var n=t.uuid,i=t.teamId,r=t._pos,a=t._delta,s=t._hasOwnKey,o=t._hasStolenKey,c=t._isFlashing,u=t._isScanning;return new(n===d?k:e)(n,i,w.restore(r),w.restore(a),s,o,c,u)}}]),e}(),k=function(e){function t(){return Object(m.a)(this,t),Object(y.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(g.a)(t,e),t}(b),O=function(){function e(t,n){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object(m.a)(this,e),this.height=t,this.width=n,i&&this.resize()}return Object(v.a)(e,[{key:"resize",value:function(){this.width=window.innerHeight/window.innerWidth*this.height+.5|0}},{key:"gridSize",get:function(){return"".concat((100/this.height).toFixed(2),"vw")}},{key:"center",get:function(){return new w(this.height/2|0,this.width/2|0)}}],[{key:"restore",value:function(t){return new e(t.height,t.width)}}]),e}(),_=n(5),j=new Array(31).fill(0).map((function(e,t){return 1<<t})),S=Object(o.a)(j,16),E=S[0],x=S[1],I=S[2],M=S[3],F=S[4],K=S[5],A=S[6],N=S[7],L=S[8],z=S[9],T=S[10],C=S[11],U=S[12],G=S[13],P=S[14],R=S[15],J=function(){function e(t,n,i){Object(m.a)(this,e),this.height=t,this.width=n,i?this.map=i:(this.map=new Array(t).fill(0).map((function(e,i){return new Array(n).fill(0).map((function(e,r){var a=0,s=0===i,o=i===t-1,c=0===r,u=r===n-1;return s&&c?a|=U:s&&u?a|=G:o&&c?a|=P:o&&u?a|=R:s?a|=L:o?a|=z:c?a|=T:u?a|=C:80===i?a|=E:4===i||i===t-1-4?a|=A:Math.random()<.01?a|=[x,I,M][3*Math.random()|0]:Math.random()<.02&&(a|=F),a}))})),this.map[40][n/2|0]|=K,this.map[t-1-40][n/2|0]|=K)}return Object(v.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"crop",value:function(e,t,n){var i=Object(o.a)(e.indices,2),r=i[0],a=i[1],s=0,c=0,u=0,h=0;return r<0&&(s=-r,r=0,t-=s),a<0&&(u=-a,a=0,n-=u),r+t>=this.height&&(t-=c=r+t-this.height),a+n>=this.width&&(h=a+n-this.width,n-=h),[].concat(Object(_.a)(new Array(s).fill(0).map((function(){return new Array(n).fill(0)}))),Object(_.a)(this.map.slice(r,r+t).map((function(e){return[].concat(Object(_.a)(new Array(u).fill(0)),Object(_.a)(e.slice(a,a+n)),Object(_.a)(new Array(h).fill(0)))}))),Object(_.a)(new Array(c).fill(0).map((function(){return new Array(n).fill(0)}))))}},{key:"add",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],r=n[1];this.map[i][r]|=t,this.server&&this.server.updateMap(i,r,this.map[i][r])}},{key:"remove",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],r=n[1];this.map[i][r]&=~t,this.server&&this.server.updateMap(i,r,this.map[i][r])}},{key:"clear",value:function(e){var t=Object(o.a)(e.indices,2),n=t[0],i=t[1];this.map[n][i]=0,this.server&&this.server.updateMap(n,i,this.map[n][i])}},{key:"has",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],r=n[1];return(this.map[i][r]&t)>0}},{key:"forEach",value:function(e){return this.map.forEach(e)}},{key:"center",get:function(){return new w(this.height/2|0,this.width/2|0)}}],[{key:"restore",value:function(t){return new e(t.height,t.width,t.map)}}]),e}(),q=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(m.a)(this,e),this.id=t,this._scanAngle=n,this._achievedKeyCount=i}return Object(v.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"scanAngle",get:function(){return this._scanAngle},set:function(e){this._scanAngle=e,this.server&&this.server.updateTeam(this)}},{key:"achievedKeyCount",get:function(){return this._achievedKeyCount},set:function(e){this._achievedKeyCount=e,this.server&&this.server.updateTeam(this)}}],[{key:"restore",value:function(t){return new e(t.id,t._scanAngle,t._achievedKeyCount)}}]),e}(),B=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[new q(0,0),new q(1,Math.PI)],a=arguments.length>4?arguments[4]:void 0;Object(m.a)(this,e),this.id=t,this.map=n,this.users=i,this.teams=r,this._window=a}return Object(v.a)(e,[{key:"sync",value:function(e){this.server=e,this.map.sync(e),this.users.forEach((function(t){return t.sync(e)})),this.teams.forEach((function(t){return t.sync(e)}))}},{key:"getSpawnPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new w([5+t,this.map.height-1-5-t][e],this.map.center.y);return this.map.clear(n),n}},{key:"getJailPos",value:function(e){return new w([3,this.map.height-1-3][e],40)}},{key:"getJailX",value:function(e){return[4,this.map.height-4][e]}},{key:"me",get:function(){return this.users.find((function(e){return e instanceof k}))}},{key:"allies",get:function(){var e=this.me.teamId;return this.users.filter((function(t){return t.teamId===e}))}},{key:"enemies",get:function(){var e=this.me.teamId;return this.users.filter((function(t){return t.teamId!==e}))}},{key:"otherUsers",get:function(){return this.users.filter((function(e){return!(e instanceof k)}))}},{key:"window",get:function(){return this.me.isScanning?new O((this.map.height+1)/2|0,this.map.width,!1):this._window}}],[{key:"restore",value:function(t){var n=t.id,i=t.map,r=t.users,a=t.teams,s=t._window;return new e(n,J.restore(i),r.map(b.restore),a.map(q.restore),O.restore(s))}}]),e}(),D=(n(45),[x,I,M,F,A,L,z,T,C,U,G,P,R]);function H(e){var t=e.game,n=t.me,a=t.map,s=t.teams,h=Object(i.useState)(0),d=Object(o.a)(h,2),l=d[0],m=d[1],v=0===n.teamId;Object(i.useEffect)((function(){var e=function(e){e.preventDefault();var t=0,i=0;switch(e.key){case"ArrowDown":t++;break;case"ArrowUp":t--;break;case"ArrowLeft":i--;break;case"ArrowRight":i++}t/=1,i/=1,v&&(t*=-1,i*=-1),n.delta=new w(t,i)},i=function(e){n.delta=new w(0,0)},r=function(e){var t=e.beta,i=-e.gamma/360,r=t/360;v&&(i*=-1,r*=-1),n.delta=new w(i,r)},a=function(){t._window.resize()};return document.addEventListener("keydown",e),document.addEventListener("keyup",i),window.addEventListener("resize",a),window.addEventListener("deviceorientation",r,!0),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",i),window.removeEventListener("resize",a),window.removeEventListener("deviceorientation",r)}}),[t._window,n]),Object(i.useEffect)((function(){var e=window.setInterval((function(){m(Math.random())}),1e3/30);return function(){window.clearInterval(e)}}),[]),Object(i.useEffect)((function(){if(n.isScanning){var e=n.angle,i=s[n.pos.teamId].scanAngle,r=Math.PI/300,c=e-i,u=Math.abs(c);if(0===u)return;u>Math.PI?i-=c/u*r:i+=c/u*r,i%=2*Math.PI,s[n.pos.teamId].scanAngle=i}else{var h=n.pos,d=n.nextPos,l=[].concat(D);n.hasOwnKey&&l.push(E),l.some((function(e){return a.has(new w(d.x,h.y),e)}))&&(d.x=h.x),l.some((function(e){return a.has(new w(h.x,d.y),e)}))&&(d.y=h.y);var f=!1,m=Object(o.a)(y.indices,2),v=m[0],g=m[1],b=new w(v,g);if(p.forEach((function(e,t){e.forEach((function(e,i){var r=b.plus(new w(t,i));(e&K)>0&&r.distanceTo(d)<2&&(n.isScanning=!0,f=!0)}))})),!f&&(n.pos=d,n.hasStolenKey&&n.teamId===n.pos.teamId&&(n.hasStolenKey=!1,s[n.teamId].achievedKeyCount++),n.isOurBase(n.pos))){var k=t.enemies.find((function(e){return e.pos.distanceTo(n.pos)<1}));k&&(k.hasStolenKey&&(a.add(k.pos,N),k.hasStolenKey=!1),k.pos=t.getJailPos(n.teamId))}}}),[l]);var y=n.pos.minus(t.window.center).minus(new w(6,6)),p=a.crop(y,t.window.height+12,t.window.width+12),g=Math.round(y.x)-y.x-6,b=Math.round(y.y)-y.y-6,k=Object(i.useRef)(null),O=k.current;if(O){var _,j=O.getContext("2d");j.clearRect(0,0,O.width,O.height);var S=(_={},Object(c.a)(_,K,["#ffe300",2]),Object(c.a)(_,A,["#606060",1]),Object(c.a)(_,E,["#808080",1]),Object(c.a)(_,N,["#ff6600",1]),_),x=Object.keys(S);a.forEach((function(e,t){e.forEach((function(e,i){var r=x.find((function(t){return(t&e)>0}));if((r!==N.toString()||n.isOurBase(new w(t,i)))&&r in S){var a=Object(o.a)(S[r],2),s=a[0],c=a[1];j.fillStyle=s,j.fillRect(i-c,t-c,2*c+1,2*c+1)}}))})),t.allies.forEach((function(e){j.fillStyle=e.teamId===n.teamId?"#00FF00":"#FF0000",j.fillRect(e.pos.y-1,e.pos.x-1,3,3)})),j.fillStyle="#FFFFFF",j.fillRect(n.pos.y-1,n.pos.x-1,3,3),j.strokeStyle="#FFFFFF",j.strokeRect(n.pos.y-t.window.center.y-1,n.pos.x-t.window.center.x-1,t.window.width+2,t.window.height+2)}return r.a.createElement("div",{className:"GameRenderer",onTouchStart:function(){return n.isFlashing=!0},onTouchEnd:function(){return n.isFlashing=!1},onMouseDown:function(){return n.isFlashing=!0},onMouseUp:function(){return n.isFlashing=!1},onClick:function(){var e=t.allies.filter((function(e){return e.isInJail()&&e.pos.distanceTo(n.pos)<5}));n.isScanning?n.isScanning=!1:n.hasOwnKey?(a.add(n.pos,N),n.hasOwnKey=!1):e.length>0?e.forEach((function(e,i){e.pos=t.getSpawnPos(n.teamId,i)})):n.hasStolenKey||p.forEach((function(e,t){e.forEach((function(e,i){var r=new w(y.x+t,y.y+i);(e&N)>0&&n.pos.distanceTo(r)<1&&r.teamId!==n.teamId&&(a.remove(r,N),n.hasStolenKey=!0)}))}))}},r.a.createElement("div",{className:u("grid",n.isScanning&&"scan")},p.map((function(e,i){return r.a.createElement("div",{className:"row",key:i,style:Object(c.a)({},v?"bottom":"top","calc(".concat(i+g," * ").concat(t.window.gridSize,")"))},e.map((function(e,a){var s=["divider","rock0","rock1","rock2","tree","tower","jail","key",v?"border_bottom":"border_top",v?"border_top":"border_bottom",v?"border_right":"border_left",v?"border_left":"border_right",v?"border_bottom_right":"border_top_left",v?"border_bottom_left":"border_top_right",v?"border_top_right":"border_bottom_left",v?"border_top_left":"border_bottom_right"].filter((function(t,n){return(e&1<<n)>0}));return s.length>0&&r.a.createElement("div",{className:"col",key:a,style:Object(c.a)({},v?"right":"left","calc(".concat(a+b," * ").concat(t.window.gridSize).concat(n.isScanning?" + (100vh - 100vw) / 2":"",")"))},s.map((function(e){return r.a.createElement("div",{key:e,className:u("block",e),style:{zIndex:["divider","key"].includes(e)?0:(y.indices[0]+i)*(v?-1:1)+2*t.map.height}})})))})))}))),!n.isScanning&&t.users.map((function(e,i){var a;return r.a.createElement(f,{key:i,className:"character",user:e,style:(a={zIndex:e.pos.indices[0]*(v?-1:1)+2*t.map.height},Object(c.a)(a,v?"bottom":"top","calc(".concat(e.pos.x-n.pos.x+t.window.center.x," * ").concat(t.window.gridSize,")")),Object(c.a)(a,v?"right":"left","calc(".concat(e.pos.y-n.pos.y+t.window.center.y," * ").concat(t.window.gridSize,")")),a),reversed:v})})),!n.isScanning&&r.a.createElement("div",{className:"dim"}),!n.isScanning&&r.a.createElement("div",{className:u("illumination",n.isFlashing&&"flash"),style:{marginTop:"calc(".concat(t.window.center.x," * ").concat(t.window.gridSize,")"),marginLeft:"calc(".concat(t.window.center.y," * ").concat(t.window.gridSize,")")}}),n.isScanning&&r.a.createElement("div",{className:"spotlight",style:{transform:"rotate(".concat(s[n.pos.teamId].scanAngle/Math.PI*180,"deg)")}}),!n.isScanning&&r.a.createElement("div",{className:u("minimap",v&&"reversed")},r.a.createElement("canvas",{ref:k,className:"canvas",height:a.height,width:a.width})))}var W=n(35),X=n.n(W);var Q=function(e){var t=e.socket,n=Object(i.useState)([]),a=Object(o.a)(n,2),s=a[0],c=a[1];return Object(i.useEffect)((function(){t.on("listGames",c)}),[t]),r.a.createElement("div",{className:"Lobby"},r.a.createElement("div",{className:"roomList"},s.map((function(e){return r.a.createElement("div",{className:"room",key:e,onClick:function(){t.emit("joinGame",e)}},e)}))),r.a.createElement("button",{className:"create",onClick:function(){var e=new J(161,81),n=new B(l,e,void 0,void 0,new O(11,22));t.emit("createGame",n.id,n)}},"Create a Game"))};var V=function(){var e=Object(i.useRef)(null),t=e.current,n=Object(i.useState)(null),a=Object(o.a)(n,2),s=a[0],c=a[1],u=Object(i.useState)(null),h=Object(o.a)(u,2),l=h[0],f=h[1];return Object(i.useEffect)((function(){var e=X.a.connect("http://172.24.96.188:8080");return c(e),function(){e.disconnect()}}),[]),Object(i.useEffect)((function(){if(s){var e={updateGame:function(e){return s.emit("updateGame",e)},updateMap:function(e,t,n){return s.emit("updateMap",l.id,e,t,n)},updateUser:function(e){return s.emit("updateUser",l.id,e)},updateTeam:function(e){return s.emit("updateTeam",l.id,e)}};l&&l.sync(e);var t=function(e){var t=B.restore(e),n=2*t.users.filter((function(e){return 0===e.teamId})).length<t.users.length?0:1,i=t.users.filter((function(e){return e.teamId===n}));t.users.push(new k(d,n,t.getSpawnPos(n,i.length))),f(t),s.emit("updateGame",t)},n=function(t){if(l){var n=B.restore(t);l.sync(null),Object.assign(l,n),l.sync(e)}},i=function(e,t,n){l&&(l.map.map[e][t]=n)},r=function(t){if(l){var n=b.restore(t),i=l.users.find((function(e){return e.uuid===n.uuid}));i&&(i.sync(null),Object.assign(i,n),i.sync(e))}},a=function(t){if(l){var n=q.restore(t),i=l.teams.find((function(e){return e.id===n.id}));i&&(i.sync(null),Object.assign(i,n),i.sync(e))}};return s.on("joinGame",t),s.on("updateGame",n),s.on("updateMap",i),s.on("updateUser",r),s.on("updateTeam",a),function(){s.removeListener("joinGame",t),s.removeListener("updateGame",n),s.removeListener("updateMap",i),s.removeListener("updateUser",r),s.removeListener("updateTeam",a)}}}),[l,s]),r.a.createElement("div",{className:"App",ref:e,onClick:function(){document.fullscreenElement||t&&t.requestFullscreen}},l&&r.a.createElement(H,{game:l}),!l&&s&&r.a.createElement(Q,{socket:s}))};s.a.render(r.a.createElement(V,null),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.d3c0b2b3.chunk.js.map
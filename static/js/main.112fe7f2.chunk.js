(this["webpackJsonpcapture-the-flag"]=this["webpackJsonpcapture-the-flag"]||[]).push([[0],{11:function(e,t,n){e.exports=n(19)},16:function(e,t,n){},17:function(e,t,n){},18:function(e,t,n){},19:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),r=n(7),c=n.n(r),o=(n(16),n(17),n(1)),s=new Array(31).fill(0).map((function(e,t){return 1<<t})),u=Object(o.a)(s,16),h=u[0],l=u[1],d=u[2],f=u[3],w=u[4],m=u[5],g=u[6],y=u[7],p=u[8],v=u[9],b=u[10],k=u[11],j=u[12],O=u[13],E=u[14],S=u[15],x=n(2),F=n(3),_=n(9),M=n(8),z=n(10),N=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return e})).join(" ")},I=function(e){return e*e},A=function(){function e(t,n){Object(x.a)(this,e),this.x=t,this.y=n}return Object(F.a)(e,[{key:"plus",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"distanceTo",value:function(e){return Math.sqrt(I(this.x-e.x)+I(this.y-e.y))}},{key:"indices",get:function(){return[Math.round(this.x),Math.round(this.y)]}},{key:"magnitude",get:function(){return Math.sqrt(I(this.x)+I(this.y))}}]),e}(),L=function(){function e(t,n){Object(x.a)(this,e),this.teamId=t,this._pos=n,this.delta=new A(0,0),this.hasKey=!0,this.isFlashing=!1,this.isScanning=!1}return Object(F.a)(e,[{key:"pos",get:function(){return this.isScanning?new A(40,40):this._pos},set:function(e){this.isScanning||(this._pos=e)}},{key:"angle",get:function(){return Math.atan2(-this.delta.y,this.delta.x)}},{key:"nextPos",get:function(){return this.pos.plus(this.delta)}}]),e}(),P=function(e){function t(){return Object(x.a)(this,t),Object(_.a)(this,Object(M.a)(t).apply(this,arguments))}return Object(z.a)(t,e),t}(L),R=function(){function e(t,n){Object(x.a)(this,e),this.height=t,this.width=n}return Object(F.a)(e,[{key:"resize",value:function(){this.width=window.innerHeight/window.innerWidth*this.height+.5|0}},{key:"gridSize",get:function(){return"".concat((100/this.height).toFixed(2),"vw")}},{key:"center",get:function(){return new A(this.height/2|0,this.width/2|0)}}]),e}(),T=function(){function e(t,n,i){Object(x.a)(this,e),this.map=t,this.users=n,this._window=i}return Object(F.a)(e,[{key:"me",get:function(){return this.users.find((function(e){return e instanceof P}))}},{key:"otherUsers",get:function(){return this.users.filter((function(e){return!(e instanceof P)}))}},{key:"window",get:function(){return this.me.isScanning?new R((this.map.height+1)/2|0,this.map.width):this._window}}]),e}(),U=n(5),q=function(){function e(t,n){Object(x.a)(this,e),this.height=t,this.width=n;var i=new Array(t).fill(0).map((function(e,i){return new Array(n).fill(0).map((function(e,a){var r=0,c=0===i,o=i===t-1,s=0===a,u=a===n-1;return c&&s?r|=j:c&&u?r|=O:o&&s?r|=E:o&&u?r|=S:c?r|=p:o?r|=v:s?r|=b:u?r|=k:80===i?r|=h:4===i||i===t-1-4?r|=g:Math.random()<.01?r|=[l,d,f][3*Math.random()|0]:Math.random()<.02&&(r|=w),r}))}));i[40][n/2|0]|=m,i[t-1-40][n/2|0]|=m,this.map=i}return Object(F.a)(e,[{key:"crop",value:function(e,t,n){var i=Object(o.a)(e.indices,2),a=i[0],r=i[1];return(a<0?[].concat(Object(U.a)(new Array(-a).fill(0).map((function(){return new Array(n).fill(0)}))),Object(U.a)(this.map.slice(0,a+t))):this.map.slice(a,a+t)).map((function(e){return r<0?[].concat(Object(U.a)(new Array(-r).fill(0)),Object(U.a)(e.slice(0,r+n))):e.slice(r,r+n)}))}},{key:"add",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],a=n[1];this.map[i][a]|=t}},{key:"remove",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],a=n[1];this.map[i][a]&=~t}},{key:"clear",value:function(e){var t=Object(o.a)(e.indices,2),n=t[0],i=t[1];this.map[n][i]=0}},{key:"has",value:function(e,t){var n=Object(o.a)(e.indices,2),i=n[0],a=n[1];return(this.map[i][a]&t)>0}},{key:"forEach",value:function(e){return this.map.forEach(e)}},{key:"getSpawnPos",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new A(this.height-6-e,this.center.y);return this.clear(t),t}},{key:"center",get:function(){return new A(this.height/2|0,this.width/2|0)}}]),e}(),C=n(4);n(18);var K=function(e){var t,n=e.className,i=e.user,r=e.style,c=i.delta.magnitude>.05;return t=Math.abs(i.delta.x)>Math.abs(i.delta.y)?i.delta.x<0?"top":"bottom":i.delta.y<0?"left":"right",a.a.createElement("div",{className:N("Character","team_".concat(i.teamId),c&&"moving",t,n),style:r},a.a.createElement("div",{className:N("holding",i.hasKey?"key":"lamp")}))},D=[l,d,f,w,m,g,p,v,b,k,j,O,E,S];function J(e){var t=e.game,n=t.me,r=t.map,c=Object(i.useState)(0),s=Object(o.a)(c,2),u=s[0],l=s[1],d=Object(i.useState)(0),f=Object(o.a)(d,2),w=f[0],p=f[1];Object(i.useEffect)((function(){var e=function(e){e.preventDefault();var t=0,i=0;switch(e.key){case"ArrowDown":t++;break;case"ArrowUp":t--;break;case"ArrowLeft":i--;break;case"ArrowRight":i++}t/=5,i/=5,n.delta=new A(t,i)},i=function(e){n.delta=new A(0,0)},a=function(e){var t=e.beta,i=-e.gamma/540,a=t/540;n.delta=new A(i,a)},r=function(){t._window.resize()};r();var c=window.setInterval((function(){l(Math.random())}),1e3/30);return document.addEventListener("keydown",e),document.addEventListener("keyup",i),window.addEventListener("resize",r),window.addEventListener("deviceorientation",a,!0),function(){window.clearInterval(c),document.removeEventListener("keydown",e),document.removeEventListener("keyup",i),window.removeEventListener("resize",r),window.removeEventListener("deviceorientation",a)}}),[]),Object(i.useEffect)((function(){if(n.isScanning){var e=n.angle,t=w,i=Math.PI/300,a=e-t,c=Math.abs(a);if(0===c)return;c>Math.PI?t-=a/c*i:t+=a/c*i,t%=2*Math.PI,p(t)}else{var o=n.pos,s=n.nextPos;D.some((function(e){return r.has(new A(s.x,o.y),e)}))&&(s.x=o.x),D.some((function(e){return r.has(new A(o.x,s.y),e)}))&&(s.y=o.y);var u=!1;b.forEach((function(e,t){e.forEach((function(e,i){var a=v.plus(new A(t,i));(e&m)>0&&a.distanceTo(s)<2&&(n.isScanning=!0,u=!0)}))})),u||(n.pos=s)}}),[u]);var v=n.pos.minus(t.window.center).minus(new A(3,3)),b=r.crop(v,t.window.height+7,t.window.width+7),k=Object(i.useRef)(null),j=k.current;if(j){var O,E=j.getContext("2d");E.clearRect(0,0,j.width,j.height);var S=(O={},Object(C.a)(O,m,["#ffe300",2]),Object(C.a)(O,g,["#606060",1]),Object(C.a)(O,h,["#808080",1]),Object(C.a)(O,y,["#ff6600",1]),O),x=Object.keys(S);r.forEach((function(e,t){e.forEach((function(e,n){var i=x.find((function(t){return(t&e)>0}));if(i in S){var a=Object(o.a)(S[i],2),r=a[0],c=a[1];E.fillStyle=r,E.fillRect(n-c,t-c,2*c+1,2*c+1)}}))})),t.otherUsers.forEach((function(e){E.fillStyle=e.teamId===n.teamId?"#00FF00":"#FF0000",E.fillRect(e.pos.y-1,e.pos.x-1,3,3)})),E.fillStyle="#FFFFFF",E.fillRect(n.pos.y-1,n.pos.x-1,3,3),E.strokeStyle="#FFFFFF",E.strokeRect(v.y+2,v.x+2,t.window.width+2,t.window.height+2)}return a.a.createElement("div",{className:"game",onTouchStart:function(){return n.isFlashing=!0},onTouchEnd:function(){return n.isFlashing=!1},onMouseDown:function(){return n.isFlashing=!0},onMouseUp:function(){return n.isFlashing=!1},onClick:function(){n.isScanning?n.isScanning=!1:n.hasKey&&(r.add(n.pos,y),n.hasKey=!1)}},a.a.createElement("div",{className:N("grid",n.isScanning&&"scan"),style:{marginTop:"calc(".concat((n.pos.x+.5|0)-n.pos.x-3," * ").concat(t.window.gridSize,")"),marginLeft:"calc(".concat((n.pos.y+.5|0)-n.pos.y-3," * ").concat(t.window.gridSize,")"),paddingLeft:n.isScanning?"calc((100vh - 100vw) / 2)":""}},b.map((function(e,n){return a.a.createElement("div",{className:"row",key:n},e.map((function(e,i){var r=["divider","rock0","rock1","rock2","tree","tower","jail","key","border_top","border_bottom","border_left","border_right","border_top_left","border_top_right","border_bottom_left","border_bottom_right"].filter((function(t,n){return(e&1<<n)>0}));return r.length>0&&a.a.createElement("div",{className:"col",key:i,style:{left:"calc(".concat(i," * ").concat(t.window.gridSize,")")}},r.map((function(e){return a.a.createElement("div",{key:e,className:N("block",e),style:{zIndex:["divider","key"].includes(e)?0:v.indices[0]+n}})})))})))}))),t.otherUsers.map((function(e,i){return a.a.createElement(K,{key:i,className:"character",user:e,style:{zIndex:e.pos.indices[0],top:"calc(".concat(e.pos.x-n.pos.x+t.window.center.x," * ").concat(t.window.gridSize,")"),left:"calc(".concat(e.pos.y-n.pos.y+t.window.center.y," * ").concat(t.window.gridSize,")")}})})),!n.isScanning&&a.a.createElement(K,{className:"character",user:n,style:{zIndex:n.pos.indices[0],top:"calc(".concat(t.window.center.x," * ").concat(t.window.gridSize,")"),left:"calc(".concat(t.window.center.y," * ").concat(t.window.gridSize,")")}}),!n.isScanning&&a.a.createElement("div",{className:N("illumination",n.isFlashing&&"flash"),style:{marginTop:"calc(".concat(t.window.center.x," * ").concat(t.window.gridSize,")"),marginLeft:"calc(".concat(t.window.center.y," * ").concat(t.window.gridSize,")")}}),n.isScanning&&a.a.createElement("div",{className:"spotlight",style:{transform:"rotate(".concat(w/Math.PI*180,"deg)")}}),!n.isScanning&&a.a.createElement("div",{className:"minimap"},a.a.createElement("canvas",{ref:k,className:"canvas",height:r.height,width:r.width})))}var B=new q(161,81),H=new P(0,B.getSpawnPos()),W=new L(0,B.getSpawnPos(1)),G=new L(1,B.getSpawnPos(2)),Q=new L(1,B.getSpawnPos(3)),V=new T(B,[H,W,G,Q],new R(11,22));var X=function(){var e=Object(i.useRef)(null),t=e.current;return a.a.createElement("div",{className:"App",ref:e,onClick:function(){document.fullscreenElement||t&&t.requestFullscreen&&t.requestFullscreen().catch(alert)}},a.a.createElement(J,{game:V}))};c.a.render(a.a.createElement(X,null),document.getElementById("root"))}},[[11,1,2]]]);
//# sourceMappingURL=main.112fe7f2.chunk.js.map
{"version":3,"sources":["utils.js","Character.js","beans/Pos.js","beans/User.js","beans/Window.js","blocks.js","beans/Map.js","beans/Team.js","beans/Game.js","GameRenderer.js","Lobby.js","App.js","index.js"],"names":["classes","vs","filter","v","join","sq","x","UUID","Math","random","toString","substring","Character","direction","className","user","style","reversed","moving","delta","magnitude","abs","y","teamId","hasOwnKey","hasStolenKey","Pos","this","pos","sqrt","round","posJson","User","uuid","isFlashing","isScanning","_pos","_delta","_hasOwnKey","_hasStolenKey","_isFlashing","_isScanning","server","atan2","equals","updateUser","plus","userJson","Me","restore","Window","height","width","resize","window","innerHeight","innerWidth","toFixed","windowJson","Array","fill","map","_","i","DIVIDER","ROCK0","ROCK1","ROCK2","TREE","TOWER","JAIL","KEY","BORDER_TOP","BORDER_BOTTOM","BORDER_LEFT","BORDER_RIGHT","BORDER_TOP_LEFT","BORDER_TOP_RIGHT","BORDER_BOTTOM_LEFT","BORDER_BOTTOM_RIGHT","Map","j","flag","top","bottom","left","right","indices","topPad","bottomPad","leftPad","rightPad","slice","row","updateMap","callback","forEach","mapJson","Team","id","scanAngle","achievedKeyCount","_scanAngle","_achievedKeyCount","updateTeam","teamJson","Game","users","teams","PI","_window","sync","team","order","center","clear","enemies","length","find","me","some","getProgress","gameJson","obstacles","GameRenderer","game","useState","frame","setFrame","useEffect","onKeyDown","e","preventDefault","dx","dy","key","onKeyUp","onTilt","beta","gamma","onResize","document","addEventListener","removeEventListener","timer","setInterval","clearInterval","aimingAngle","getAngle","currentAngle","unit","currentPos","nextPos","myObstacles","push","obstacle","has","stop","crop","offsetI","offsetJ","offset","croppedMap","blockPos","distanceTo","isOurBase","caughtEnemy","enemy","add","getJailPos","minus","pad","offsetX","offsetY","minimapRef","useRef","canvas","current","ctx","getContext","clearRect","attrMap","blocks","Object","keys","block","color","size","fillStyle","fillRect","allies","strokeStyle","strokeRect","onTouchStart","onTouchEnd","onMouseDown","onMouseUp","onClick","closeImprisonedAllies","ally","isInJail","getSpawnPos","remove","backgroundPositionY","gridSize","backgroundPositionX","k","zIndex","includes","transform","ref","done","win","Lobby","socket","gameIds","setGameIds","roomName","setRoomName","on","gameId","emit","type","value","onChange","target","undefined","App","appRef","app","setSocket","setGame","io","connect","disconnect","updateGame","updatedGame","updatedUser","updatedTeam","handleJoinGame","handleUpdateGame","assign","handleUpdateMap","handleUpdateUser","handleUpdateTeam","removeListener","fullscreenElement","requestFullscreen","catch","alert","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.2f04bc86.chunk.js","sourcesContent":["export const classes = (...vs) => vs.filter(v => v).join(' ');\n\nexport const sq = x => x * x;\n\nexport const UUID = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n\nexport const RANDOM_GAME_ID = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);;","import React from 'react';\nimport './Character.scss';\nimport { classes } from './utils';\n\nfunction Character({ className, user, style, reversed }) {\n  const movingThreshold = .05;\n  const moving = user.delta.magnitude > movingThreshold;\n  let direction;\n  if (Math.abs(user.delta.x) > Math.abs(user.delta.y)) {\n    direction = user.delta.x * (reversed ? -1 : 1) < 0 ? 'top' : 'bottom';\n  } else {\n    direction = user.delta.y * (reversed ? -1 : 1) < 0 ? 'left' : 'right';\n  }\n  return (\n    <div className={classes('Character', `team_${user.teamId}`, moving && 'moving', direction, className)}\n         style={style}>\n      <div className={classes('holding', user.hasOwnKey || user.hasStolenKey ? 'key' : 'lamp')}/>\n    </div>\n  );\n}\n\nexport default Character;","import { sq } from '../utils';\n\nexport class Pos {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  static restore(posJson) {\n    const { x, y } = posJson;\n    return new Pos(x, y);\n  }\n\n  plus(pos) {\n    return new Pos(this.x + pos.x, this.y + pos.y);\n  }\n\n  minus(pos) {\n    return new Pos(this.x - pos.x, this.y - pos.y);\n  }\n\n  clone() {\n    return new Pos(this.x, this.y);\n  }\n\n  distanceTo(pos) {\n    return Math.sqrt(sq(this.x - pos.x) + sq(this.y - pos.y));\n  }\n\n  get indices() {\n    return [Math.round(this.x), Math.round(this.y)];\n  }\n\n  get magnitude() {\n    return Math.sqrt(sq(this.x) + sq(this.y));\n  }\n\n  equals(pos) {\n    return this.x === pos.x && this.y === pos.y;\n  }\n\n  get teamId() {\n    if (this.x < 80) return 0;\n    if (this.x > 80) return 1;\n    return -1;\n  }\n}\n","import { Pos } from './Pos';\nimport { UUID } from '../utils';\n\nexport class User {\n  constructor(uuid, teamId, pos, delta = new Pos(0, 0), hasOwnKey = true, hasStolenKey = false, isFlashing = false, isScanning = false) {\n    this.uuid = uuid;\n    this.teamId = teamId;\n    this._pos = pos;\n    this._delta = delta;\n    this._hasOwnKey = hasOwnKey;\n    this._hasStolenKey = hasStolenKey;\n    this._isFlashing = isFlashing;\n    this._isScanning = isScanning;\n  }\n\n  static restore(userJson) {\n    const { uuid, teamId, _pos, _delta, _hasOwnKey, _hasStolenKey, _isFlashing, _isScanning } = userJson;\n    const UserClass = uuid === UUID ? Me : User;\n    return new UserClass(uuid, teamId, Pos.restore(_pos), Pos.restore(_delta), _hasOwnKey, _hasStolenKey, _isFlashing, _isScanning);\n  }\n\n  sync(server) {\n    this.server = server;\n  }\n\n  get pos() {\n    if (this.isScanning) {\n      return new Pos([40, 120][this._pos.teamId], 40);\n    }\n    return this._pos;\n  }\n\n  set pos(pos) {\n    if (this.isScanning) {\n      return;\n    }\n    if (this._pos.equals(pos)) {\n      return;\n    }\n    this._pos = pos;\n    this.server && this.server.updateUser(this);\n  }\n\n  get delta() {\n    return this._delta;\n  }\n\n  set delta(delta) {\n    if (this._delta.equals(delta)) {\n      return;\n    }\n    this._delta = delta;\n    this.server && this.server.updateUser(this);\n  }\n\n  get hasOwnKey() {\n    return this._hasOwnKey;\n  }\n\n  set hasOwnKey(hasOwnKey) {\n    this._hasOwnKey = hasOwnKey;\n    this.server && this.server.updateUser(this);\n  }\n\n  get hasStolenKey() {\n    return this._hasStolenKey;\n  }\n\n  set hasStolenKey(hasStolenKey) {\n    this._hasStolenKey = hasStolenKey;\n    this.server && this.server.updateUser(this);\n  }\n\n  get isFlashing() {\n    return this._isFlashing;\n  }\n\n  set isFlashing(isFlashing) {\n    this._isFlashing = isFlashing;\n    this.server && this.server.updateUser(this);\n  }\n\n  get isScanning() {\n    return this._isScanning;\n  }\n\n  set isScanning(isScanning) {\n    this._isScanning = isScanning;\n    this.server && this.server.updateUser(this);\n  }\n\n  getAngle(reversed) {\n    return Math.atan2(-this.delta.y * (reversed ? -1 : 1), this.delta.x * (reversed ? -1 : 1));\n  }\n\n  get nextPos() {\n    return this.pos.plus(this.delta);\n  }\n\n  isOurBase(pos) {\n    return this.teamId === pos.teamId;\n  }\n\n  isInJail() {\n    return this.pos.x < 4 || this.pos.x > 156;\n  }\n}\n\nexport class Me extends User {\n}","import { Pos } from './Pos';\n\nexport class Window {\n  constructor(height, width, resize = true) {\n    this.height = height;\n    this.width = width;\n    if (resize) this.resize();\n  }\n\n  static restore(windowJson) {\n    const { height, width } = windowJson;\n    return new Window(height, width);\n  }\n\n  get gridSize() {\n    return `${(100 / this.height).toFixed(2)}vw`;\n  }\n\n  get center() {\n    return new Pos(\n      this.height / 2 | 0,\n      this.width / 2 | 0,\n    );\n  }\n\n  resize() {\n    this.width = window.innerHeight / window.innerWidth * this.height + .5 | 0;\n  }\n}","export const [\n  DIVIDER,\n  ROCK0,\n  ROCK1,\n  ROCK2,\n  TREE,\n  TOWER,\n  JAIL,\n  KEY,\n  BORDER_TOP,\n  BORDER_BOTTOM,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT,\n] = new Array(31).fill(0).map((_, i) => 1 << i);\n","import {\n  BORDER_BOTTOM,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  DIVIDER,\n  JAIL,\n  ROCK0,\n  ROCK1,\n  ROCK2,\n  TOWER,\n  TREE,\n} from '../blocks';\nimport { Pos } from './Pos';\n\nexport class Map {\n  constructor(height, width, map) {\n    this.height = height;\n    this.width = width;\n    if (map) {\n      this.map = map;\n    } else {\n      this.map = new Array(height).fill(0).map((_, i) =>\n        new Array(width).fill(0).map((_, j) => {\n          let flag = 0;\n\n          const top = i === 0;\n          const bottom = i === height - 1;\n          const left = j === 0;\n          const right = j === width - 1;\n          if (top && left) flag |= BORDER_TOP_LEFT;\n          else if (top && right) flag |= BORDER_TOP_RIGHT;\n          else if (bottom && left) flag |= BORDER_BOTTOM_LEFT;\n          else if (bottom && right) flag |= BORDER_BOTTOM_RIGHT;\n          else if (top) flag |= BORDER_TOP;\n          else if (bottom) flag |= BORDER_BOTTOM;\n          else if (left) flag |= BORDER_LEFT;\n          else if (right) flag |= BORDER_RIGHT;\n          else if (i === 80) flag |= DIVIDER;\n          else if (i === 4 || i === height - 1 - 4) flag |= JAIL;\n          else if (Math.random() < .01) flag |= [ROCK0, ROCK1, ROCK2][Math.random() * 3 | 0];\n          else if (Math.random() < .02) flag |= TREE;\n          return flag;\n        }));\n      this.map[40][width / 2 | 0] |= TOWER;\n      this.map[height - 1 - 40][width / 2 | 0] |= TOWER;\n    }\n  }\n\n  static restore(mapJson) {\n    const { height, width, map } = mapJson;\n    return new Map(height, width, map);\n  }\n\n  sync(server) {\n    this.server = server;\n  }\n\n  crop(pos, height, width) {\n    let [i, j] = pos.indices;\n    let topPad = 0;\n    let bottomPad = 0;\n    let leftPad = 0;\n    let rightPad = 0;\n    if (i < 0) {\n      topPad = -i;\n      i = 0;\n      height -= topPad;\n    }\n    if (j < 0) {\n      leftPad = -j;\n      j = 0;\n      width -= leftPad;\n    }\n    if (i + height >= this.height) {\n      bottomPad = i + height - this.height;\n      height -= bottomPad;\n    }\n    if (j + width >= this.width) {\n      rightPad = j + width - this.width;\n      width -= rightPad;\n    }\n    return [\n      ...new Array(topPad).fill(0).map(() => new Array(width).fill(0)),\n      ...this.map.slice(i, i + height).map(row => [...new Array(leftPad).fill(0), ...row.slice(j, j + width), ...new Array(rightPad).fill(0)]),\n      ...new Array(bottomPad).fill(0).map(() => new Array(width).fill(0)),\n    ];\n  }\n\n  add(pos, flag) {\n    const [i, j] = pos.indices;\n    this.map[i][j] |= flag;\n    this.server && this.server.updateMap(i, j, this.map[i][j]);\n  }\n\n  remove(pos, flag) {\n    const [i, j] = pos.indices;\n    this.map[i][j] &= ~flag;\n    this.server && this.server.updateMap(i, j, this.map[i][j]);\n  }\n\n  clear(pos) {\n    const [i, j] = pos.indices;\n    this.map[i][j] = 0;\n    this.server && this.server.updateMap(i, j, this.map[i][j]);\n  }\n\n  has(pos, flag) {\n    const [i, j] = pos.indices;\n    return (this.map[i][j] & flag) > 0;\n  }\n\n  forEach(callback) {\n    return this.map.forEach(callback);\n  }\n\n  get center() {\n    return new Pos(\n      this.height / 2 | 0,\n      this.width / 2 | 0,\n    );\n  }\n}","import { Pos } from './Pos';\n\nexport class Team {\n  constructor(id, scanAngle, achievedKeyCount = 0) {\n    this.id = id;\n    this._scanAngle = scanAngle;\n    this._achievedKeyCount = achievedKeyCount;\n  }\n\n  static restore(teamJson) {\n    const { id, _scanAngle, _achievedKeyCount } = teamJson;\n    return new Team(id, _scanAngle, _achievedKeyCount);\n  }\n\n  sync(server) {\n    this.server = server;\n  }\n\n  get scanAngle() {\n    return this._scanAngle;\n  }\n\n  set scanAngle(scanAngle) {\n    this._scanAngle = scanAngle;\n    this.server && this.server.updateTeam(this);\n  }\n\n  get achievedKeyCount() {\n    return this._achievedKeyCount;\n  }\n\n  set achievedKeyCount(achievedKeyCount) {\n    this._achievedKeyCount = achievedKeyCount;\n    this.server && this.server.updateTeam(this);\n  }\n}","import { Me, User } from './User';\nimport { Window } from './Window';\nimport { Map } from './Map';\nimport { Team } from './Team';\nimport { Pos } from './Pos';\n\nexport class Game {\n  constructor(id, map, users = [], teams = [new Team(0, 0), new Team(1, Math.PI)], window) {\n    this.id = id;\n    this.map = map;\n    this.users = users;\n    this.teams = teams;\n    this._window = window;\n  }\n\n  static restore(gameJson) {\n    const { id, map, users, teams, _window } = gameJson;\n    return new Game(id, Map.restore(map), users.map(User.restore), teams.map(Team.restore), Window.restore(_window));\n  }\n\n  sync(server) {\n    this.server = server;\n    this.map.sync(server);\n    this.users.forEach(user => user.sync(server));\n    this.teams.forEach(team => team.sync(server));\n  }\n\n  get me() {\n    return this.users.find(user => user instanceof Me);\n  }\n\n  get allies() {\n    const { teamId } = this.me;\n    return this.users.filter(user => user !== this.me && user.teamId === teamId );\n  }\n\n  get enemies() {\n    const { teamId } = this.me;\n    return this.users.filter(user => user.teamId !== teamId);\n  }\n\n  get otherUsers() {\n    return this.users.filter(user => !(user instanceof Me));\n  }\n\n  get window() {\n    if (this.me.isScanning) {\n      return new Window((this.map.height + 1) / 2 | 0, this.map.width, false);\n    }\n    return this._window;\n  }\n\n  getSpawnPos(teamId, order = 0) {\n    const pos = new Pos([5 + order, this.map.height - 1 - 5 - order][teamId], this.map.center.y);\n    this.map.clear(pos);\n    return pos;\n  }\n\n  getJailPos(teamId) {\n    return new Pos([3, this.map.height - 1 - 3][teamId], 40);\n  }\n\n  getJailX(teamId) {\n    return [4, this.map.height - 4][teamId];\n  }\n\n  getProgress(teamId) {\n    const enemies = this.users.filter(user => user.teamId !== teamId);\n    return this.teams[teamId].achievedKeyCount / enemies.length;\n  }\n\n  get done() {\n    return this.teams.some(team => this.getProgress(team.id) >= 1);\n  }\n\n  get win() {\n    return this.getProgress(this.me.teamId) >= 1;\n  }\n}","import React, { useEffect, useRef, useState } from 'react';\nimport { classes } from './utils';\nimport Character from './Character';\nimport { Pos } from './beans';\nimport {\n  BORDER_BOTTOM,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  DIVIDER,\n  JAIL,\n  KEY,\n  ROCK0,\n  ROCK1,\n  ROCK2,\n  TOWER,\n  TREE,\n} from './blocks';\nimport './GameRenderer.scss';\n// TODO: grass not moving\nconst obstacles = [ROCK0, ROCK1, ROCK2, TREE, JAIL,\n  BORDER_TOP,\n  BORDER_BOTTOM,\n  BORDER_LEFT,\n  BORDER_RIGHT,\n  BORDER_TOP_LEFT,\n  BORDER_TOP_RIGHT,\n  BORDER_BOTTOM_LEFT,\n  BORDER_BOTTOM_RIGHT];\nconst FPS = 30;\n\nexport function GameRenderer({ game }) {\n  const { me, map, teams } = game;\n  const [frame, setFrame] = useState(0);\n  const reversed = me.teamId === 0;\n\n  useEffect(() => {\n    const onKeyDown = e => {\n      e.preventDefault();\n      let dx = 0;\n      let dy = 0;\n      switch (e.key) {\n        case 'ArrowDown':\n          dx++;\n          break;\n        case 'ArrowUp':\n          dx--;\n          break;\n        case 'ArrowLeft':\n          dy--;\n          break;\n        case 'ArrowRight':\n          dy++;\n          break;\n        default:\n      }\n      dx /= 5;\n      dy /= 5;\n      if (reversed) {\n        dx *= -1;\n        dy *= -1;\n      }\n      me.delta = new Pos(dx, dy);\n    };\n\n    const onKeyUp = e => {\n      me.delta = new Pos(0, 0);\n    };\n\n    const onTilt = e => {\n      const beta = e.beta;\n      const gamma = e.gamma;\n      let dx = -gamma / 120;\n      let dy = beta / 120;\n      if (reversed) {\n        dx *= -1;\n        dy *= -1;\n      }\n      me.delta = new Pos(dx, dy);\n    };\n\n    const onResize = () => {\n      game._window.resize();\n    };\n\n    document.addEventListener('keydown', onKeyDown);\n    document.addEventListener('keyup', onKeyUp);\n    window.addEventListener('resize', onResize);\n    window.addEventListener('deviceorientation', onTilt, true);\n    return () => {\n      document.removeEventListener('keydown', onKeyDown);\n      document.removeEventListener('keyup', onKeyUp);\n      window.removeEventListener('resize', onResize);\n      window.removeEventListener('deviceorientation', onTilt);\n    };\n  }, [game._window, me]);\n\n  useEffect(() => {\n    const timer = window.setInterval(() => {\n      setFrame(Math.random());\n    }, 1000 / FPS);\n    return () => {\n      window.clearInterval(timer);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (me.isScanning) {\n      const aimingAngle = me.getAngle(reversed);\n      let currentAngle = teams[me.pos.teamId].scanAngle;\n      const unit = Math.PI / 300;\n      const delta = aimingAngle - currentAngle;\n      const magnitude = Math.abs(delta);\n      if (magnitude === 0) return;\n      if (magnitude > Math.PI) {\n        currentAngle -= delta / magnitude * unit;\n      } else {\n        currentAngle += delta / magnitude * unit;\n      }\n      currentAngle %= Math.PI * 2;\n      teams[me.pos.teamId].scanAngle = currentAngle;\n    } else {\n      const currentPos = me.pos;\n      const nextPos = me.nextPos;\n      const myObstacles = [...obstacles];\n      if (me.hasOwnKey) {\n        myObstacles.push(DIVIDER);\n      }\n      if (myObstacles.some(obstacle => map.has(new Pos(nextPos.x, currentPos.y), obstacle))) {\n        nextPos.x = currentPos.x;\n      }\n      if (myObstacles.some(obstacle => map.has(new Pos(currentPos.x, nextPos.y), obstacle))) {\n        nextPos.y = currentPos.y;\n      }\n      let stop = false;\n      const [offsetI, offsetJ] = crop.indices;\n      const offset = new Pos(offsetI, offsetJ);\n      croppedMap.forEach((row, i) => {\n        row.forEach((flag, j) => {\n          const blockPos = offset.plus(new Pos(i, j));\n          if ((flag & TOWER) > 0 && blockPos.distanceTo(nextPos) < 2) {\n            me.isScanning = true;\n            stop = true;\n          }\n        });\n      });\n      if (!stop) {\n        me.pos = nextPos;\n        if (me.hasStolenKey && me.teamId === me.pos.teamId) {\n          me.hasStolenKey = false;\n          teams[me.teamId].achievedKeyCount++;\n        }\n        if (me.isOurBase(me.pos)) {\n          const caughtEnemy = game.enemies.find(enemy => enemy.pos.distanceTo(me.pos) < 1);\n          if (caughtEnemy) {\n            if (caughtEnemy.hasStolenKey) {\n              map.add(caughtEnemy.pos, KEY);\n              caughtEnemy.hasStolenKey = false;\n            }\n            caughtEnemy.pos = game.getJailPos(me.teamId);\n          }\n        }\n      }\n    }\n  }, [frame]);\n\n  const pad = 6;\n  const crop = me.pos.minus(game.window.center).minus(new Pos(pad, pad));\n  const croppedMap = map.crop(crop, game.window.height + pad * 2, game.window.width + pad * 2);\n  const offsetX = (Math.round(crop.x) - crop.x) - pad;\n  const offsetY = (Math.round(crop.y) - crop.y) - pad;\n\n  const minimapRef = useRef(null);\n  const canvas = minimapRef.current;\n  if (canvas) {\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    const attrMap = {\n      [TOWER]: ['#ffe300', 2],\n      [JAIL]: ['#606060', 1],\n      [DIVIDER]: ['#808080', 1],\n      [KEY]: ['#ff6600', 1],\n    };\n    const blocks = Object.keys(attrMap);\n    map.forEach((row, i) => {\n      row.forEach((flag, j) => {\n        const block = blocks.find(block => (block & flag) > 0);\n        if (block === KEY.toString() && !me.isOurBase(new Pos(i, j))) {\n          return;\n        }\n        if (block in attrMap) {\n          const [color, size] = attrMap[block];\n          ctx.fillStyle = color;\n          ctx.fillRect(j - size, i - size, size * 2 + 1, size * 2 + 1);\n        }\n      });\n    });\n\n    game.allies.forEach(user => {\n      ctx.fillStyle = user.teamId === me.teamId ? '#00FF00' : '#FF0000';\n      ctx.fillRect(user.pos.y - 1, user.pos.x - 1, 3, 3);\n    });\n\n    ctx.fillStyle = '#FFFFFF';\n    ctx.fillRect(me.pos.y - 1, me.pos.x - 1, 3, 3);\n\n    ctx.strokeStyle = '#FFFFFF';\n    ctx.strokeRect(me.pos.y - game.window.center.y - 1, me.pos.x - game.window.center.x - 1, game.window.width + 2, game.window.height + 2);\n  }\n\n\n  return (\n    <div className=\"GameRenderer\"\n         onTouchStart={() => me.isFlashing = true} onTouchEnd={() => me.isFlashing = false}\n         onMouseDown={() => me.isFlashing = true} onMouseUp={() => me.isFlashing = false}\n         onClick={() => {\n           const closeImprisonedAllies = game.allies.filter(ally => ally.isInJail() && ally.pos.distanceTo(me.pos) < 5);\n           if (me.isScanning) {\n             me.isScanning = false;\n           } else if (me.hasOwnKey) {\n             map.add(me.pos, KEY);\n             me.hasOwnKey = false;\n           } else if (closeImprisonedAllies.length > 0) {\n             closeImprisonedAllies.forEach((ally, i) => {\n               ally.pos = game.getSpawnPos(me.teamId, i);\n             });\n           } else if (!me.hasStolenKey) {\n             croppedMap.forEach((row, i) => {\n               row.forEach((flag, j) => {\n                 const pos = new Pos(crop.x + i, crop.y + j);\n                 if ((flag & KEY) > 0 && me.pos.distanceTo(pos) < 1 && pos.teamId !== me.teamId) {\n                   map.remove(pos, KEY);\n                   me.hasStolenKey = true;\n                 }\n               });\n             });\n           }\n         }}>\n      <div className={classes('grid', me.isScanning && 'scan')} style={{\n        backgroundPositionY: `calc(${offsetX * (reversed ? -1 : 1)} * ${game.window.gridSize})`,\n        backgroundPositionX: `calc(${offsetY * (reversed ? -1 : 1)} * ${game.window.gridSize})`,\n      }}>\n        {\n          croppedMap.map((row, i) => (\n            <div className=\"row\" key={i} style={{\n              [reversed ? 'bottom' : 'top']: `calc(${i + offsetX} * ${game.window.gridSize})`,\n            }}>\n              {\n                row.map((flag, j) => {\n                  const blocks = ['divider', 'rock0', 'rock1', 'rock2', 'tree', 'tower', 'jail', 'key',\n                    reversed ? 'border_bottom' : 'border_top',\n                    reversed ? 'border_top' : 'border_bottom',\n                    reversed ? 'border_right' : 'border_left',\n                    reversed ? 'border_left' : 'border_right',\n                    reversed ? 'border_bottom_right' : 'border_top_left',\n                    reversed ? 'border_bottom_left' : 'border_top_right',\n                    reversed ? 'border_top_right' : 'border_bottom_left',\n                    reversed ? 'border_top_left' : 'border_bottom_right']\n                    .filter((_, k) => (flag & (1 << k)) > 0);\n                  return blocks.length > 0 && (\n                    <div className=\"col\" key={j} style={{\n                      [reversed ? 'right' : 'left']: `calc(${j + offsetY} * ${game.window.gridSize}${me.isScanning ? ' + (100vh - 100vw) / 2' : ''})`,\n                    }}>\n                      {\n                        blocks.map(block => (\n                          <div key={block} className={classes('block', block)} style={{\n                            zIndex: ['divider', 'key'].includes(block) ? 0 : (crop.indices[0] + i) * (reversed ? -1 : 1) + game.map.height * 2,\n                          }}>\n                          </div>\n                        ))\n                      }\n                    </div>\n                  );\n                })\n              }\n            </div>\n          ))\n        }\n      </div>\n      {\n        game.users.map((user, i) => (\n          <Character key={i} className=\"character\" user={user} style={{\n            zIndex: user.pos.indices[0] * (reversed ? -1 : 1) + game.map.height * 2,\n            [reversed ? 'bottom' : 'top']: `calc(${(user.pos.x - me.pos.x) + game.window.center.x} * ${game.window.gridSize})`,\n            [reversed ? 'right' : 'left']: `calc(${(user.pos.y - me.pos.y) + game.window.center.y} * ${game.window.gridSize}${me.isScanning ? ' + (100vh - 100vw) / 2' : ''})`,\n          }} reversed={reversed}/>\n        ))\n      }\n      {\n        !me.isScanning &&\n        <div className={classes('illumination', me.isFlashing && 'flash')} style={{\n          [reversed ? 'bottom' : 'top']: `calc(${game.window.center.x} * ${game.window.gridSize})`,\n          [reversed ? 'right' : 'left']: `calc(${game.window.center.y} * ${game.window.gridSize}${me.isScanning ? ' + (100vh - 100vw) / 2' : ''})`,\n          [reversed ? 'marginRight' : 'marginLeft']: `calc(-300vw + ${0.5} * ${game.window.gridSize})`,\n          [reversed ? 'marginBottom' : 'marginTop']: `calc(-300vw + ${reversed ? 0.4 : 0} * ${game.window.gridSize})`,\n        }}/>\n      }\n      {\n        me.isScanning &&\n        <div className=\"spotlight\" style={{\n          transform: `rotate(${teams[me.pos.teamId].scanAngle / Math.PI * 180}deg)`,\n        }}/>\n      }\n      {\n        !me.isScanning &&\n        <div className={classes('minimap', reversed && 'reversed')}>\n          <canvas ref={minimapRef} className=\"canvas\" height={map.height} width={map.width}/>\n        </div>\n      }\n      {\n        !me.isScanning &&\n        <div className=\"progress-container\">\n          <div className=\"progress-bar\">\n            <div className=\"progress enemy\" style={{\n              width: `${game.getProgress(1 - me.teamId) * 100}%`,\n            }}/>\n          </div>\n          <div className=\"progress-bar\">\n            <div className=\"progress ally\" style={{\n              width: `${game.getProgress(me.teamId) * 100}%`,\n            }}/>\n          </div>\n        </div>\n      }\n      {\n        game.done && (\n          game.win ? (\n            <div className=\"done win\"/>\n          ) : (\n            <div className=\"done lose\"/>\n          )\n        )\n      }\n    </div>\n  );\n}","import React, { useEffect, useState } from 'react';\nimport './Lobby.scss';\nimport { Game, Map, Window } from './beans';\n\nfunction Lobby({ socket }) {\n  const [gameIds, setGameIds] = useState([]);\n\n  const [roomName, setRoomName] = useState('');\n\n  useEffect(() => {\n    socket.on('listGames', setGameIds);\n  }, [socket]);\n  return (\n    <div className=\"Lobby\">\n      <div className=\"logo\"/>\n      <div className=\"room-list\">\n        {\n          gameIds.map(gameId => (\n            <div className=\"room\" key={gameId} onClick={() => {\n              socket.emit('joinGame', gameId);\n            }}>\n              {gameId}\n            </div>\n          ))\n        }\n      </div>\n      <div className=\"create-container\">\n        <input className=\"room-name\" type=\"text\" value={roomName} onChange={({ target }) => setRoomName(target.value)}/>\n        <button className=\"create\" onClick={() => {\n          const map = new Map(161, 81);\n          const game = new Game(roomName, map, undefined, undefined, new Window(11, 22));\n          socket.emit('createGame', game.id, game);\n        }}>\n          Create a Game\n        </button>\n      </div>\n    </div>\n  );\n}\n\nexport default Lobby;","import React, { useEffect, useRef, useState } from 'react';\nimport './App.scss';\nimport { GameRenderer } from './GameRenderer';\nimport io from 'socket.io-client';\nimport Lobby from './Lobby';\nimport { Game, Me, Team, User } from './beans';\nimport { UUID } from './utils';\n\nfunction App() {\n  const appRef = useRef(null);\n  const app = appRef.current;\n  const [socket, setSocket] = useState(null);\n  const [game, setGame] = useState(null);\n\n  useEffect(() => {\n    const socket = io.connect('https://launchyourownchinesemissle.space');\n    setSocket(socket);\n\n    return () => {\n      socket.disconnect();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!socket) return;\n\n    const server = {\n      updateGame: updatedGame => socket.emit('updateGame', updatedGame),\n      updateMap: (i, j, value) => socket.emit('updateMap', game.id, i, j, value),\n      updateUser: updatedUser => socket.emit('updateUser', game.id, updatedUser),\n      updateTeam: updatedTeam => socket.emit('updateTeam', game.id, updatedTeam),\n    };\n\n    if (game) {\n      game.sync(server);\n    }\n\n    const handleJoinGame = gameJson => {\n      const game = Game.restore(gameJson);\n      const teamId = game.users.filter(user => user.teamId === 0).length * 2 < game.users.length ? 0 : 1;\n      const allies = game.users.filter(user => user.teamId === teamId);\n      game.users.push(new Me(UUID, teamId, game.getSpawnPos(teamId, allies.length)));\n      setGame(game);\n      socket.emit('updateGame', game);\n    };\n\n    const handleUpdateGame = gameJson => {\n      if (!game) return;\n      const updatedGame = Game.restore(gameJson);\n      game.sync(null);\n      Object.assign(game, updatedGame);\n      game.sync(server);\n    };\n\n    const handleUpdateMap = (i, j, value) => {\n      if (!game) return;\n      game.map.map[i][j] = value;\n    };\n\n    const handleUpdateUser = userJson => {\n      if (!game) return;\n      const updatedUser = User.restore(userJson);\n      const user = game.users.find(user => user.uuid === updatedUser.uuid);\n      if (!user) return;\n      user.sync(null);\n      Object.assign(user, updatedUser);\n      user.sync(server);\n    };\n\n    const handleUpdateTeam = teamJson => {\n      if (!game) return;\n      const updatedTeam = Team.restore(teamJson);\n      const team = game.teams.find(team => team.id === updatedTeam.id);\n      if (!team) return;\n      team.sync(null);\n      Object.assign(team, updatedTeam);\n      team.sync(server);\n    };\n\n    socket.on('joinGame', handleJoinGame);\n    socket.on('updateGame', handleUpdateGame);\n    socket.on('updateMap', handleUpdateMap);\n    socket.on('updateUser', handleUpdateUser);\n    socket.on('updateTeam', handleUpdateTeam);\n\n    return () => {\n      socket.removeListener('joinGame', handleJoinGame);\n      socket.removeListener('updateGame', handleUpdateGame);\n      socket.removeListener('updateMap', handleUpdateMap);\n      socket.removeListener('updateUser', handleUpdateUser);\n      socket.removeListener('updateTeam', handleUpdateTeam);\n    };\n  }, [game, socket]);\n\n  return (\n    <div className=\"App\" ref={appRef}\n         onClick={() => {\n           if (!document.fullscreenElement) {\n             if (app && app.requestFullscreen) {\n               app.requestFullscreen().catch(alert);\n             }\n           }\n         }}>\n      {\n        game &&\n        <GameRenderer game={game}/>\n      }\n      {\n        !game && socket &&\n        <Lobby socket={socket}/>\n      }\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\n\nReactDOM.render(<App/>, document.getElementById('root'));\n"],"sourceRoot":""}
(this["webpackJsonpcapture-the-flag"]=this["webpackJsonpcapture-the-flag"]||[]).push([[0],{18:function(e,t,n){},38:function(e,t,n){e.exports=n(77)},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},74:function(e,t){},77:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(33),s=n.n(a),c=(n(43),n(1)),o=(n(44),n(4)),u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return e})).join(" ")},h=function(e){return e*e},d=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),l=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);n(18);var f=function(e){var t,n=e.className,i=e.user,a=e.style,s=e.reversed,c=i.delta.magnitude>.05;return t=Math.abs(i.delta.x)>Math.abs(i.delta.y)?i.delta.x*(s?-1:1)<0?"top":"bottom":i.delta.y*(s?-1:1)<0?"left":"right",r.a.createElement("div",{className:u("Character","team_".concat(i.teamId),c&&"moving",t,n),style:a},r.a.createElement("div",{className:u("holding",i.hasKey?"key":"lamp")}))},m=n(2),v=n(3),g=n(36),p=n(34),w=n(37),y=function(){function e(t,n){Object(m.a)(this,e),this.x=t,this.y=n}return Object(v.a)(e,[{key:"plus",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"distanceTo",value:function(e){return Math.sqrt(h(this.x-e.x)+h(this.y-e.y))}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"indices",get:function(){return[Math.round(this.x),Math.round(this.y)]}},{key:"magnitude",get:function(){return Math.sqrt(h(this.x)+h(this.y))}},{key:"teamId",get:function(){return this.x<80?0:this.x>80?1:-1}}],[{key:"restore",value:function(t){return new e(t.x,t.y)}}]),e}(),b=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new y(0,0),a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Object(m.a)(this,e),this.uuid=t,this.teamId=n,this._pos=i,this._delta=r,this._hasKey=a,this._isFlashing=s,this._isScanning=c}return Object(v.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"pos",get:function(){return this.isScanning?new y([40,120][this._pos.teamId],40):this._pos},set:function(e){this.isScanning||this._pos.equals(e)||(this._pos=e,this.server&&this.server.updateUser(this))}},{key:"delta",get:function(){return this._delta},set:function(e){this._delta.equals(e)||(this._delta=e,this.server&&this.server.updateUser(this))}},{key:"hasKey",get:function(){return this._hasKey},set:function(e){this._hasKey=e,this.server&&this.server.updateUser(this)}},{key:"isFlashing",get:function(){return this._isFlashing},set:function(e){this._isFlashing=e,this.server&&this.server.updateUser(this)}},{key:"isScanning",get:function(){return this._isScanning},set:function(e){this._isScanning=e,this.server&&this.server.updateUser(this)}},{key:"angle",get:function(){return Math.atan2(-this.delta.y,this.delta.x)}},{key:"nextPos",get:function(){return this.pos.plus(this.delta)}}],[{key:"restore",value:function(t){var n=t.uuid,i=t.teamId,r=t._pos,a=t._delta,s=t._hasKey,c=t._isFlashing,o=t._isScanning;return new(n===d?k:e)(n,i,y.restore(r),y.restore(a),s,c,o)}}]),e}(),k=function(e){function t(){return Object(m.a)(this,t),Object(g.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(w.a)(t,e),t}(b),j=function(){function e(t,n){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object(m.a)(this,e),this.height=t,this.width=n,i&&this.resize()}return Object(v.a)(e,[{key:"resize",value:function(){this.width=window.innerHeight/window.innerWidth*this.height+.5|0}},{key:"gridSize",get:function(){return"".concat((100/this.height).toFixed(2),"vw")}},{key:"center",get:function(){return new y(this.height/2|0,this.width/2|0)}}],[{key:"restore",value:function(t){return new e(t.height,t.width)}}]),e}(),_=n(5),O=new Array(31).fill(0).map((function(e,t){return 1<<t})),E=Object(c.a)(O,16),S=E[0],x=E[1],M=E[2],F=E[3],I=E[4],A=E[5],N=E[6],z=E[7],L=E[8],U=E[9],K=E[10],C=E[11],G=E[12],T=E[13],P=E[14],R=E[15],q=function(){function e(t,n,i){Object(m.a)(this,e),this.height=t,this.width=n,i?this.map=i:(this.map=new Array(t).fill(0).map((function(e,i){return new Array(n).fill(0).map((function(e,r){var a=0,s=0===i,c=i===t-1,o=0===r,u=r===n-1;return s&&o?a|=G:s&&u?a|=T:c&&o?a|=P:c&&u?a|=R:s?a|=L:c?a|=U:o?a|=K:u?a|=C:80===i?a|=S:4===i||i===t-1-4?a|=N:Math.random()<.01?a|=[x,M,F][3*Math.random()|0]:Math.random()<.02&&(a|=I),a}))})),this.map[40][n/2|0]|=A,this.map[t-1-40][n/2|0]|=A)}return Object(v.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"crop",value:function(e,t,n){var i=Object(c.a)(e.indices,2),r=i[0],a=i[1],s=0,o=0,u=0,h=0;return r<0&&(s=-r,r=0,t-=s),a<0&&(u=-a,a=0,n-=u),r+t>=this.height&&(t-=o=r+t-this.height),a+n>=this.width&&(h=a+n-this.width,n-=h),[].concat(Object(_.a)(new Array(s).fill(0).map((function(){return new Array(n).fill(0)}))),Object(_.a)(this.map.slice(r,r+t).map((function(e){return[].concat(Object(_.a)(new Array(u).fill(0)),Object(_.a)(e.slice(a,a+n)),Object(_.a)(new Array(h).fill(0)))}))),Object(_.a)(new Array(o).fill(0).map((function(){return new Array(n).fill(0)}))))}},{key:"add",value:function(e,t){var n=Object(c.a)(e.indices,2),i=n[0],r=n[1];this.map[i][r]|=t,this.server&&this.server.updateMap(i,r,this.map[i][r])}},{key:"remove",value:function(e,t){var n=Object(c.a)(e.indices,2),i=n[0],r=n[1];this.map[i][r]&=~t,this.server&&this.server.updateMap(i,r,this.map[i][r])}},{key:"clear",value:function(e){var t=Object(c.a)(e.indices,2),n=t[0],i=t[1];this.map[n][i]=0,this.server&&this.server.updateMap(n,i,this.map[n][i])}},{key:"has",value:function(e,t){var n=Object(c.a)(e.indices,2),i=n[0],r=n[1];return(this.map[i][r]&t)>0}},{key:"forEach",value:function(e){return this.map.forEach(e)}},{key:"center",get:function(){return new y(this.height/2|0,this.width/2|0)}}],[{key:"restore",value:function(t){return new e(t.height,t.width,t.map)}}]),e}(),D=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(m.a)(this,e),this.id=t,this._scanAngle=n,this._achievedKeyCount=i}return Object(v.a)(e,[{key:"sync",value:function(e){this.server=e}},{key:"scanAngle",get:function(){return this._scanAngle},set:function(e){this._scanAngle=e,this.server&&this.server.updateTeam(this)}},{key:"achievedKeyCount",get:function(){return this._achievedKeyCount},set:function(e){this._achievedKeyCount=e,this.server&&this.server.updateTeam(this)}}],[{key:"restore",value:function(t){return new e(t.id,t._scanAngle,t._achievedKeyCount)}}]),e}(),J=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[new D(0,0),new D(1,Math.PI)],a=arguments.length>4?arguments[4]:void 0;Object(m.a)(this,e),this.id=t,this.map=n,this.users=i,this.teams=r,this._window=a}return Object(v.a)(e,[{key:"sync",value:function(e){this.server=e,this.map.sync(e),this.users.forEach((function(t){return t.sync(e)})),this.teams.forEach((function(t){return t.sync(e)}))}},{key:"getSpawnPos",value:function(e){var t=this.users.filter((function(t){return t.teamId===e})),n=new y([5+t.length,this.map.height-1-5-t.length][e],this.map.center.y);return this.map.clear(n),n}},{key:"me",get:function(){return this.users.find((function(e){return e instanceof k}))}},{key:"allies",get:function(){var e=this.me.teamId;return this.users.filter((function(t){return t.teamId===e}))}},{key:"otherUsers",get:function(){return this.users.filter((function(e){return!(e instanceof k)}))}},{key:"window",get:function(){return this.me.isScanning?new j((this.map.height+1)/2|0,this.map.width,!1):this._window}}],[{key:"restore",value:function(t){var n=t.id,i=t.map,r=t.users,a=t.teams,s=t._window;return new e(n,q.restore(i),r.map(b.restore),a.map(D.restore),j.restore(s))}}]),e}(),B=(n(45),[x,M,F,I,N,L,U,K,C,G,T,P,R]);function H(e){var t,n=e.game,a=n.me,s=n.map,h=n.teams,d=Object(i.useState)(0),l=Object(c.a)(d,2),m=l[0],v=l[1],g=0===a.teamId;Object(i.useEffect)((function(){var e=function(e){e.preventDefault();var t=0,n=0;switch(e.key){case"ArrowDown":t++;break;case"ArrowUp":t--;break;case"ArrowLeft":n--;break;case"ArrowRight":n++}t/=3,n/=3,g&&(t*=-1,n*=-1),a.delta=new y(t,n)},t=function(e){a.delta=new y(0,0)},i=function(e){var t=e.beta,n=-e.gamma/360,i=t/360;g&&(n*=-1,i*=-1),a.delta=new y(n,i)},r=function(){n._window.resize()};return document.addEventListener("keydown",e),document.addEventListener("keyup",t),window.addEventListener("resize",r),window.addEventListener("deviceorientation",i,!0),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",t),window.removeEventListener("resize",r),window.removeEventListener("deviceorientation",i)}}),[n._window,a]),Object(i.useEffect)((function(){var e=window.setInterval((function(){v(Math.random())}),1e3/30);return function(){window.clearInterval(e)}}),[]),Object(i.useEffect)((function(){if(a.isScanning){var e=a.angle,t=h[a.pos.teamId].scanAngle,n=Math.PI/300,i=e-t,r=Math.abs(i);if(0===r)return;r>Math.PI?t-=i/r*n:t+=i/r*n,t%=2*Math.PI,h[a.pos.teamId].scanAngle=t}else{var o=a.pos,u=a.nextPos;B.some((function(e){return s.has(new y(u.x,o.y),e)}))&&(u.x=o.x),B.some((function(e){return s.has(new y(o.x,u.y),e)}))&&(u.y=o.y);var d=!1,l=Object(c.a)(p.indices,2),f=l[0],m=l[1],v=new y(f,m);w.forEach((function(e,t){e.forEach((function(e,n){var i=v.plus(new y(t,n));(e&A)>0&&i.distanceTo(u)<2&&(a.isScanning=!0,d=!0)}))})),d||(a.pos=u)}}),[m]);var p=a.pos.minus(n.window.center).minus(new y(6,6)),w=s.crop(p,n.window.height+12,n.window.width+12),b=Math.round(p.x)-p.x-6,k=Math.round(p.y)-p.y-6,j=Object(i.useRef)(null),_=j.current;if(_){var O,E=_.getContext("2d");E.clearRect(0,0,_.width,_.height);var x=(O={},Object(o.a)(O,A,["#ffe300",2]),Object(o.a)(O,N,["#606060",1]),Object(o.a)(O,S,["#808080",1]),Object(o.a)(O,z,["#ff6600",1]),O),M=Object.keys(x);s.forEach((function(e,t){e.forEach((function(e,n){var i=M.find((function(t){return(t&e)>0}));if(i in x){var r=Object(c.a)(x[i],2),a=r[0],s=r[1];E.fillStyle=a,E.fillRect(n-s,t-s,2*s+1,2*s+1)}}))})),n.otherUsers.forEach((function(e){E.fillStyle=e.teamId===a.teamId?"#00FF00":"#FF0000",E.fillRect(e.pos.y-1,e.pos.x-1,3,3)})),E.fillStyle="#FFFFFF",E.fillRect(a.pos.y-1,a.pos.x-1,3,3),E.strokeStyle="#FFFFFF",E.strokeRect(a.pos.y-n.window.center.y-1,a.pos.x-n.window.center.x-1,n.window.width+2,n.window.height+2)}return r.a.createElement("div",{className:"GameRenderer",onTouchStart:function(){return a.isFlashing=!0},onTouchEnd:function(){return a.isFlashing=!1},onMouseDown:function(){return a.isFlashing=!0},onMouseUp:function(){return a.isFlashing=!1},onClick:function(){a.isScanning?a.isScanning=!1:a.hasKey&&(s.add(a.pos,z),a.hasKey=!1)}},r.a.createElement("div",{className:u("grid",a.isScanning&&"scan")},w.map((function(e,t){return r.a.createElement("div",{className:"row",key:t,style:Object(o.a)({},g?"bottom":"top","calc(".concat(t+b," * ").concat(n.window.gridSize,")"))},e.map((function(e,i){var s=["divider","rock0","rock1","rock2","tree","tower","jail","key",g?"border_bottom":"border_top",g?"border_top":"border_bottom",g?"border_right":"border_left",g?"border_left":"border_right",g?"border_bottom_right":"border_top_left",g?"border_bottom_left":"border_top_right",g?"border_top_right":"border_bottom_left",g?"border_top_left":"border_bottom_right"].filter((function(t,n){return(e&1<<n)>0}));return s.length>0&&r.a.createElement("div",{className:"col",key:i,style:Object(o.a)({},g?"right":"left","calc(".concat(i+k," * ").concat(n.window.gridSize).concat(a.isScanning?" + (100vh - 100vw) / 2":"",")"))},s.map((function(e){return r.a.createElement("div",{key:e,className:u("block",e),style:{zIndex:["divider","key"].includes(e)?0:(p.indices[0]+t)*(g?-1:1)+2*n.map.height}})})))})))}))),!a.isScanning&&n.otherUsers.map((function(e,t){var i;return r.a.createElement(f,{key:t,className:"character",user:e,style:(i={zIndex:e.pos.indices[0]*(g?-1:1)+2*n.map.height},Object(o.a)(i,g?"bottom":"top","calc(".concat(e.pos.x-a.pos.x+n.window.center.x," * ").concat(n.window.gridSize,")")),Object(o.a)(i,g?"right":"left","calc(".concat(e.pos.y-a.pos.y+n.window.center.y," * ").concat(n.window.gridSize,")")),i),reversed:g})})),!a.isScanning&&r.a.createElement(f,{className:"character",user:a,style:(t={zIndex:a.pos.indices[0]*(g?-1:1)+2*n.map.height},Object(o.a)(t,g?"bottom":"top","calc(".concat(n.window.center.x," * ").concat(n.window.gridSize,")")),Object(o.a)(t,g?"right":"left","calc(".concat(n.window.center.y," * ").concat(n.window.gridSize,")")),t),reversed:g}),!a.isScanning&&r.a.createElement("div",{className:u("illumination",a.isFlashing&&"flash"),style:{marginTop:"calc(".concat(n.window.center.x," * ").concat(n.window.gridSize,")"),marginLeft:"calc(".concat(n.window.center.y," * ").concat(n.window.gridSize,")")}}),a.isScanning&&r.a.createElement("div",{className:"spotlight",style:{transform:"rotate(".concat(h[a.pos.teamId].scanAngle/Math.PI*180,"deg)")}}),!a.isScanning&&r.a.createElement("div",{className:u("minimap",g&&"reversed")},r.a.createElement("canvas",{ref:j,className:"canvas",height:s.height,width:s.width})))}var W=n(35),Q=n.n(W);var V=function(e){var t=e.socket,n=Object(i.useState)([]),a=Object(c.a)(n,2),s=a[0],o=a[1];return Object(i.useEffect)((function(){t.on("listGames",o)}),[t]),r.a.createElement("div",{className:"Lobby"},r.a.createElement("div",{className:"roomList"},s.map((function(e){return r.a.createElement("div",{className:"room",key:e,onClick:function(){t.emit("joinGame",e)}},e)}))),r.a.createElement("button",{className:"create",onClick:function(){var e=new q(161,81),n=new J(l,e,void 0,void 0,new j(11,22));t.emit("createGame",n.id,n)}},"Create a Game"))};var X=function(){var e=Object(i.useRef)(null),t=e.current,n=Object(i.useState)(null),a=Object(c.a)(n,2),s=a[0],o=a[1],u=Object(i.useState)(null),h=Object(c.a)(u,2),l=h[0],f=h[1];return Object(i.useEffect)((function(){var e=Q.a.connect("http://localhost:8080");return o(e),function(){e.disconnect()}}),[]),Object(i.useEffect)((function(){if(s){var e={updateGame:function(e){return s.emit("updateGame",e)},updateMap:function(e,t,n){return s.emit("updateMap",l.id,e,t,n)},updateUser:function(e){return s.emit("updateUser",l.id,e)},updateTeam:function(e){return s.emit("updateTeam",l.id,e)}};l&&l.sync(e);var t=function(e){var t=J.restore(e),n=2*t.users.filter((function(e){return 0===e.teamId})).length<t.users.length?0:1;t.users.push(new k(d,n,t.getSpawnPos(n))),f(t),s.emit("updateGame",t)},n=function(t){if(l){var n=J.restore(t);l.sync(null),Object.assign(l,n),l.sync(e)}},i=function(e,t,n){l&&(l.map.map[e][t]=n)},r=function(t){if(l){var n=b.restore(t),i=l.users.find((function(e){return e.uuid===n.uuid}));i&&(i.sync(null),Object.assign(i,n),i.sync(e))}},a=function(t){if(l){var n=D.restore(t),i=l.teams.find((function(e){return e.id===n.id}));i&&(i.sync(null),Object.assign(i,n),i.sync(e))}};return s.on("joinGame",t),s.on("updateGame",n),s.on("updateMap",i),s.on("updateUser",r),s.on("updateTeam",a),function(){s.removeListener("joinGame",t),s.removeListener("updateGame",n),s.removeListener("updateMap",i),s.removeListener("updateUser",r),s.removeListener("updateTeam",a)}}}),[l,s]),r.a.createElement("div",{className:"App",ref:e,onClick:function(){document.fullscreenElement||t&&t.requestFullscreen}},l&&r.a.createElement(H,{game:l}),!l&&s&&r.a.createElement(V,{socket:s}))};s.a.render(r.a.createElement(X,null),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.e9ca1476.chunk.js.map